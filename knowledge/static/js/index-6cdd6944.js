import{d as e,ac as a,a2 as t,a3 as l,u as n,o,c as s,g as i,b as r,a6 as d,I as c,M as u,p,a8 as m,a as f,ad as v,F as g,a7 as y,r as k,e as b,ah as h,a9 as _,N as w,t as C,K as x,h as I,_ as T,ai as N,aj as L,w as R,s as U,A as S,S as F,ak as A,al as D,am as O,f as j,U as q}from"./@vue-b526e9a7.js";import{z as K,_ as M,A as V,D as E,a as P,b as z,m as Y,c as B,L as $,M as H,d as G,e as J,f as W,g as X,T as Q,C as Z,h as ee,i as ae,I as te,j as le,k as ne,S as oe,R as se,B as ie,l as re,F as de,n as ce,o as ue,U as pe,p as me,q as fe,r as ve,s as ge,t as ye,u as ke,v as be,w as he,x as _e,y as we,E as Ce,G as xe,H as Ie,J as Te,K as Ne}from"./ant-design-vue-2bab8329.js";import{C as Le}from"./vue-echarts-d07ff7d2.js";import"./echarts-wordcloud-9c1875a5.js";import{C as Re}from"./clipboard-e8d95c39.js";import{u as Ue,o as Se,a as Fe,b as Ae,c as De,d as Oe}from"./vue-router-0183cbfe.js";import{a0 as je,a1 as qe,a2 as Ke,a3 as Me,a4 as Ve,a5 as Ee,a6 as Pe,f as ze,a7 as Ye,P as Be,G as $e,Q as He,M as Ge}from"./@ant-design-40c238bf.js";import{d as Je,c as We}from"./pinia-b21cc72f.js";import{a as Xe}from"./axios-95009a82.js";import{m as Qe,c as Ze,d as ea}from"./lodash-es-5953ec5c.js";import{E as aa,a as ta,b as la}from"./element-plus-d759c790.js";import{V as na}from"./vue-cropper-25aa6222.js";import{T as oa,E as sa}from"./@wangeditor-b05a5de4.js";import{d as ia}from"./dayjs-938c682c.js";import{u as ra,a as da,b as ca,c as ua,d as pa,e as ma,f as fa,g as va,h as ga}from"./echarts-7075129c.js";import"./@babel-81c9ad16.js";import"./resize-observer-polyfill-c24c855f.js";import"./vue-types-932461d1.js";import"./@ctrl-2e17fe3b.js";import"./dom-align-896e8735.js";import"./async-validator-efc2d198.js";import"./scroll-into-view-if-needed-4c99f3d7.js";import"./compute-scroll-into-view-6152c361.js";import"./resize-detector-94afada7.js";import"./vue-demi-5b9a0fa5.js";import"./@vueuse-1afec6d3.js";import"./@element-plus-531af0b3.js";import"./tslib-ed971494.js";import"./zrender-9f78e07a.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&a(e)})).observe(document,{childList:!0,subtree:!0})}function a(e){if(e.ep)return;e.ep=!0;const a=function(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerpolicy&&(a.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?a.credentials="include":"anonymous"===e.crossorigin?a.credentials="omit":a.credentials="same-origin",a}(e);fetch(e.href,a)}}();const ya=e({setup(e){const i=K;return(e,r)=>{const d=a("router-view"),c=M;return o(),t(c,{locale:n(i)},{default:l((()=>[s(d)])),_:1},8,["locale"])}}}),ka={autoSetContainer:!1,appendToBody:!0},ba=(e,a)=>new Promise((function(t,l){const n=document.createElement("button"),o=new Re(n,{text:function(){return e},action:function(){return"copy"},container:"object"==typeof a?a:document.body});o.on("success",(function(e){o.destroy(),t(e)})),o.on("error",(function(e){o.destroy(),l(e)})),ka.appendToBody&&document.body.appendChild(n),n.click(),ka.appendToBody&&document.body.removeChild(n)})),ha={install:function(e){e.config.globalProperties.$clipboardConfig=ka,e.config.globalProperties.$copyText=ba,e.directive("clipboard",{mounted:function(e,a){if("success"===a.arg)e._vClipboard_success=a.value;else if("error"===a.arg)e._vClipboard_error=a.value;else{const t=new Re(e,{text:function(){return a.value},action:function(){return"cut"===a.arg?"cut":"copy"},container:ka.autoSetContainer?e:void 0});t.on("success",(function(a){const t=e._vClipboard_success;t&&t(a)})),t.on("error",(function(a){const t=e._vClipboard_error;t&&t(a)})),e._vClipboard=t}},updated:function(e,a){"success"===a.arg?e._vClipboard_success=a.value:"error"===a.arg?e._vClipboard_error=a.value:(e._vClipboard.text=function(){return a.value},e._vClipboard.action=function(){return"cut"===a.arg?"cut":"copy"})},unmounted:function(e,a){"success"===a.arg?delete e._vClipboard_success:"error"===a.arg?delete e._vClipboard_error:(e._vClipboard.destroy(),delete e._vClipboard)}})},config:ka},_a=(e,a)=>{let t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download",a),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)};const wa=(e,a)=>{if(!e)return;const t=function(e,a){let t=window.atob(e),l=t.length,n=new Uint8Array(l);for(;l--;)n[l]=t.charCodeAt(l);return new Blob([n],{type:a})}(e,"application/pdf"),l=window.URL.createObjectURL(t);_a(l,a)},Ca=(e,a)=>{if(!e)return;const t=new Blob([e],{type:"application/pdf"}),l=window.URL.createObjectURL(t);_a(l,a)},xa={install:function(e){e.config.globalProperties.$downloadFileByBase64=wa,e.config.globalProperties.$downloadFileByFileFlow=Ca}},Ia="知识库智能管理系统",Ta={defaultAvatar:"//s.go2yd.com/a/thead_meiguoduizhang.png"};var Na=(e,a)=>{const t=e.__vccOpts||e;for(const[l,n]of a)t[l]=n;return t};const La={class:"user-name"};var Ra=Na(e({props:{name:{type:String},avatar:{type:String},emailAddr:{type:String}},setup(e){var a;const u=i({DEFAULT_AVATAR:null==(a=Ta)?void 0:a.defaultAvatar});return(a,i)=>{const p=V,m=E;return o(),t(m,null,{default:l((()=>[r("div",{class:"user-info",onClick:i[0]||(i[0]=c((()=>{}),["prevent"]))},[s(p,{src:e.avatar||n(u).DEFAULT_AVATAR,alt:`${e.name}'s avatar`},null,8,["src","alt"]),r("span",La,d(e.name||"管理员"),1)])])),_:1})}}}),[["__scopeId","data-v-e3cad32e"]]);const Ua=e({components:{SkinFilled:je,SettingFilled:qe,BookFilled:Ke,HomeFilled:Me,DashboardFilled:Ve,PieChartFilled:Ee},props:{route:{type:Object,value:{}}},setup(e){const{route:a}=u(e),t=p((()=>{var e,t,l,n,o;return"1"===(null==(t=null==(e=a.value)?void 0:e.meta)?void 0:t.level)?null==(n=null==(l=a.value)?void 0:l.meta)?void 0:n.key:null==(o=a.value)?void 0:o.name}));return{...u(e),key:t}}}),Sa={class:"nav-text"};var Fa=Na(Ua,[["render",function(e,n,s,i,c,u){var p,k,b,h,_,w,C;const x=a("Menus",!0),I=P,T=z;return(null==(p=e.route)?void 0:p.children)&&"1"!==(null==(b=null==(k=e.route)?void 0:k.meta)?void 0:b.level)&&!1!==(null==(h=e.route.meta)?void 0:h.isMenu)?(o(),t(I,{key:e.route.name,title:(null==(_=e.route.meta)?void 0:_.title)||"未命名"},{icon:l((()=>{var a;return[(o(),t(m(null==(a=e.route.meta)?void 0:a.icon)))]})),default:l((()=>[(o(!0),f(g,null,v(e.route.children,(e=>{var a;return o(),f(g,null,[!1!==(null==(a=e.meta)?void 0:a.isMenu)?(o(),t(x,{key:0,route:e},null,8,["route"])):y("",!0)],64)})),256))])),_:1},8,["title"])):(o(),f(g,{key:1},[!1!==(null==(C=null==(w=e.route)?void 0:w.meta)?void 0:C.isMenu)?(o(),t(T,{key:e.key},{icon:l((()=>{var a,l;return[(o(),t(m(null==(l=null==(a=e.route)?void 0:a.meta)?void 0:l.icon)))]})),default:l((()=>{var a,t;return[r("span",Sa,d((null==(t=null==(a=e.route)?void 0:a.meta)?void 0:t.title)||"未命名"),1)]})),_:1})):y("",!0)],64))}]]);const Aa=(e,a=!0)=>(Object.keys(e).forEach((t=>{void 0!==e[t]&&null!==e[t]||delete e[t],a&&""===e[t]&&delete e[t],"[]"!==JSON.stringify(e[t])&&"{}"!==JSON.stringify(e[t])||delete e[t]})),e),Da=e=>{if(!e.length)return[];if("string"==typeof e){const a=e.split("/");return[{uid:"-1",status:"done",thumbUrl:e,type:"image/png",name:a[a.length-1],response:e}]}return"object"==typeof e?e.map(((e,a)=>{const t=e.split("/");return{uid:(-(a+1)).toString(),status:"done",thumbUrl:e,type:"image/png",name:t[t.length-1],response:e}})):[]},Oa=e=>{Y.error(e)},ja=e=>{if(!1===e.useDefaultParms)return{};const a=Ea(),t={userId:a.userInfo.pUserId,opUser:a.userInfo.userName};return Aa(t),t},qa=Xe.create({baseURL:"http://10.165.15.67:8662",timeout:1e4,showMsg:!1});qa.defaults.withCredentials=!0,qa.interceptors.request.use((function(e){if(void 0!==navigator.onLine&&!1===navigator.onLine)return Promise.reject({message:"网络未链接",code:-1});if("get"==e.method&&(e.params={...ja(e),...e.params}),"post"==e.method){const a={...ja(e),...e.data};if(!1===e.useGenParams)return Qe(e.data)?(e.data=e.data.map((a=>({...a,...ja(e)}))),e):e;e.data=e.data instanceof FormData?e.data:a}return e}),(function(e){return Promise.reject(e)})),qa.interceptors.response.use((function(e){var a,t;const{data:l,config:n}=e;if(-1!==(null==(a=n.url)?void 0:a.indexOf("pandora.yidian-inc.com")))return l&&"success"===l.status?l:Promise.reject();const o=null!=(t=l.code)?t:-1;if(1e3!==o){const e=l.message||"未定义错误";return Oa(l.message),Promise.reject({code:o,message:e})}return n.showMsg&&l.message&&Y.info(l.message),l.data}),(function(e){return e.code&&-1===e.code||(e.message="接口请求错误，请联系管理员"),Oa(e.message),Promise.reject(e)}));const Ka=(e,a,t)=>qa.get(e,{params:a,...t}),Ma=(e,a,t)=>qa.post(e,a,t);const Va=localStorage.getItem("userInfo")?JSON.parse(localStorage.getItem("userInfo")):{userName:"",sex:1,moblie:"",pUserId:"",photo:"",id:""},Ea=Je({id:"app-user",state:()=>({userInfo:Va,authList:[],menuList:[],menuOperateAuthMap:{}}),getters:{},actions:{async getUserLogged(){var e;try{const a=await async function(e){return Ka("/user/parse/token",e)}({token:null!=(e=localStorage.getItem("token"))?e:""});this.userInfo=a,localStorage.setItem("userInfo",JSON.stringify(a))}catch(a){return!1}},async getMenuAuth(){try{const e=await async function(){return Ka("/menu/query/user")}(),a=[],t={},l=(e,a,n,o=!1)=>{var s,i,r;for(let d=0;d<e.length;d++){const c=e[d];for(let e=0;e<a.length;e++){const u=a[e];if(u.menuName===(null==(s=c.meta)?void 0:s.title)&&u.children&&u.children.length>0)if("1"===(null==(i=c.meta)?void 0:i.level)||o){const e=u.children.filter((e=>"仅查看"===e.menuName||"可编辑"===e.menuName)).length>0,a=u.children.filter((e=>"可编辑"===e.menuName)).length>0,l=Ze(c);t[c.meta.key]=a,this.menuOperateAuthMap=t,e&&n.push(l)}else n.push(Ze(c)),n[d].children=[],l(null!=(r=c.children)?r:[],u.children,n[d].children,!0)}}};l(ro,e,a),uo.options.routes=[...a,...co],this.menuList=a}catch(e){return!1}},redirectToLogin(){const e=location.href;location.href=`//pandora.yidian-inc.com/tools/admin/login?callback=${e}`}}}),Pa=Je({id:"keep-alive",state:()=>({caches:[]}),getters:{getCaches(){return this.caches}},actions:{ADD(e){this.caches.indexOf(e)<0&&this.caches.push(e)},REMOVE(e){this.caches=this.caches.filter((a=>a!=e))},CLEAN(){this.caches=[]}}});const za={key:0,class:"title"};var Ya=Na(e({setup(e){!function(){const e=Ue(),a=Pa();e.meta.keepAlive&&a.ADD(e.name);const t=(e,t)=>{!1!==e.meta.isMenu&&a.REMOVE(t.name),e.meta.keepAlive&&a.ADD(e.name)};Se(((e,a,l)=>{t(e,a),l()})),Fe(((e,a,l)=>{t(e,a),l()}))}();const r=Ae(),c=Ue(),u=Ea(),w=Pa(),C=k(!1),x=i({title:Ia,selectedKeys:[""],openKeys:[],name:"",avatar:""}),I=u.menuList,T=p((()=>w.getCaches.join(","))),N=k(!1),L=({key:e,selectedKeys:a})=>{r.push({name:e}),x.selectedKeys=a};return b((async()=>{if(window.self===window.top){N.value=!0,x.selectedKeys=[c.name],x.openKeys=[c.path.split("/")[1]];const{userName:e,photo:a}=u.userInfo;x.name=e,x.avatar=a}else N.value=!1})),(e,i)=>{const r=a("router-link"),u=$,p=H,k=G,b=a("router-view"),w=J,R=B;return o(),t(R,{class:"layout-wrap"},{default:l((()=>[N.value?(o(),f(g,{key:0},[s(u,{class:"header-container"},{default:l((()=>[s(r,{class:"app-logo",to:"/"},{default:l((()=>[C.value?y("",!0):(o(),f("h1",za,d(n(x).title),1))])),_:1}),s(Ra,{name:n(x).name,avatar:n(x).avatar},null,8,["name","avatar"])])),_:1}),s(k,{class:"sider-container",collapsed:C.value,"onUpdate:collapsed":i[1]||(i[1]=e=>C.value=e)},{default:l((()=>[s(p,{selectedKeys:n(x).selectedKeys,openKeys:n(x).openKeys,"onUpdate:openKeys":i[0]||(i[0]=e=>n(x).openKeys=e),theme:"dark",mode:"inline",onSelect:L},{default:l((()=>[(o(!0),f(g,null,v(n(I),(e=>(o(),t(Fa,{route:e},null,8,["route"])))),256))])),_:1},8,["selectedKeys","openKeys"])])),_:1},8,["collapsed"])],64)):y("",!0),s(R,{style:_(N.value?{marginLeft:"200px"}:"")},{default:l((()=>[s(w,{id:N.value?"content-container":""},{default:l((()=>[(o(),t(b,{key:n(c).fullPath},{default:l((({Component:e,route:a})=>[(o(),t(h,{include:n(T)},[(o(),t(m(e),{key:a.meta.path}))],1032,["include"]))])),_:1}))])),_:1},8,["id"])])),_:1},8,["style"])])),_:1})}}}),[["__scopeId","data-v-4f287c03"]]);const Ba={class:"app-container"};var $a=Na({name:"FullScreenLayout"},[["render",function(e,n,i,r,d,c){const u=a("router-view");return o(),f("div",Ba,[s(u,null,{default:l((({Component:e})=>[(o(),t(m(e)))])),_:1})])}]]);var Ha=Na({},[["render",function(e,a){const l=W;return o(),t(l,{status:"403",title:"暂无权限","sub-title":"对不起，您暂时没有此页面的访问权限，请前往父级系统登录后通过父系统内菜单再次点击进入"})}]]);const Ga={field:"",order:void 0,columnKey:""};function Ja(e){const{fetchData:a,formatParams:t,formatResponse:l,paginationOption:o=["current","size"],pageSize:s=20,firstLoaded:r=!0}=e,d=k(),c=k(Ga),m=i({dataSource:[],tableLoading:!1,total:0,current:1,size:s,selectedRowKeys:[]}),f=p((()=>({total:m.total,current:m.current,pageSize:m.size,showTotal:e=>`共${e}条`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],onChange:e=>{m.current=e},onShowSizeChange:(e,a)=>{m.current=1,m.size=a}}))),v=p((()=>({selectedRowKeys:n(m.selectedRowKeys),onChange:e=>{console.log(`selectedRowKeys: ${e}`,e),m.selectedRowKeys=e}}))),g=async()=>{m.tableLoading=!0;try{const e=t();let[n,s]=o;const i=Aa({[n]:m.current,[s]:m.size,sort_field:c.value.field,sort_value:c.value.order,...e}),r=await a(i);if(m.tableLoading=!1,l){const{list:e,total:a}=await l(r);return m.dataSource=e,void(m.total=a)}m.dataSource=r.records,m.total=r.total}catch(e){throw e}},y=()=>new Promise(((e,a)=>{d.value.validate().then((()=>{e()})).catch((()=>{a()}))})),b=()=>{c.value=Ga,m.selectedRowKeys=[]};return w((()=>{r&&g()})),{...u(m),onSearch:()=>{y().then((()=>{m.current=1,b(),g()}))},onReset:()=>{d.value.resetFields(),m.current=1,b(),g()},pagination:f,getList:g,searchFormRef:d,onTableChange:(e,a,t)=>{c.value=t,g()},sortedInfo:c,rowSelection:v}}const Wa=e=>Ka("/base/home",e),Xa={1:"条目",2:"文档",3:"图片",4:"视频",5:"专题"},Qa=[{label:"知识分类",value:"1"},{label:"知识类型",value:"2"}],Za=e=>Ka("/dict/tree/query",e);const et=e({name:"TypeTree",props:{knowledgeType:null,knowledgeFlag:null},emits:["update:knowledgeType","update:knowledgeFlag","change"],setup(e,{emit:a}){const r=e,d=i({status:"1"});u(r);const c=k(""),p=k([]),m=async()=>{const e=await Za({type:d.status});p.value=e,p.value.unshift({dictName:"全部",id:"",parentId:""})};m();const y=()=>{m(),a("update:knowledgeType",""),a("update:knowledgeFlag","")},b=e=>{c.value=e.id.toString(),"1"===d.status?(a("update:knowledgeType",C(e.id)),a("update:knowledgeFlag","")):(a("update:knowledgeType",""),a("update:knowledgeFlag",C(e.id))),a("change",C(e.id))};return(e,a)=>{const i=X,r=Q,c=Z;return o(),f("div",null,[s(c,{class:"table-box mt20"},{default:l((()=>[s(r,{activeKey:n(d).status,"onUpdate:activeKey":a[0]||(a[0]=e=>n(d).status=e),type:"card",tabBarGutter:6,class:"search-tabs mb15",onChange:y},{default:l((()=>[(o(!0),f(g,null,v(n(Qa),(e=>(o(),t(i,{key:e.value,tab:e.label},null,8,["tab"])))),128))])),_:1},8,["activeKey"]),p.value.length?(o(),t(n(ta),{key:1,data:p.value,"node-key":"id","check-on-click-node":"","default-expand-all":"","highlight-current":"","expand-on-click-node":!1,"default-checked-keys":[],props:{label:"dictName"},onNodeClick:b},null,8,["data"])):(o(),t(n(aa),{key:0,"image-size":200,description:"暂无数据"}))])),_:1})])}}}),at=e({props:{value:null},emits:["update:value"],setup(e,{emit:a}){const l=e,{value:s}=u(l),i=k([]),r=k(Ze(s.value)),d=async e=>{const a={};e&&(a.itemName=e);const{records:t}=await(l=a,Ka("/item/query",l));var l;i.value=t.map((e=>({value:e.id,label:e.itemName})))},c=ea((e=>{d(e)}),300);b((()=>{d()}));const p=e=>{r.value=e,a("update:value",r)};return(e,a)=>{const l=ee;return o(),t(l,{value:r.value,"onUpdate:value":a[0]||(a[0]=e=>r.value=e),options:i.value,placeholder:"请选择项目",style:{width:"200px"},"show-search":"","allow-clear":"","filter-option":!1,onSearch:n(c),onChange:p},null,8,["value","options","onSearch"])}}});const tt=x("创建时间"),lt=x("浏览量"),nt=x("查询"),ot=x("重置");var st=Na(e({name:"Home",setup(e){const r=p((()=>[{title:"知识条目",dataIndex:"knowledgeName",key:"knowledgeName",align:"center",width:200,ellipsis:!0},{title:"类型",dataIndex:"knowledgeFlag",key:"knowledgeFlag",align:"center",width:80,customRender:({text:e})=>Xa[e]},{title:"分类",dataIndex:"knowledgeTypeName",key:"knowledgeTypeName",align:"center",width:80,customRender:({text:e})=>e?e.split(", ").join("-"):""},{title:"安全级别",dataIndex:"securityLevelName",key:"securityLevelName",align:"center"},{title:"有效期",dataIndex:"deadline",key:"deadline",align:"center"},{title:"创建人",dataIndex:"creator",key:"creator",align:"center"},{title:"创建时间",dataIndex:"createTime",key:"createTime",align:"center"}])),c="YYYY-MM-DD",u=i({knowledgeFlag:"",knowledgeType:"",knowledgeName:"",author:"",itemId:"",dateRange:[],sortType:"createTime"}),{onSearch:m,onReset:v,pagination:k,dataSource:b,getList:h,searchFormRef:_,onTableChange:w,sortedInfo:C}=Ja({fetchData:Wa,formatParams(){const e=u.dateRange,a={...u};return delete a.dateRange,e.length&&(a.startTime=e[0],a.endTime=e[1]),a}}),I=()=>{m()};return(e,i)=>{const p=te,h=le,C=ne,T=oe,N=ee,L=se,R=ie,U=re,S=ae,F=de,A=Z,D=a("router-link"),O=ce;return o(),f("div",null,[s(A,{class:"search-box mt15"},{default:l((()=>[s(F,{ref_key:"searchFormRef",ref:_,layout:"inline",model:n(u)},{default:l((()=>[s(S,{gutter:[24,16]},{default:l((()=>[s(C,null,{default:l((()=>[s(h,{label:"标题",name:"knowledgeName"},{default:l((()=>[s(p,{value:n(u).knowledgeName,"onUpdate:value":i[0]||(i[0]=e=>n(u).knowledgeName=e),valueModifiers:{trim:!0},placeholder:"请输入标题",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(C,null,{default:l((()=>[s(h,{label:"作者",name:"author"},{default:l((()=>[s(p,{value:n(u).author,"onUpdate:value":i[1]||(i[1]=e=>n(u).author=e),valueModifiers:{trim:!0},placeholder:"请输入作者",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(C,null,{default:l((()=>[s(h,{label:"项目",name:"itemId"},{default:l((()=>[s(at,{value:n(u).itemId,"onUpdate:value":i[2]||(i[2]=e=>n(u).itemId=e)},null,8,["value"])])),_:1})])),_:1}),s(C,null,{default:l((()=>[s(h,{label:"排序方式",name:"sortType"},{default:l((()=>[s(N,{value:n(u).sortType,"onUpdate:value":i[3]||(i[3]=e=>n(u).sortType=e),style:{width:"120px"},"allow-clear":""},{default:l((()=>[s(T,{value:"createTime"},{default:l((()=>[tt])),_:1}),s(T,{value:"browseNum"},{default:l((()=>[lt])),_:1})])),_:1},8,["value"])])),_:1})])),_:1}),s(C,null,{default:l((()=>[s(h,{label:"创建时间",name:"dateRange"},{default:l((()=>[s(L,{value:n(u).dateRange,"onUpdate:value":i[4]||(i[4]=e=>n(u).dateRange=e),format:c,"value-format":c,"allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(C,null,{default:l((()=>[s(h,null,{default:l((()=>[s(U,{size:20},{default:l((()=>[s(R,{type:"primary",onClick:n(m)},{default:l((()=>[nt])),_:1},8,["onClick"]),s(R,{onClick:n(v)},{default:l((()=>[ot])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(S,null,{default:l((()=>[s(C,{span:4},{default:l((()=>[s(et,{knowledgeType:n(u).knowledgeType,"onUpdate:knowledgeType":i[5]||(i[5]=e=>n(u).knowledgeType=e),knowledgeFlag:n(u).knowledgeFlag,"onUpdate:knowledgeFlag":i[6]||(i[6]=e=>n(u).knowledgeFlag=e),onChange:I},null,8,["knowledgeType","knowledgeFlag"])])),_:1}),s(C,{span:20},{default:l((()=>[s(A,{class:"table-box mt20"},{default:l((()=>[s(O,{rowKey:"id",columns:n(r),"data-source":n(b),pagination:n(k),bordered:"",onChange:n(w)},{bodyCell:l((({column:e,text:a,record:n})=>["knowledgeName"===e.dataIndex?(o(),t(D,{key:0,to:{name:"ArticleDetail",query:{id:n.id}}},{default:l((()=>[x(d(a),1)])),_:2},1032,["to"])):y("",!0),"deadline"===e.dataIndex?(o(),f(g,{key:1},[x(d("0"===n.expirationType?"永久有效":n.endTime),1)],64)):y("",!0)])),_:1},8,["columns","data-source","pagination","onChange"])])),_:1})])),_:1})])),_:1})])}}}),[["__scopeId","data-v-9b308f72"]]);const it=e=>Ma("/base/tail/log/save",e),rt=e=>Ka("/base/tail/log/query",e);function dt(){return{share:e=>{const{id:a,title:t,type:l,endTime:n}=e;ue.info({title:"分享",okText:"确认",maskClosable:!0,content:I("div",{},[I("p",{class:"mt15"},[I("span","标题："),I("span",{class:"link"},t)]),I("p",{class:"mt15"},`类型：${Xa[l]}     有效期：${n}`)]),onOk:async()=>{await it({knowledgeId:a,logType:0});try{await ba(`${window.location.protocol}//${window.location.host}${window.location.pathname}#/myKnowledge/article-detail?id=${a}`),Y.success("文章链接也复制到您的剪切板!")}catch(e){Y.error("复制失败")}}})}}}const ct=e=>Ka("/base/query",e),ut=e=>Ma("/base/save",e),pt=e=>Ma("/base/update",e),mt=e=>Ka("/base/detail",e),ft=e=>{const a=new FormData;return a.append("file",e),Ma("/file/upload",a,{headers:{"Content-type":"multipart/form-data"}})},vt={class:"ant-upload-drag-icon"},gt=r("p",{class:"ant-upload-text"},"单击或拖动文件到该区域进行上传",-1),yt=r("p",{class:"ant-upload-hint"},"支持单次或批量上传",-1),kt=e({emits:["success","cancel"],setup(e,{emit:a}){const d=Ea(),c=de.useForm,u=i({labelCol:{span:4},wrapperCol:{span:20}}),p=i({fileList:[],category:""}),m=i({fileList:[{required:!0,message:"请选择文件！"}],category:[{required:!0,message:"请选择知识分类！"}]}),f=k([]);(async()=>{const e=await Za({type:"1"});f.value=e})();const v=({file:e})=>{if(!e.status){const a=p.fileList.indexOf(e),t=p.fileList.slice();t.splice(a,1),p.fileList=t}},g=e=>!0,y=async({onSuccess:e,onError:a,file:t},l)=>{(async t=>{const l=await ft(t);if(l)e&&e(l),p.fileList[p.fileList.length-1].thumbUrl=l;else{const e="上传失败";a&&a(e)}})(t)},b=e=>"error"===e.status||(ue.confirm({title:"确定删除吗?",icon:s(ze),content:"",okText:"确定",okType:"danger",cancelText:"取消",onOk:()=>{const a=p.fileList.indexOf(e);p.fileList.splice(a,1)},onCancel(){console.log("Cancel")}}),!1),{resetFields:h,validate:_,validateInfos:w}=c(p,m),C=async()=>{try{const t=(({fileList:e,category:a})=>e.map((e=>({accessory:e.response||"",knowledgeName:e.name,knowledgeType:a,knowledgeFlag:"2",userId:d.userInfo.id,parentUserId:d.userInfo.pUserId}))))(await _());await(e=t,Ma("base/batch/save",e,{useGenParams:!1})),Y.success("成功!"),a("success"),x()}catch(t){console.log("error",t)}var e},x=()=>{h(),a("cancel",!1)};return(e,a)=>{const i=pe,d=le,c=me,m=de,k=ue;return o(),t(k,{width:"600px",title:"批量上传文档",visible:!0,destroyOnClose:"",onOk:C,onCancel:x},{default:l((()=>[s(m,N(L(n(u))),{default:l((()=>[s(d,T({label:"文档"},n(w).fileList),{default:l((()=>[s(i,{fileList:n(p).fileList,"onUpdate:fileList":a[0]||(a[0]=e=>n(p).fileList=e),name:"file",multiple:!0,"custom-request":y,"before-upload":g,onRemove:b,onChange:v},{default:l((()=>[r("p",vt,[s(n(Pe))]),gt,yt])),_:1},8,["fileList"])])),_:1},16),s(d,T({label:"知识分类"},n(w).category),{default:l((()=>[s(c,{value:n(p).category,"onUpdate:value":a[1]||(a[1]=e=>n(p).category=e),style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},fieldNames:{children:"children",label:"dictName",value:"id"},placeholder:"请选择知识分类","allow-clear":"","tree-default-expand-all":"","tree-data":f.value},null,8,["value","tree-data"])])),_:1},16)])),_:1},16)])),_:1})}}});const bt=x("查询"),ht=x("重置"),_t=x("新建知识"),wt=x("批量上传文档"),Ct=x("新建专题"),xt=x("分享"),It=x("编辑 "),Tt=x("删除");var Nt=Na(e({name:"KnowledgeList",setup(e){const c=Ae(),u=Ue(),m=Ea(),v=u.meta.key,k=p((()=>m.menuOperateAuthMap[v])),b=p((()=>{R.value;const e=[{title:"类型",dataIndex:"knowledgeFlag",key:"knowledgeFlag",align:"center",width:80,customRender:({text:e})=>Xa[e]},{title:"知识条目",dataIndex:"knowledgeName",key:"knowledgeName",align:"center",width:300,ellipsis:!0},{title:"分类",dataIndex:"knowledgeTypeName",key:"knowledgeTypeName",align:"center",customRender:({text:e})=>e?e.split(", ").join("-"):""},{title:"创建时间",dataIndex:"createTime",key:"createTime",align:"center"},{title:"最后编辑时间",dataIndex:"updateTime",key:"updateTime",align:"center"},{title:"操作",dataIndex:"operation",align:"center"}];return k.value||e.pop(),e})),h=i({knowledgeName:"",sortType:"createTime"}),{onSearch:_,onReset:w,pagination:C,dataSource:I,getList:T,searchFormRef:N,onTableChange:L,sortedInfo:R}=Ja({fetchData:ct,formatParams:()=>({...h})}),U=(e,a)=>{if(5===e.knowledgeFlag)return c.push({name:"KnowledgeCreateTopic",query:e.id?{id:e.id,type:a}:{type:a}});c.push({name:"KnowledgeCreate",query:e.id?{id:e.id,type:a}:{type:a}})},S=async e=>{var a;await(a={id:e},Ka("/base/del",a)),Y.success("删除成功！"),T()},F=i({visible:!1}),A=()=>{F.visible=!0},D=()=>{F.visible=!1},{share:O}=dt();return(e,i)=>{const u=te,p=le,m=ne,v=ie,R=re,j=ae,q=de,K=Z,M=a("router-link"),V=fe,E=ce;return o(),f(g,null,[r("div",null,[s(K,{class:"search-box"},{default:l((()=>[s(q,{ref_key:"searchFormRef",ref:N,layout:"inline",model:n(h)},{default:l((()=>[s(j,{gutter:[24,16]},{default:l((()=>[s(m,null,{default:l((()=>[s(p,{label:"条目标题",name:"knowledgeName"},{default:l((()=>[s(u,{value:n(h).knowledgeName,"onUpdate:value":i[0]||(i[0]=e=>n(h).knowledgeName=e),valueModifiers:{trim:!0},placeholder:"请输入条目标题",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(m),s(m,null,{default:l((()=>[s(p,null,{default:l((()=>[s(R,{size:20},{default:l((()=>[s(v,{type:"primary",onClick:n(_)},{default:l((()=>[bt])),_:1},8,["onClick"]),s(v,{onClick:n(w)},{default:l((()=>[ht])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(K,{class:"table-box mt20"},{default:l((()=>[n(k)?(o(),t(j,{key:0,class:"action-btn-box"},{default:l((()=>[s(v,{class:"mr15",style:{"background-color":"#36bc62","border-color":"#36bc62"},type:"primary",onClick:i[1]||(i[1]=e=>U({id:""},"create"))},{default:l((()=>[_t])),_:1}),s(v,{class:"mr15",onClick:A},{default:l((()=>[wt])),_:1}),s(v,{onClick:i[2]||(i[2]=e=>{return a={id:""},t="create",void c.push({name:"KnowledgeCreateTopic",query:a.id?{id:a.id,type:t}:{type:t}});var a,t})},{default:l((()=>[Ct])),_:1})])),_:1})):y("",!0),s(E,{rowKey:"id",columns:n(b),"data-source":n(I),pagination:n(C),bordered:"",onChange:n(L)},{bodyCell:l((({column:e,text:a,record:r})=>["knowledgeName"===e.dataIndex?(o(),t(M,{key:0,to:{name:"ArticleDetail",query:{id:r.id}}},{default:l((()=>[x(d(a),1)])),_:2},1032,["to"])):y("",!0),"operation"===e.dataIndex?(o(),f(g,{key:1},[s(v,{type:"link",class:"action-btn",onClick:e=>n(O)({id:r.id,title:r.knowledgeName,type:r.knowledgeFlag,endTime:"0"===r.expirationType?"永久有效":r.endTime})},{default:l((()=>[xt])),_:2},1032,["onClick"]),s(v,{type:"link",class:"action-btn",onClick:e=>U({id:r.id,knowledgeFlag:r.knowledgeFlag},"update")},{default:l((()=>[It])),_:2},1032,["onClick"]),s(V,{title:"确定要删除此项目吗？","ok-text":"确定","cancel-text":"取消",onConfirm:e=>S(r.id),onCancel:i[3]||(i[3]=()=>{})},{default:l((()=>[s(v,{type:"link",class:"action-btn"},{default:l((()=>[Tt])),_:1})])),_:2},1032,["onConfirm"])],64)):y("",!0)])),_:1},8,["columns","data-source","pagination","onChange"])])),_:1})]),n(F).visible?(o(),t(kt,{key:0,onSuccess:n(T),onCancel:D},null,8,["onSuccess"])):y("",!0)],64)}}}),[["__scopeId","data-v-15a4892b"]]);const Lt={class:"upload-wrapper clearfix"},Rt=x(" 点击上传 "),Ut={key:0},St=r("div",{class:"ant-upload-text"},"上传",-1),Ft=["src"],At={style:{width:"100%",height:"450px"}},Dt=e({props:{modelValue:{type:Array,default:()=>[]},isAllowUpload:{type:Boolean,default:!0},maxLength:{type:Number,default:100},crop:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},type:{type:String,default:"0"}},emits:["update:modelValue","onBeforeUpload"],setup(e,{expose:a,emit:i}){const d=e,{modelValue:c,crop:p}=u(d),m=k(!1),v=k(""),b=k([]),h=k({});b.value=Ze(c.value);const _=k(!1),w=k(null),x=k(""),I=k(""),T=()=>{m.value=!1,v.value=""},N=e=>{v.value=e.thumbUrl,m.value=!0},L=({file:e})=>{if(!e.status||p.value){p.value&&(h.value=e);const a=b.value.indexOf(e),t=b.value.slice();t.splice(a,1),b.value=t}"removed"===e.status&&i("update:modelValue",C(b.value))},U=e=>{if(i("onBeforeUpload"),!d.isAllowUpload)return!1;const a=e.type.split("/")[0],t=e.type.split("/")[1],l="image"===a,n=["jpg","jpeg","png","gif","bmp"],o=e.size/1024/1024<8;return l&&!o?(Y.error("图片必须小于8MB！"),!1):l&&-1===n.indexOf(t)?(Y.error("文件格式错误，支持文件格式为：jpg、jpeg、png、gif、bmp"),!1):!(l&&n.indexOf(t)>-1)||new Promise((a=>{const t=new FileReader;t.readAsDataURL(e),t.onload=()=>{const e=document.createElement("img");e.src=t.result,e.onload=()=>{const t=document.createElement("canvas");t.width=e.naturalWidth,t.height=e.naturalHeight;const l=t.getContext("2d");if(l){l.drawImage(e,0,0);const a={font:"microsoft yahei",textArray:["北京市海淀区水务局"],density:3};((e,a,t,l)=>{let n=0;n=a>=3456?50:a>=2700?30:a>=2e3?26:20,e.fillStyle="white",e.font=`${n}px ${l.font}`,e.lineWidth=1,e.fillStyle="rgba(255,255,255,0.3)",e.textAlign="left",e.textBaseline="middle";const o=Math.max(a,t),s=Math.floor(o/l.density);let i=[0];for(;i[i.length-1]<o/2;)i.push(i[i.length-1]+s);i.push(...i.slice(1,i.length).map((e=>-e)));for(let r=0;r<i.length;r++)for(let o=0;o<i.length;o++)e.save(),e.translate(a/2,t/2),e.rotate(-Math.PI/5),l.textArray.length>3&&(l.textArray=l.textArray.slice(0,3)),l.textArray.forEach(((a,t)=>{let l=n*t+2;e.fillText(a,i[r],i[o]+l)})),e.restore()})(l,e.naturalWidth,e.naturalHeight,a)}t.toBlob(a)}}}))},S=async({onSuccess:e,onError:a,file:t},l)=>{if(p.value&&!l){I.value=t.name,_.value=!0;const e=await(e=>new Promise(((a,t)=>{const l=new FileReader;l.readAsDataURL(e),l.onload=()=>a(l.result),l.onerror=e=>t(e)})))(t);return void(x.value=e)}(async t=>{const n=await ft(t);if(n)e&&e(n),p.value&&b.value.push(h.value),b.value[b.value.length-1].thumbUrl=n,l&&(b.value[b.value.length-1].status="success",b.value[b.value.length-1].response=n),i("update:modelValue",C(b.value));else{const e="上传失败";a&&a(e),l&&(b.value[b.value.length-1].status="error")}})(t)},F=e=>"error"===e.status||(ue.confirm({title:"确定删除吗?",icon:s(ze),content:"",okText:"确定",okType:"danger",cancelText:"取消",onOk:()=>{const a=b.value.indexOf(e);b.value.splice(a,1),i("update:modelValue",C(b.value))},onCancel(){console.log("Cancel")}}),!1),A=()=>{w.value.getCropData((e=>{const a=((e,a)=>{const t=e.split(","),l=t[0].match(/:(.*?);/)[1],n=atob(t[1]);let o=n.length;const s=new Uint8Array(o);for(;o--;)s[o]=n.charCodeAt(o);return new File([s],a,{type:l})})(e,I.value);i("update:modelValue",C(b.value)),S({file:a,action:"",method:"POST"},!0)})),_.value=!1},D=()=>{_.value=!1;const e=b.value.length-1,a=b.value.slice();a.splice(e,1),b.value=a,i("update:modelValue",a)};R(c,(e=>{C(e).length?b.value=Ze(e):b.value=[]}));return a({hasPendingTask:()=>b.value.some((e=>"uploading"===e.status))}),(a,i)=>{const d=ie,c=ve,u=ue;return o(),f(g,null,[r("div",Lt,["2"===e.type?(o(),t(c,{key:0,"file-list":b.value,"onUpdate:file-list":i[0]||(i[0]=e=>b.value=e),"custom-request":S,"before-upload":U,onRemove:F,onChange:L,disabled:e.disabled},{default:l((()=>[s(d,null,{default:l((()=>[s(n(Ye)),Rt])),_:1})])),_:1},8,["file-list","disabled"])):(o(),t(c,{key:1,"file-list":b.value,"onUpdate:file-list":i[1]||(i[1]=e=>b.value=e),"list-type":"picture-card","custom-request":S,"before-upload":U,onRemove:F,onPreview:N,onChange:L,isImageUrl:()=>!0,disabled:e.disabled},{default:l((()=>[b.value.length<e.maxLength?(o(),f("div",Ut,[s(n(Be),{class:"upload-icon"}),St])):y("",!0)])),_:1},8,["file-list","isImageUrl","disabled"])),s(u,{visible:m.value,footer:null,onCancel:T},{default:l((()=>[v.value?(o(),f("img",{key:0,alt:"example",style:{width:"100%"},src:v.value},null,8,Ft)):y("",!0)])),_:1},8,["visible"])]),s(u,{title:"裁剪图片",visible:_.value,width:800,onOk:A,onCancel:D},{default:l((()=>[r("div",At,[s(n(na),{autoCrop:"",img:x.value,ref_key:"cropper",ref:w,centerBox:"",fixed:"",canMove:!1,fixedNumber:[20,13]},null,8,["img"])])])),_:1},8,["visible"])],64)}}});const Ot={class:"base-editor border"};var jt=Na(e({props:{modelValue:{type:String,default:()=>[]}},emits:["update:modelValue"],setup(e,{emit:a}){const t=e,{modelValue:l}=u(t),i=U(),r=k("default"),d=k("");setTimeout((()=>{d.value=Ze(l.value)}),1e3);const c={},p={placeholder:"请输入内容...",MENU_CONF:{uploadImage:{server:"http://10.165.15.67:8662/file/upload",fieldName:"file",maxFileSize:104857600,customInsert(e,a){a(e.data)}},uploadVideo:{server:"http://10.165.15.67:8662/file/upload",fieldName:"file",maxFileSize:104857600,customInsert(e,a){a(e.data)}}}};S((()=>{const e=i.value;null!=e&&e.destroy()}));const m=e=>{i.value=e},v=e=>{a("update:modelValue",e.getHtml())};return(e,a)=>(o(),f("div",Ot,[s(n(oa),{class:"border-bt",editor:n(i),defaultConfig:c,mode:r.value},null,8,["editor","mode"]),s(n(sa),{class:"editor",defaultConfig:p,mode:r.value,modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),onOnCreated:m,onOnChange:v},null,8,["mode","modelValue"])]))}}),[["__scopeId","data-v-b4301818"]]);const qt=e({setup(e){const a=[{title:"条目标题",dataIndex:"knowledgeName",key:"knowledgeName",align:"center"},{title:"操作",dataIndex:"operation",align:"center",width:110}];return(e,n)=>{const s=ce;return o(),t(s,T({columns:a},e.$attrs),{bodyCell:l((({column:a,record:t})=>["operation"===a.dataIndex?F(e.$slots,"operation",{key:0,record:t}):y("",!0)])),_:3},16)}}}),Kt=x("查询"),Mt=e({props:{selectedRows:null},emits:["success","cancel"],setup(e,{emit:a}){const r=e,{selectedRows:c}=u(r),p=i({selectedRow:[]}),m=i({knowledgeName:""}),{onSearch:f,onReset:v,pagination:g,dataSource:y,getList:k,searchFormRef:h,onTableChange:_}=Ja({fetchData:ct,formatParams:()=>m,pageSize:10,formatResponse(e){const{records:a,total:t}=e;return c.value.forEach((e=>{a.forEach((a=>{e.id===a.id&&(a.checked=!0)}))})),{list:a,total:t}}}),w=()=>{const e={selectedRows:p.selectedRow};a("success",e),C()},C=()=>{a("cancel")};return b((async()=>{await k()})),(e,a)=>{const i=te,r=le,c=ne,u=ie,v=re,k=ae,b=de,I=Z,T=ue;return o(),t(T,{title:"选择知识条目",visible:!0,maskClosable:!1,closable:!1,centered:"",width:"80%",destroyOnClose:"","body-style":{height:"80vh","overflow-y":"auto"},onOk:w,onCancel:C},{default:l((()=>[s(I,{class:"search-box"},{default:l((()=>[s(b,{ref_key:"searchFormRef",ref:h,layout:"inline",model:n(m)},{default:l((()=>[s(k,{gutter:[24,16]},{default:l((()=>[s(c,null,{default:l((()=>[s(r,{label:"标题",name:"knowledgeName"},{default:l((()=>[s(i,{value:n(m).knowledgeName,"onUpdate:value":a[0]||(a[0]=e=>n(m).knowledgeName=e),valueModifiers:{trim:!0},placeholder:"请输入知识条目标题",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(c,null,{default:l((()=>[s(r,null,{default:l((()=>[s(v,{size:20},{default:l((()=>[s(u,{type:"primary",onClick:n(f)},{default:l((()=>[Kt])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(qt,{rowKey:"id","data-source":n(y),pagination:n(g),bordered:"",onChange:n(_)},{operation:l((({record:e})=>[s(u,{type:e.checked?"primary":"",disabled:e.disabled,onClick:a=>{return(t=e).checked=!t.checked,void(t.checked?p.selectedRow.push(t):p.selectedRow.splice(p.selectedRow.findIndex((e=>e.id==t.id)),1));var t}},{default:l((()=>[x(d(e.checked?"已添加":"添加"),1)])),_:2},1032,["type","disabled","onClick"])])),_:1},8,["data-source","pagination","onChange"])])),_:1})}}});const Vt={class:"page-title"},Et=x("文档"),Pt=x("图片"),zt=x("视频"),Yt=x("永久有效"),Bt=x("自定义有效期"),$t=x("关联知识"),Ht=x("移除"),Gt=x("保存"),Jt=x("取消");var Wt=(e=>(e.update="编辑",e.create="新增",e))(Wt||{});var Xt=Na(e({setup(e){const a=Ue(),u=Ae(),{type:m="create",id:v=""}=a.query,h=Ea(),_={2:"文档",3:"图片",4:"视频"},w=[{label:"水务局内部公开",value:"0"},{label:"同科室公开",value:"1"},{label:"私有",value:"3"}],x=k("");b((async()=>{"update"===m&&await(async()=>{const e=await mt({id:v}),{knowledgeFlag:a,knowledgeName:t,knowledgeType:l,accessory:n,documentNum:o,archiveTime:s,pagination:i,content:r,securityLevel:d,expirationType:c,endTime:u,longitude:p,latitude:m,relateds:f,version:g}=e;N.entry=t,N.type=a+"",N.category=l,N.doc_number=o,N.file_date=s,N.pages_num=i,N.content=r,N.safe_level=null!=d?d:"0",N.expiration_type=null!=c?c:"0",N.expiration_date=u,N.file=Da(n.split(",")),S.knowledgeList=f,x.value=g})()}));const I=de.useForm;let{modelRef:N,rulesRef:L}={modelRef:i({type:"2",file:[],entry:"",category:"",doc_number:"",file_date:"",pages_num:"",storage_location:"",content:"",label:[],safe_level:"0",expiration_type:"0",expiration_date:"",project:"",location:""}),rulesRef:p((()=>({type:[{required:!0,message:"请选择知识类型"}],file:[{required:!1,message:"请上传文件"}],entry:[{required:!0,message:"请填写知识条目"}],category:[{required:!0,message:"请选择知识分类"}],doc_number:[{required:!1}],file_date:[{required:!1}],pages_num:[{required:!1}],storage_location:[{required:!1}],content:[{required:!1}],label:[{required:!1}],safe_level:[{required:!1}],expiration_type:[{required:!1}],expiration_date:[{required:!1}],project:[{required:!1}],location:[{required:!1}],knowledge:[{required:!1}]})))};const R=()=>{N.file=[]},U=k([]);(async()=>{const e=await Za({type:"1"});U.value=e})();const S=i({visible:!1,knowledgeList:[]}),F=e=>{const{selectedRows:a}=e;S.knowledgeList.push(...a)},{resetFields:A,validate:D,validateInfos:O}=I(N,L),j=async()=>{try{const e=(e=>{const{category:a,content:t,doc_number:l,entry:n,expiration_date:o,expiration_type:s,file:i,file_date:r,pages_num:d,safe_level:c,storage_location:u,type:p}=e,m={knowledgeFlag:p,knowledgeName:n,knowledgeType:a,accessory:C(i).map((e=>e.response)).join(","),documentNum:l,archiveTime:r,pagination:d,location:u,content:t,securityLevel:c,endTime:o,itemId:"",expirationType:s,relateds:S.knowledgeList.map((e=>e.id)).join(","),userId:h.userInfo.id,parentUserId:h.userInfo.pUserId};return Aa(m)})(await D());await(async e=>"create"===m?await ut(e):await pt({...e,id:v,version:x.value}))(e),Y.success("操作成功！"),q()}catch(e){console.log(e)}},q=()=>{A(),u.back()};return(e,a)=>{const i=ge,u=ye,p=le,v=te,k=me,b=ke,h=be,C=ie,x=he,I=ne,L=ae,A=de,D=Z;return o(),f(g,null,[s(D,null,{default:l((()=>[r("div",Vt,d(Wt[n(m)])+"知识",1),s(A,{class:"mt24","label-col":{span:2},"wrapper-col":{span:14}},{default:l((()=>[s(p,T({label:"知识类型"},n(O).type),{default:l((()=>[s(u,{value:n(N).type,"onUpdate:value":a[0]||(a[0]=e=>n(N).type=e),onChange:R},{default:l((()=>[s(i,{value:"2"},{default:l((()=>[Et])),_:1}),s(i,{value:"3"},{default:l((()=>[Pt])),_:1}),s(i,{value:"4"},{default:l((()=>[zt])),_:1})])),_:1},8,["value"])])),_:1},16),s(p,T({label:_[n(N).type]},n(O).file),{default:l((()=>[s(Dt,{modelValue:n(N).file,"onUpdate:modelValue":a[1]||(a[1]=e=>n(N).file=e),"max-length":8,type:n(N).type},null,8,["modelValue","type"])])),_:1},16,["label"]),s(p,T({label:"知识条目"},n(O).entry),{default:l((()=>[s(v,{value:n(N).entry,"onUpdate:value":a[2]||(a[2]=e=>n(N).entry=e),placeholder:"请填写知识条目"},null,8,["value"])])),_:1},16),s(p,T({label:"知识分类"},n(O).category),{default:l((()=>[s(k,{value:n(N).category,"onUpdate:value":a[3]||(a[3]=e=>n(N).category=e),style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},fieldNames:{children:"children",label:"dictName",value:"id"},placeholder:"请选择知识分类","allow-clear":"","tree-default-expand-all":"","tree-data":U.value},null,8,["value","tree-data"])])),_:1},16),"2"===n(N).type?(o(),f(g,{key:0},[s(p,T({label:"文号"},n(O).doc_number),{default:l((()=>[s(v,{value:n(N).doc_number,"onUpdate:value":a[4]||(a[4]=e=>n(N).doc_number=e),placeholder:"请填写文号"},null,8,["value"])])),_:1},16),s(p,T({label:"档案日期"},n(O).file_date),{default:l((()=>[s(b,{value:n(N).file_date,"onUpdate:value":a[5]||(a[5]=e=>n(N).file_date=e),valueFormat:"YYYY-MM-DD"},null,8,["value"])])),_:1},16),s(p,T({label:"页数"},n(O).pages_num),{default:l((()=>[s(v,{value:n(N).pages_num,"onUpdate:value":a[6]||(a[6]=e=>n(N).pages_num=e),placeholder:"请填写页数"},null,8,["value"])])),_:1},16),s(p,T({label:"存放地点"},n(O).storage_location),{default:l((()=>[s(v,{value:n(N).storage_location,"onUpdate:value":a[7]||(a[7]=e=>n(N).storage_location=e),placeholder:"请填写存放地点"},null,8,["value"])])),_:1},16)],64)):y("",!0),s(p,T({label:"知识内容"},n(O).content),{default:l((()=>[s(jt,{modelValue:n(N).content,"onUpdate:modelValue":a[8]||(a[8]=e=>n(N).content=e)},null,8,["modelValue"])])),_:1},16),s(p,T({label:"安全级别"},n(O).safe_level),{default:l((()=>[s(u,{value:n(N).safe_level,"onUpdate:value":a[9]||(a[9]=e=>n(N).safe_level=e),options:w},null,8,["value"])])),_:1},16),s(p,T({label:"有效期"},n(O).expiration_type),{default:l((()=>[s(u,{value:n(N).expiration_type,"onUpdate:value":a[10]||(a[10]=e=>n(N).expiration_type=e)},{default:l((()=>[s(h,{value:"0"},{default:l((()=>[Yt])),_:1}),s(h,{value:"1"},{default:l((()=>[Bt])),_:1})])),_:1},8,["value"])])),_:1},16),"1"===n(N).expiration_type?(o(),t(p,T({key:1,"wrapper-col":{offset:2}},n(O).expiration_date),{default:l((()=>[s(b,{value:n(N).expiration_date,"onUpdate:value":a[11]||(a[11]=e=>n(N).expiration_date=e),valueFormat:"YYYY-MM-DD"},null,8,["value"])])),_:1},16)):y("",!0),s(p,T({label:"关联知识"},n(O).knowledge),{default:l((()=>[r("div",null,[s(C,{class:"mr15",type:"primary",onClick:a[12]||(a[12]=e=>n(S).visible=!0)},{default:l((()=>[$t])),_:1}),r("span",null,"已关联 "+d(n(S).knowledgeList.length)+" 条知识",1)]),s(qt,{class:"mt24",rowKey:"id","data-source":n(S).knowledgeList,pagination:!1,bordered:""},{operation:l((({record:e})=>[s(C,{type:"primary",size:"small",onClick:a=>{return t=e,void S.knowledgeList.splice(S.knowledgeList.findIndex((e=>e.id==t.id)),1);var t}},{default:l((()=>[Ht])),_:2},1032,["onClick"])])),_:1},8,["data-source"])])),_:1},16),"readonly"!==n(m)?(o(),t(L,{key:2},{default:l((()=>[s(x),s(I,{span:24,style:{"text-align":"right"}},{default:l((()=>[s(C,{type:"primary",onClick:c(j,["prevent"])},{default:l((()=>[Gt])),_:1},8,["onClick"]),s(C,{style:{"margin-left":"10px"},onClick:q},{default:l((()=>[Jt])),_:1})])),_:1})])),_:1})):y("",!0)])),_:1})])),_:1}),n(S).visible?(o(),t(Mt,{key:0,"selected-rows":n(S).knowledgeList,onSuccess:F,onCancel:a[13]||(a[13]=e=>n(S).visible=!1)},null,8,["selected-rows"])):y("",!0)],64)}}}),[["__scopeId","data-v-14ee118d"]]);const Qt={class:"page-title"},Zt=x("关联知识"),el=x("移除"),al=x("保存"),tl=x("取消");var ll=(e=>(e.update="编辑",e.create="新增",e))(ll||{});var nl=Na(e({setup(e){const a=Ue(),u=Ae(),m=Ea(),{type:v="create",id:h=""}=a.query,_=[{label:"水务局内部公开",value:"0"},{label:"同科室公开",value:"1"},{label:"私有",value:"3"}],w=de.useForm,{modelRef:C,rulesRef:x}={modelRef:i({knowledgeName:"",knowledgeType:"",content:"",labels:[],securityLevel:"0",location:""}),rulesRef:p((()=>({knowledgeName:[{required:!0,message:"请填写标题"}],knowledgeType:[{required:!0,message:"请选择分类"}],content:[{required:!0,message:"请填写专题描述"}],labels:[{required:!1}],securityLevel:[{required:!1}],location:[{required:!1}],knowledge:[{required:!1}]})))},I=k("");b((async()=>{"update"===v&&await(async()=>{const e=await mt({id:h}),{knowledgeName:a,knowledgeType:t,content:l,securityLevel:n,longitude:o,latitude:s,relateds:i,version:r}=e;C.knowledgeName=a,C.knowledgeType=t,C.content=l,C.securityLevel=null!=n?n:"0",N.knowledgeList=i,I.value=r})()}));const N=i({visible:!1,knowledgeList:[]}),L=e=>{const{selectedRows:a}=e;N.knowledgeList.push(...a)},R=k([]);(async()=>{const e=await Za({type:"1"});R.value=e})();const{resetFields:U,validate:S,validateInfos:F}=w(C,x),A=async()=>{try{const e=(e=>{const{knowledgeName:a,knowledgeType:t,content:l,securityLevel:n}=e,o={knowledgeFlag:"5",knowledgeName:a,knowledgeType:t,content:l,securityLevel:n,relateds:N.knowledgeList.map((e=>e.id)).join(","),userId:m.userInfo.id,parentUserId:m.userInfo.pUserId};return Aa(o)})(await S());await(async e=>"create"===v?await ut(e):await pt({...e,id:h,version:I.value}))(e),Y.success("操作成功！"),D()}catch(e){console.log(e)}},D=()=>{U(),u.back()};return(e,a)=>{const i=te,u=le,p=me,m=_e,k=ye,b=ie,h=he,w=ne,x=ae,I=de,U=Z;return o(),f(g,null,[s(U,null,{default:l((()=>[r("div",Qt,d(ll[n(v)])+"专题",1),s(I,{class:"mt24","label-col":{span:2},"wrapper-col":{span:14}},{default:l((()=>[s(u,T({label:"专题标题"},n(F).knowledgeName),{default:l((()=>[s(i,{value:n(C).knowledgeName,"onUpdate:value":a[0]||(a[0]=e=>n(C).knowledgeName=e),placeholder:"请填写专题标题"},null,8,["value"])])),_:1},16),s(u,T({label:"分类"},n(F).knowledgeType),{default:l((()=>[s(p,{value:n(C).knowledgeType,"onUpdate:value":a[1]||(a[1]=e=>n(C).knowledgeType=e),style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},fieldNames:{children:"children",label:"dictName",value:"id"},placeholder:"请选择知识分类","allow-clear":"","tree-default-expand-all":"","tree-data":R.value},null,8,["value","tree-data"])])),_:1},16),s(u,T({label:"专题描述"},n(F).content),{default:l((()=>[s(m,{value:n(C).content,"onUpdate:value":a[2]||(a[2]=e=>n(C).content=e),rows:4,placeholder:"请填写专题描述",maxlength:6},null,8,["value"])])),_:1},16),s(u,T({label:"安全级别"},n(F).securityLevel),{default:l((()=>[s(k,{value:n(C).securityLevel,"onUpdate:value":a[3]||(a[3]=e=>n(C).securityLevel=e),options:_},null,8,["value"])])),_:1},16),s(u,T({label:"关联知识"},n(F).knowledge),{default:l((()=>[r("div",null,[s(b,{class:"mr15",type:"primary",onClick:a[4]||(a[4]=e=>n(N).visible=!0)},{default:l((()=>[Zt])),_:1}),r("span",null,"已关联 "+d(n(N).knowledgeList.length)+" 条知识",1)]),s(qt,{class:"mt24",rowKey:"id","data-source":n(N).knowledgeList,pagination:!1,bordered:""},{operation:l((({record:e})=>[s(b,{type:"primary",size:"small",onClick:a=>{return t=e,void N.knowledgeList.splice(N.knowledgeList.findIndex((e=>e.id==t.id)),1);var t}},{default:l((()=>[el])),_:2},1032,["onClick"])])),_:1},8,["data-source"])])),_:1},16),"readonly"!==n(v)?(o(),t(x,{key:0},{default:l((()=>[s(h),s(w,{span:24,style:{"text-align":"right"}},{default:l((()=>[s(b,{type:"primary",onClick:c(A,["prevent"])},{default:l((()=>[al])),_:1},8,["onClick"]),s(b,{style:{"margin-left":"10px"},onClick:D},{default:l((()=>[tl])),_:1})])),_:1})])),_:1})):y("",!0)])),_:1})])),_:1}),n(N).visible?(o(),t(Mt,{key:0,"selected-rows":n(N).knowledgeList,onSuccess:L,onCancel:a[5]||(a[5]=e=>n(N).visible=!1)},null,8,["selected-rows"])):y("",!0)],64)}}}),[["__scopeId","data-v-b678398a"]]);const ol=e=>Ka("/base/collection/query",e),sl=e=>Ka("/base/cancel/collection",e);const il=(e,a)=>{(function(e){return new Promise((a=>{const t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Access-Control-Allow-Origin","*"),t.responseType="blob",t.onload=()=>{200===t.status&&a(t.response)},t.send()}))})(e).then((e=>{!function(e,a){const t=document.createElement("a"),l=document.querySelector("body");t.href=window.URL.createObjectURL(e),t.download=a,t.style.display="none",l&&l.appendChild(t),t.click(),l&&l.removeChild(t),window.URL.revokeObjectURL(t.href)}(e,a)}))};const rl=e=>Ka("/base/error/correction/query",e),dl={class:"ant-upload-drag-icon"},cl=r("p",{class:"ant-upload-text"},"单击或拖动文件到该区域进行上传",-1),ul=r("p",{class:"ant-upload-hint"},"支持单次或批量上传",-1),pl=e({props:{id:null},emits:["success","cancel"],setup(e,{emit:a}){const d=e,{id:c}=u(d),p=de.useForm,m=i({labelCol:{span:4},wrapperCol:{span:20}}),f=i({content:"",picture:[],accessory:[]}),v=i({content:[{required:!0,message:"请选择纠错内容！"}],picture:[{required:!1}],accessory:[{required:!1}]}),g=({file:e})=>{if(!e.status){const a=f.accessory.indexOf(e),t=f.accessory.slice();t.splice(a,1),f.accessory=t}},y=e=>!0,k=async({onSuccess:e,onError:a,file:t},l)=>{(async t=>{const l=await ft(t);if(l)e&&e(l),f.accessory[f.accessory.length-1].thumbUrl=l;else{const e="上传失败";a&&a(e)}})(t)},b=e=>"error"===e.status||(ue.confirm({title:"确定删除吗?",icon:s(ze),content:"",okText:"确定",okType:"danger",cancelText:"取消",onOk:()=>{const a=f.accessory.indexOf(e);f.accessory.splice(a,1)},onCancel(){console.log("Cancel")}}),!1),{resetFields:h,validate:_,validateInfos:w}=p(f,v),C=async()=>{try{const t=(({content:e,picture:a,accessory:t})=>({knowledgeId:c.value,content:e,picture:a.map((e=>e.response)).join(","),accessory:t.map((e=>e.response)).join(",")}))(await _());await(e=t,Ma("/base/error/correction/save",e)),Y.success("成功!"),a("success"),x()}catch(t){console.log("error",t)}var e},x=()=>{h(),a("cancel",!1)};return(e,a)=>{const i=_e,d=le,c=pe,u=de,p=ue;return o(),t(p,{width:"600px",title:"内容纠错",visible:!0,destroyOnClose:"",onOk:C,onCancel:x},{default:l((()=>[s(u,N(L(n(m))),{default:l((()=>[s(d,T({label:"内容"},n(w).content),{default:l((()=>[s(i,{value:n(f).content,"onUpdate:value":a[0]||(a[0]=e=>n(f).content=e),rows:4,placeholder:"请填写描述",maxlength:6},null,8,["value"])])),_:1},16),s(d,T({label:"补充图片"},n(w).picture),{default:l((()=>[s(Dt,{modelValue:n(f).picture,"onUpdate:modelValue":a[1]||(a[1]=e=>n(f).picture=e),"max-length":8,type:"1"},null,8,["modelValue"])])),_:1},16),s(d,T({label:"补充附件"},n(w).accessory),{default:l((()=>[s(c,{fileList:n(f).accessory,"onUpdate:fileList":a[2]||(a[2]=e=>n(f).accessory=e),name:"file",multiple:!0,"custom-request":k,"before-upload":y,onRemove:b,onChange:g},{default:l((()=>[r("p",dl,[s(n(Pe))]),cl,ul])),_:1},8,["fileList"])])),_:1},16)])),_:1},16)])),_:1})}}}),ml=r("div",null,"内容:",-1),fl=["innerHTML"],vl=e({props:{content:null},emits:["success","cancel"],setup(e,{emit:a}){const i=e,{content:d}=u(i),c=()=>{a("success"),p()},p=()=>{a("cancel")};return(e,a)=>{const i=ne,u=ae,m=ue;return o(),t(m,{title:"查看修订内容",visible:!0,maskClosable:!1,closable:!1,width:"600px",destroyOnClose:"",onOk:c,onCancel:p},{default:l((()=>[s(u,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[ml])),_:1}),s(i,{span:19},{default:l((()=>[r("div",{innerHTML:n(d)},null,8,fl)])),_:1})])),_:1})])),_:1})}}}),gl={class:"ant-rate-text"},yl=e({props:{knowledgeId:null},emits:["success","cancel"],setup(e,{emit:a}){const c=e,{knowledgeId:p}=u(c),m=de.useForm,f=i({labelCol:{span:4},wrapperCol:{span:20}}),v=i({rate:1}),g=i({rate:[{required:!0,message:"请选择分数！"}]}),{resetFields:y,validate:k,validateInfos:b}=m(v,g),h=async()=>{try{const t=await k();await(e={...t,knowledgeId:p.value},Ma("base/rate/save",e)),Y.success("成功!"),a("success"),_()}catch(t){console.log("error",t)}var e},_=()=>{y(),a("cancel",!1)};return(e,a)=>{const i=we,c=le,u=de,p=ue;return o(),t(p,{width:"400px",title:"评价",visible:!0,destroyOnClose:"",onOk:h,onCancel:_},{default:l((()=>[s(u,N(L(n(f))),{default:l((()=>[s(c,T({label:"评分"},n(b).rate),{default:l((()=>[s(i,{value:n(v).rate,"onUpdate:value":a[0]||(a[0]=e=>n(v).rate=e)},null,8,["value"]),r("span",gl,d(n(v).rate)+"分",1)])),_:1},16)])),_:1},16)])),_:1})}}});const kl=e=>(A("data-v-7df77338"),e=e(),D(),e),bl={class:"ant-rate-text"},hl=x("分享"),_l=x("纠错"),wl=kl((()=>r("span",{class:"label"},"分类: ",-1))),Cl={class:"value"},xl=kl((()=>r("span",{class:"label"},"安全级别: ",-1))),Il={class:"value"},Tl=kl((()=>r("span",{class:"label"},"创建人: ",-1))),Nl={class:"value"},Ll=kl((()=>r("span",{class:"label"},"创建时间: ",-1))),Rl={class:"value"},Ul=kl((()=>r("span",{class:"label"},"有效时间: ",-1))),Sl={class:"value"},Fl=kl((()=>r("span",{class:"label"},"内容: ",-1))),Al=["innerHTML"],Dl=kl((()=>r("span",{class:"label"},"附件列表: ",-1))),Ol=["href"],jl=x("下载"),ql=kl((()=>r("span",{class:"label"},"相关知识: ",-1))),Kl={class:"file"},Ml={class:"user-info"},Vl={class:"user-name"},El={class:"base-info mb24"},Pl=kl((()=>r("div",{class:"title mb15"},"基本信息",-1))),zl=kl((()=>r("span",{class:"label"},"科室",-1))),Yl={class:"value"},Bl=kl((()=>r("span",{class:"label"},"性别",-1))),$l={class:"value"},Hl=kl((()=>r("span",{class:"label"},"联系电话",-1))),Gl={class:"value"},Jl=kl((()=>r("span",{class:"label"},"最后修改时间",-1))),Wl={class:"value"},Xl=kl((()=>r("span",{class:"label"},"直接领导",-1))),Ql={class:"value"},Zl={class:"version"},en=kl((()=>r("div",{class:"version-title"},"条目版本",-1))),an=x("查看"),tn={class:"log"},ln=kl((()=>r("div",{class:"log-title"},"日志",-1)));var nn=Na(e({name:"ArticleDetail",setup(e){var a;const c=Ue();Ae();const{id:u=""}=c.query,p=i({DEFAULT_AVATAR:null==(a=Ta)?void 0:a.defaultAvatar}),m=[{title:"版本",dataIndex:"version"},{title:"修订人",dataIndex:"creator"},{title:"修订时间",dataIndex:"createTime"},{title:"操作",dataIndex:"operation"}],h=[{title:"类型",dataIndex:"logType",customRender:({text:e})=>0===e?"分享":"下载"},{title:"附件名称",dataIndex:"accessoryName",customRender:({text:e})=>null!=e?e:"-"},{title:"操作人",dataIndex:"userName"},{title:"操作时间",dataIndex:"createTime"}],_=k([]),w=k(0),C=k(!1),I=k({evaluate:0,accessory:"",archiveStatus:0,content:"",createTime:"",knowledgeName:"",knowledgeTypeName:"",labels:[],relateds:[],securityLevelName:"",expirationType:"",endTime:"",collectStatus:0,creator:"",user:{},archiveUserName:"",logs:[],knowledgeFlag:0}),T=async()=>{var e;const a=await mt({id:u});I.value=a;const t=null==(e=a.accessory)?void 0:e.split(",");_.value=t&&t.map((e=>{const a=e.split("/");return a[a.length-1]})),I.value.knowledgeTypeName=a.knowledgeTypeName.split(",").join("-"),w.value=a.evaluate},N=async()=>{const e=await(a={knowledgeId:u},Ka("base/rate/check/state",a));var a;C.value=e},{onSearch:L,pagination:R,dataSource:U,getList:S,onTableChange:F}=Ja({fetchData:rt,formatParams:()=>({knowledgeId:u})});b((async()=>{await T(),await N()}));const A=async()=>{const e={knowledgeId:u};if(1===I.value.collectStatus)return await sl(e),Y.success("取消收藏成功！"),void(I.value.collectStatus=0);var a;await(a=e,Ka("/base/collection",a)),Y.success("收藏成功！"),I.value.collectStatus=1},{correctState:D,handleOpenCorrectDialog:O,handleCloseCorrectDialog:j}=function(e){const a=i({visible:!1,id:e});return{correctState:a,handleOpenCorrectDialog:()=>{a.visible=!0},handleCloseCorrectDialog:()=>{a.visible=!1}}}(u),{viewContentState:q,handleViewContent:K,handleCloseViewContentDialog:M}=function(){const e=i({visible:!1,content:""});return{viewContentState:e,handleViewContent:a=>{e.visible=!0,e.content=a},handleCloseViewContentDialog:()=>{e.visible=!1}}}(),{rateState:E,handleRate:P,handleCloseRateDialog:z}=function(e){const a=i({visible:!1,id:e});return{rateState:a,handleRate:()=>{a.visible=!0},handleCloseRateDialog:()=>{a.visible=!1}}}(u),B=()=>{T(),N()},{share:$}=dt();return(e,a)=>{const i=ne,c=ae,k=we,b=ie,T=V,N=ce,L=Z;return o(),f(g,null,[s(L,null,{default:l((()=>[s(c,null,{default:l((()=>[s(i,{span:16},{default:l((()=>[s(c,{class:"mb24"},{default:l((()=>[s(i,{span:12,class:"title"},{default:l((()=>[x(d(I.value.knowledgeName),1)])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:12},{default:l((()=>[s(k,{value:w.value,"onUpdate:value":a[0]||(a[0]=e=>w.value=e),"allow-half":"",disabled:""},null,8,["value"]),r("span",bl,d(w.value)+"分",1)])),_:1}),s(i,{span:12},{default:l((()=>[s(b,{type:"link",class:"mr10",onClick:A},{default:l((()=>[x(d(1===I.value.collectStatus?"取消收藏":"收藏"),1)])),_:1}),s(b,{type:"link",class:"mr10",onClick:a[1]||(a[1]=e=>n($)({id:n(u),title:I.value.knowledgeName,type:I.value.knowledgeFlag,endTime:"0"===I.value.expirationType?"永久有效":I.value.endTime}))},{default:l((()=>[hl])),_:1}),s(b,{type:"link",class:"mr10",onClick:n(O)},{default:l((()=>[_l])),_:1},8,["onClick"]),s(b,{type:"link",onClick:n(P),disabled:C.value},{default:l((()=>[x(d(C.value?"已评价":"评价"),1)])),_:1},8,["onClick","disabled"])])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:12},{default:l((()=>[wl,r("span",Cl,d(I.value.knowledgeTypeName),1)])),_:1}),s(i,{span:12},{default:l((()=>[xl,r("span",Il,d(I.value.securityLevelName),1)])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:12},{default:l((()=>[Tl,r("span",Nl,d(I.value.creator),1)])),_:1}),s(i,{span:12},{default:l((()=>[Ll,r("span",Rl,d(I.value.createTime),1)])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:12},{default:l((()=>[Ul,r("span",Sl,d("0"===I.value.expirationType?"永久有效":I.value.endTime),1)])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:23},{default:l((()=>[Fl,r("div",{class:"value editor-content-view",innerHTML:I.value.content},null,8,Al)])),_:1})])),_:1}),5!==I.value.knowledgeFlag?(o(),t(c,{key:0,class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[Dl])),_:1}),s(i,{span:19},{default:l((()=>[(o(!0),f(g,null,v(_.value,((e,a)=>(o(),t(c,null,{default:l((()=>[s(i,{span:17},{default:l((()=>[r("a",{class:"file",href:I.value.accessory.split(",")[a],target:"_blank"},d(e),9,Ol)])),_:2},1024),s(i,{span:2},{default:l((()=>[s(b,{class:"link-btn",type:"link",onClick:e=>(async e=>{const a=I.value.accessory.split(",");il(a[e],_.value[e]),await it({accessoryName:_.value[e],knowledgeId:u,logType:1})})(a)},{default:l((()=>[jl])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),256))])),_:1})])),_:1})):y("",!0),5!==I.value.knowledgeFlag?(o(),t(c,{key:1,class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[ql])),_:1}),s(i,{span:19},{default:l((()=>[(o(!0),f(g,null,v(I.value.relateds,(e=>(o(),f("div",Kl,d(e.knowledgeName),1)))),256))])),_:1})])),_:1})):y("",!0)])),_:1}),s(i,{span:8},{default:l((()=>[r("div",Ml,[s(T,{src:n(p).DEFAULT_AVATAR},null,8,["src"]),r("div",Vl,d(I.value.creator),1)]),s(n(la)),r("div",El,[Pl,s(c,{class:"mb10"},{default:l((()=>[s(i,{span:12},{default:l((()=>[zl])),_:1}),s(i,{span:12},{default:l((()=>[r("span",Yl,d(I.value.user.deptName),1)])),_:1})])),_:1}),s(c,{class:"mb10"},{default:l((()=>[s(i,{span:12},{default:l((()=>[Bl])),_:1}),s(i,{span:12},{default:l((()=>[r("span",$l,d(0===I.value.user.sex?"男":"女"),1)])),_:1})])),_:1}),s(c,{class:"mb10"},{default:l((()=>[s(i,{span:12},{default:l((()=>[Hl])),_:1}),s(i,{span:12},{default:l((()=>[r("span",Gl,d(I.value.user.moblie),1)])),_:1})])),_:1}),s(c,{class:"mb10"},{default:l((()=>[s(i,{span:12},{default:l((()=>[Jl])),_:1}),s(i,{span:12},{default:l((()=>[r("span",Wl,d(I.value.user.updateTime),1)])),_:1})])),_:1}),s(c,{class:"mb10"},{default:l((()=>[s(i,{span:12},{default:l((()=>[Xl])),_:1}),s(i,{span:12},{default:l((()=>[r("span",Ql,d(I.value.user.higherUp),1)])),_:1})])),_:1})]),r("div",Zl,[en,s(N,{columns:m,"data-source":I.value.logs,bordered:""},{bodyCell:l((({column:e,text:a,record:s})=>["operation"===e.dataIndex?(o(),t(b,{key:0,type:"link",class:"action-btn",onClick:e=>n(K)(s.content)},{default:l((()=>[an])),_:2},1032,["onClick"])):y("",!0)])),_:1},8,["data-source"])]),r("div",tn,[ln,s(N,{rowKey:"id",columns:h,"data-source":n(U),pagination:n(R),bordered:"",onChange:n(F)},null,8,["data-source","pagination","onChange"])])])),_:1})])),_:1})])),_:1}),n(D).visible?(o(),t(pl,{key:0,id:n(u),onCancel:n(j)},null,8,["id","onCancel"])):y("",!0),n(q).visible?(o(),t(vl,{key:1,content:n(q).content,onCancel:n(M)},null,8,["content","onCancel"])):y("",!0),n(E).visible?(o(),t(yl,{key:2,knowledgeId:n(E).id,onSuccess:B,onCancel:n(z)},null,8,["knowledgeId","onCancel"])):y("",!0)],64)}}}),[["__scopeId","data-v-7df77338"]]);const on=e=>Ka("/user/query",e),sn=e=>Ka("/role/query",e),rn=e({props:{info:null},emits:["success","cancel"],setup(e,{emit:a}){const n=e,{info:i}=u(n),r=k([]),c=k([]);(async()=>{const{records:e}=await sn({});c.value=e.map((({roleName:e,roleDesc:a,id:t})=>({label:`${e}（${a}）`,value:t})))})();const p=async()=>{const e={userIds:i.value.map((e=>e.puserId)).join(","),roleIds:r.value.join(",")};var t;await(t=e,Ma("/user/set/role",t)),Y.success("设置成功"),a("success"),m()},m=()=>{a("cancel",!1)};return(e,a)=>{const n=xe,i=ne,u=ae,y=Ce,k=ue;return o(),t(k,{title:"设置角色",visible:!0,closable:!1,width:"600px",destroyOnClose:!0,onOk:p,onCancel:m},{default:l((()=>[s(y,{value:r.value,"onUpdate:value":a[0]||(a[0]=e=>r.value=e)},{default:l((()=>[(o(!0),f(g,null,v(c.value,(e=>(o(),t(u,null,{default:l((()=>[s(i,{span:24},{default:l((()=>[s(n,{value:e.value},{default:l((()=>[x(d(e.label),1)])),_:2},1032,["value"])])),_:2},1024)])),_:2},1024)))),256))])),_:1},8,["value"])])),_:1})}}}),dn=x(" 确认回收该用户所有权限？ "),cn=e({props:{info:null},emits:["success","cancel"],setup(e,{emit:a}){const n=e,{info:s}=u(n),i=async()=>{const e={userIds:s.value.map((e=>e.id)).join(",")};var t;await(t=e,Ka("/user/del/role",t)),Y.success("回收成功"),a("success"),r()},r=()=>{a("cancel",!1)};return(e,a)=>{const n=ue;return o(),t(n,{visible:!0,closable:!1,width:"400px",destroyOnClose:!0,onOk:i,onCancel:r},{default:l((()=>[dn])),_:1})}}});const un=x("查询"),pn=x("重置"),mn=x("设置角色"),fn=x("回收权限"),vn=x("查看操作日志");var gn=Na(e({name:"UserList",setup(e){const a=k([{label:"超级管理员",value:"00"},{label:"子系统管理员",value:"01"},{label:"业务导员",value:"02"},{label:"局领导",value:"03"}]),r=[{title:"账号",dataIndex:"account",key:"account",align:"center"},{title:"姓名",dataIndex:"userName",key:"userName",align:"center"},{title:"职务",dataIndex:"position",key:"position",align:"center"},{title:"办公室电话",dataIndex:"officeTelephone",key:"officeTelephone",align:"center"},{title:"手机号",dataIndex:"moblie",key:"moblie",align:"center"},{title:"直接上级",dataIndex:"higherUp",key:"higherUp",align:"center"},{title:"系统角色",dataIndex:"roleName",key:"roleName",align:"center"}],d=k([]),c=i([]),u=k([]),p=i({userName:"",rid:[]});R(u,(e=>{u.value.length>0?p.deptId=u.value[0]:p.deptId=""}));const m={onChange:(e,a)=>{d.value=a}},{onSearch:v,onReset:g,pagination:b,dataSource:h,searchFormRef:_,onTableChange:w,getList:C}=Ja({fetchData:on,formatParams:()=>({...p})});(async()=>{const e=await Ka("/dept/tree/query");Object.assign(c,e)})();const x=i({visible:!1}),I=()=>{x.visible=!0},T=()=>{x.visible=!1},N=i({visible:!1}),L=()=>{N.visible=!0},U=()=>{N.visible=!1};return(e,i)=>{const k=te,R=le,S=ne,F=Ie,A=ie,D=re,O=ae,j=de,q=Z,K=Te,M=ce;return o(),f("div",null,[s(q,{class:"search-box"},{default:l((()=>[s(j,{ref_key:"searchFormRef",ref:_,layout:"inline",model:n(p)},{default:l((()=>[s(O,{gutter:[24,16]},{default:l((()=>[s(S,null,{default:l((()=>[s(R,{label:"姓名",name:"userName"},{default:l((()=>[s(k,{value:n(p).userName,"onUpdate:value":i[0]||(i[0]=e=>n(p).userName=e),valueModifiers:{trim:!0},placeholder:"请输入姓名",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(S,null,{default:l((()=>[s(R,{label:"角色",name:"rid"},{default:l((()=>[s(F,{style:{"min-width":"250px"},value:n(p).rid,"onUpdate:value":i[1]||(i[1]=e=>n(p).rid=e),options:a.value,placeholder:"请选择角色","allow-clear":""},null,8,["value","options"])])),_:1})])),_:1}),s(S,null,{default:l((()=>[s(R,null,{default:l((()=>[s(D,{size:20},{default:l((()=>[s(A,{type:"primary",onClick:n(v)},{default:l((()=>[un])),_:1},8,["onClick"]),s(A,{onClick:n(g)},{default:l((()=>[pn])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(O,{class:"mt20"},{default:l((()=>[s(S,{span:8},{default:l((()=>[s(q,{class:"mr15",title:"组织结构"},{default:l((()=>[s(K,{"tree-data":n(c),"field-names":{title:"deptName",key:"id",children:"children"},defaultExpandAll:"",selectedKeys:u.value,"onUpdate:selectedKeys":i[2]||(i[2]=e=>u.value=e)},null,8,["tree-data","selectedKeys"])])),_:1})])),_:1}),s(S,{span:16},{default:l((()=>[s(q,null,{default:l((()=>[s(O,{class:"action-btn-box"},{default:l((()=>[s(A,{class:"mr15",type:"primary",disabled:!d.value.length,onClick:L},{default:l((()=>[mn])),_:1},8,["disabled"]),s(A,{danger:"",onClick:I,disabled:!d.value.length},{default:l((()=>[fn])),_:1},8,["disabled"])])),_:1}),s(M,{rowKey:"id","row-selection":m,columns:r,"data-source":n(h),pagination:n(b),bordered:"",onChange:n(w)},{bodyCell:l((({column:e,record:a})=>["operation"===e.dataIndex?(o(),t(A,{key:0,type:"link",class:"action-btn",onClick:e=>{}},{default:l((()=>[vn])),_:2},1032,["onClick"])):y("",!0)])),_:1},8,["data-source","pagination","onChange"])])),_:1})])),_:1})])),_:1}),n(N).visible?(o(),t(rn,{key:0,info:d.value,onSuccess:n(C),onCancel:U},null,8,["info","onSuccess"])):y("",!0),n(x).visible?(o(),t(cn,{key:1,info:d.value,onSuccess:n(C),onCancel:T},null,8,["info","onSuccess"])):y("",!0)])}}}),[["__scopeId","data-v-1f0201ae"]]);const yn=e({props:{type:null,info:null},emits:["success","cancel"],setup(e,{emit:a}){const r=e,{type:d,info:c}=u(r),p=de.useForm,m=i({labelCol:{span:4},wrapperCol:{span:20}}),f=i({name:"",desc:""}),v=k([]),g=k([]),y=i({name:[{required:!0,message:"请填写角色名称！"}],desc:[{required:!1}],menu:[{required:!0,message:"请选择菜单项！"}]}),b=i([]),h={};(async()=>{const e=await Ka("/menu/tree/query");Object.assign(b,e);const a=e=>{e.forEach((({id:e,menuName:t,children:l})=>{h[e]=t,l&&l.length&&a(l)}))};a(e)})();const _=async()=>{var e,a;const{roleName:t,roleDesc:l,menus:n}=await(o={id:null!=(a=null==(e=null==c?void 0:c.value)?void 0:e.id)?a:""},Ka("/role/detail",o));var o;f.desc=l,f.name=t,v.value=n?n.filter((({status:e})=>"0"===e)).map((e=>e.menuId)):[],g.value=n?n.filter((({status:e})=>"1"===e)).map((e=>e.menuId)):[]};"update"===d.value&&_();const w=(e,a)=>{g.value=a.halfCheckedKeys},{resetFields:C,validate:x,validateInfos:I}=p(f,y),R=async e=>{var a,t;const{name:l,desc:n}=e,o=[];v.value.forEach((e=>{"可编辑"!==h[e]&&"仅查看"!==h[e]&&o.push(h[e])}));let s=v.value.map((e=>({menuId:e})));s=[...s,...g.value.map((e=>({menuId:e,status:1})))];const i={roleName:l,roleDesc:n,menuDTOS:s,roleModules:o.join(",")};if("create"===d.value)return await(r=i,Ma("/role/save",r));var r;const u={...i,id:null!=(t=null==(a=null==c?void 0:c.value)?void 0:a.id)?t:""};return await(e=>Ma("/role/update",e))(u)},U=async()=>{try{const e=await x();await R(e),Y.success("成功!"),a("success"),S()}catch(e){console.log("error",e)}},S=()=>{C(),a("cancel",!1)};return(e,a)=>{const i=te,r=le,c=_e,u=Te,p=de,g=ue;return o(),t(g,{visible:!0,title:"create"===n(d)?"新建角色":"更新角色",closable:!1,width:"600px",destroyOnClose:!0,onOk:U,onCancel:S},{default:l((()=>[s(p,N(L(n(m))),{default:l((()=>[s(r,T({label:"角色名称"},n(I).name),{default:l((()=>[s(i,{value:n(f).name,"onUpdate:value":a[0]||(a[0]=e=>n(f).name=e),placeholder:"请输入角色名称"},null,8,["value"])])),_:1},16),s(r,T({label:"角色描述"},n(I).desc),{default:l((()=>[s(c,{value:n(f).desc,"onUpdate:value":a[1]||(a[1]=e=>n(f).desc=e),rows:4,maxlength:6},null,8,["value"])])),_:1},16),s(r,T({label:"菜单列表"},n(I).menu),{default:l((()=>[s(u,{checkedKeys:v.value,"onUpdate:checkedKeys":a[2]||(a[2]=e=>v.value=e),checkable:"","tree-data":n(b),fieldNames:{children:"children",title:"menuName",key:"id"},onCheck:w},null,8,["checkedKeys","tree-data"])])),_:1},16)])),_:1},16)])),_:1},8,["title"])}}});const kn=x("查询"),bn=x("重置"),hn=x("新建"),_n=x("编辑"),wn=x("删除");var Cn=Na(e({name:"RoleList",setup(e){const a=[{title:"角色名称",dataIndex:"roleName",key:"roleName",align:"center"},{title:"模块",dataIndex:"roleModules",key:"roleModules",align:"center"},{title:"描述",dataIndex:"roleDesc",key:"roleDesc",align:"center"},{title:"操作",dataIndex:"operation",align:"center"}],r=i({roleName:""}),{onSearch:d,onReset:c,pagination:u,dataSource:p,searchFormRef:m,onTableChange:v,getList:k}=Ja({fetchData:sn,formatParams:()=>({...r})}),b=async({id:e})=>{var a;await(a={roleId:e},Ka("/role/del",a)),Y.success("删除成功！"),k()},h=i({visible:!1,currentRow:{},type:"create"}),_=(e,a)=>{h.visible=!0,h.type=e,a&&(h.currentRow=a)},w=()=>{h.visible=!1};return(e,i)=>{const C=te,x=le,I=ne,T=ie,N=re,L=ae,R=de,U=Z,S=ce;return o(),f("div",null,[s(U,{class:"search-box"},{default:l((()=>[s(R,{ref_key:"searchFormRef",ref:m,layout:"inline",model:n(r)},{default:l((()=>[s(L,{gutter:[24,16]},{default:l((()=>[s(I,null,{default:l((()=>[s(x,{label:"角色名称",name:"roleName"},{default:l((()=>[s(C,{value:n(r).roleName,"onUpdate:value":i[0]||(i[0]=e=>n(r).roleName=e),valueModifiers:{trim:!0},placeholder:"请输入角色名称",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(I,null,{default:l((()=>[s(x,null,{default:l((()=>[s(N,{size:20},{default:l((()=>[s(T,{type:"primary",onClick:n(d)},{default:l((()=>[kn])),_:1},8,["onClick"]),s(T,{onClick:n(c)},{default:l((()=>[bn])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(U,null,{default:l((()=>[s(L,{class:"action-btn-box"},{default:l((()=>[s(T,{style:{"background-color":"#36bc62","border-color":"#36bc62"},type:"primary",onClick:i[1]||(i[1]=e=>_("create"))},{default:l((()=>[hn])),_:1})])),_:1}),s(S,{rowKey:"id",columns:a,"data-source":n(p),pagination:n(u),bordered:"",onChange:n(v)},{bodyCell:l((({column:e,record:a})=>["operation"===e.dataIndex?(o(),f(g,{key:0},[s(T,{type:"link",class:"action-btn",onClick:e=>_("update",a)},{default:l((()=>[_n])),_:2},1032,["onClick"]),s(T,{type:"link",class:"action-btn",onClick:e=>b(a)},{default:l((()=>[wn])),_:2},1032,["onClick"])],64)):y("",!0)])),_:1},8,["data-source","pagination","onChange"])])),_:1}),n(h).visible?(o(),t(yn,{key:0,type:n(h).type,info:n(h).currentRow,onSuccess:n(k),onCancel:w},null,8,["type","info","onSuccess"])):y("",!0)])}}}),[["__scopeId","data-v-22c78eb9"]]);const xn=e({props:{type:null,category:null,id:null,name:null},emits:["success","cancel"],setup(e,{emit:a}){const r=e,{type:d,name:c,category:p,id:m}=u(r),f=de.useForm,v=i({labelCol:{span:4},wrapperCol:{span:20}}),g=i({name:"update"===d.value?c.value:""}),y=i({name:[{required:!0,message:"请填写名称！"}]}),{resetFields:k,validate:b,validateInfos:h}=f(g,y),_=async e=>{return"create"===d.value?await(a={dictName:e.name,dictPid:m.value,dictType:p.value},Ma("/dict/add",a)):await(e=>Ma("/dict/update",e))({dictName:e.name,id:m.value,dictType:p.value});var a},w=async()=>{try{const e=await b();await _(e),Y.success("成功！"),a("success"),C()}catch(e){console.log("error",e)}},C=()=>{k(),a("cancel",!1)};return(e,a)=>{const i=te,r=le,c=de,u=ue;return o(),t(u,{visible:!0,title:"create"===n(d)?"新建":"更新",closable:!1,width:"400px",destroyOnClose:!0,onOk:w,onCancel:C},{default:l((()=>[s(c,N(L(n(v))),{default:l((()=>[s(r,T({label:"名称"},n(h).name),{default:l((()=>[s(i,{value:n(g).name,"onUpdate:value":a[0]||(a[0]=e=>n(g).name=e),placeholder:"请输入名称"},null,8,["value"])])),_:1},16)])),_:1},16)])),_:1},8,["title"])}}});const In=x("新建"),Tn={class:"custom-tree-node"},Nn=e({name:"Dictionary",setup(e){const a=i({status:"1"}),c=k([]),u=async()=>{const e=await Za({type:a.status});c.value=e};u();const p=()=>{u()},m=i({visible:!1,id:"",type:"create",category:"0",name:""}),b=(e,t)=>{var l;const n={visible:!0,id:null!=(l=null==t?void 0:t.id)?l:"",type:e,category:a.status,name:"update"===e?t&&t.dictName:""};Object.assign(m,n),u()},h=async(e,a)=>{await(e=>Ka("/dict/del",e))({id:a.id+""}),Y.success("删除成功！"),u()},_=()=>{m.visible=!1,u()};return(e,i)=>{const u=X,k=Q,w=Z,C=ie,x=ae,I=fe;return o(),f("div",null,[s(w,{class:"search-box-wrap mt15"},{default:l((()=>[s(k,{activeKey:n(a).status,"onUpdate:activeKey":i[0]||(i[0]=e=>n(a).status=e),type:"card",tabBarGutter:6,class:"search-tabs",onChange:p},{default:l((()=>[(o(!0),f(g,null,v(n(Qa),(e=>(o(),t(u,{key:e.value,tab:e.label},null,8,["tab"])))),128))])),_:1},8,["activeKey"])])),_:1}),s(w,{class:"table-box mt20"},{default:l((()=>["1"===n(a).status?(o(),t(x,{key:0,class:"action-btn-box"},{default:l((()=>[s(C,{style:{"background-color":"#36bc62","border-color":"#36bc62"},type:"primary",onClick:i[1]||(i[1]=e=>b("create"))},{default:l((()=>[In])),_:1})])),_:1})):y("",!0),c.value.length?(o(),t(n(ta),{key:2,data:c.value,"node-key":"id","default-expand-all":"","expand-on-click-node":!1,props:{label:"dictName"}},O({_:2},["1"===n(a).status?{name:"default",fn:l((({node:e,data:a})=>[r("span",Tn,[r("span",null,d(e.label),1),r("span",null,[s(n($e),{onClick:e=>b("create",a),class:"mr5"},null,8,["onClick"]),s(n(He),{onClick:e=>b("update",a),class:"mr5"},null,8,["onClick"]),s(I,{title:"确定要删除该节点吗?","ok-text":"确认","cancel-text":"取消",onConfirm:e=>h(0,a),onCancel:i[2]||(i[2]=()=>{})},{default:l((()=>[s(n(Ge))])),_:2},1032,["onConfirm"])])])]))}:void 0]),1032,["data"])):(o(),t(n(aa),{key:1,"image-size":200,description:"暂无数据"}))])),_:1}),n(m).visible?(o(),t(xn,{key:0,type:n(m).type,category:n(m).category,id:n(m).id,name:n(m).name,onSuccess:i[3]||(i[3]=()=>{}),onCancel:_},null,8,["type","category","id","name"])):y("",!0)])}}});const Ln=x("查询"),Rn=x("重置"),Un=x("取消收藏 "),Sn=x("分享");var Fn=Na(e({name:"CollectionList",setup(e){Ae();const r=Ue(),c=Ea(),u=r.meta.key,m=p((()=>c.menuOperateAuthMap[u])),v=p((()=>{N.value;const e=[{title:"类型",dataIndex:"knowledgeFlag",key:"knowledgeFlag",align:"center",customRender:({text:e})=>Xa[e]},{title:"知识条目",dataIndex:"knowledgeName",key:"knowledgeName",align:"center"},{title:"分类",dataIndex:"knowledgeTypeName",key:"knowledgeTypeName",align:"center",customRender:({text:e})=>e?e.split(", ").join("-"):""},{title:"评分",dataIndex:"evaluate",key:"evaluate",align:"center"},{title:"收藏时间",dataIndex:"createTime",key:"createTime",align:"center"},{title:"操作",dataIndex:"operation",align:"center"}];return m.value||e.pop(),e})),k=i({knowledgeName:""}),{onSearch:b,onReset:h,pagination:_,dataSource:w,getList:C,searchFormRef:I,onTableChange:T,sortedInfo:N}=Ja({fetchData:ol,formatParams:()=>({...k})}),{share:L}=dt();return(e,i)=>{const r=te,c=le,u=ne,p=ie,m=re,N=ae,R=de,U=Z,S=a("router-link"),F=ce;return o(),f("div",null,[s(U,{class:"search-box"},{default:l((()=>[s(R,{ref_key:"searchFormRef",ref:I,layout:"inline",model:n(k)},{default:l((()=>[s(N,{gutter:[24,16]},{default:l((()=>[s(u,null,{default:l((()=>[s(c,{label:"条目标题",name:"knowledgeName"},{default:l((()=>[s(r,{value:n(k).knowledgeName,"onUpdate:value":i[0]||(i[0]=e=>n(k).knowledgeName=e),valueModifiers:{trim:!0},placeholder:"请输入条目标题",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(u,null,{default:l((()=>[s(c,null,{default:l((()=>[s(m,{size:20},{default:l((()=>[s(p,{type:"primary",onClick:n(b)},{default:l((()=>[Ln])),_:1},8,["onClick"]),s(p,{onClick:n(h)},{default:l((()=>[Rn])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(U,{class:"table-box mt20"},{default:l((()=>[s(F,{rowKey:"id",columns:n(v),"data-source":n(w),pagination:n(_),bordered:"",onChange:n(T)},{bodyCell:l((({column:e,text:a,record:i})=>["knowledgeName"===e.dataIndex?(o(),t(S,{key:0,to:{name:"ArticleDetail",query:{id:i.id}}},{default:l((()=>[x(d(a),1)])),_:2},1032,["to"])):y("",!0),"operation"===e.dataIndex?(o(),f(g,{key:1},[s(p,{type:"link",class:"action-btn",onClick:e=>(async e=>{await sl({knowledgeId:e.id}),Y.success("取消收藏成功"),C()})({id:i.id})},{default:l((()=>[Un])),_:2},1032,["onClick"]),s(p,{type:"link",class:"action-btn",onClick:e=>n(L)({id:i.id,title:i.knowledgeName,type:i.knowledgeFlag,endTime:"0"===i.expirationType?"永久有效":i.endTime})},{default:l((()=>[Sn])),_:2},1032,["onClick"])],64)):y("",!0)])),_:1},8,["columns","data-source","pagination","onChange"])])),_:1})])}}}),[["__scopeId","data-v-55dba0da"]]);const An=e=>(A("data-v-f8c94e24"),e=e(),D(),e),Dn=An((()=>r("div",null,"纠错内容:",-1))),On=An((()=>r("div",null,"补充图片:",-1))),jn=An((()=>r("span",{class:"label"},"附件列表: ",-1))),qn={class:"file"},Kn=x("下载"),Mn=An((()=>r("div",null,"纠错人:",-1))),Vn=An((()=>r("div",null,"纠错时间:",-1))),En=x("关闭");var Pn=Na(e({props:{id:null},emits:["success","cancel"],setup(e,{emit:a}){const c=e,p=k([]),m=i({accessory:"",content:"",createTime:"",id:"",knowledgeId:"",opUser:"",picture:"",userId:""}),h=k([]),{id:_}=u(c),w=async()=>{const e=await(a={knowledgeId:_.value},Ka("/base/error/correction/detail",a));var a;Object.assign(m,e);const t=e.accessory.split(",");if(p.value=t.map((e=>{const a=e.split("/");return a[a.length-1]})),e.picture){const e=m.picture.split(",");h.value=Da(e)}};b((()=>{w()}));const C=()=>{a("success"),I()},I=()=>{a("cancel")};return(e,a)=>{const i=ne,c=ae,u=ie,k=ue;return o(),t(k,{title:"查看",visible:!0,maskClosable:!1,closable:!1,width:"600px",destroyOnClose:"",onOk:C,onCancel:I},{footer:l((()=>[s(u,{key:"back",onClick:I},{default:l((()=>[En])),_:1})])),default:l((()=>[s(c,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[Dn])),_:1}),s(i,{span:19},{default:l((()=>[x(d(n(m).content),1)])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[On])),_:1}),s(i,{span:19},{default:l((()=>[s(Dt,{disabled:"",type:"1",modelValue:h.value,"max-length":h.value.length},null,8,["modelValue","max-length"])])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[jn])),_:1}),s(i,{span:19},{default:l((()=>[(o(!0),f(g,null,v(p.value,((e,a)=>(o(),t(c,null,{default:l((()=>[s(i,{span:17},{default:l((()=>[r("div",qn,d(e),1)])),_:2},1024),s(i,{span:2},{default:l((()=>[e?(o(),t(u,{key:0,class:"link-btn",type:"link",onClick:e=>(e=>{const a=m.accessory.split(",");il(a[e],p.value[e])})(a)},{default:l((()=>[Kn])),_:2},1032,["onClick"])):y("",!0)])),_:2},1024)])),_:2},1024)))),256))])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[Mn])),_:1}),s(i,{span:19},{default:l((()=>[x(d(n(m).opUser),1)])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[Vn])),_:1}),s(i,{span:19},{default:l((()=>[x(d(n(m).createTime),1)])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-f8c94e24"]]);const zn=x("查询"),Yn=x("重置"),Bn=x("查看 "),$n=x("删除");var Hn=Na(e({name:"CorrectionList",setup(e){Ae();const c=Ue(),u=Ea(),m=c.meta.key,v=p((()=>u.menuOperateAuthMap[m])),k=p((()=>{L.value;const e=[{title:"类型",dataIndex:"knowledgeFlag",key:"knowledgeFlag",align:"center",customRender:({text:e})=>Xa[e]},{title:"知识条目",dataIndex:"knowledgeName",key:"knowledgeName",align:"center"},{title:"分类",dataIndex:"knowledgeTypeName",key:"knowledgeTypeName",align:"center",customRender:({text:e})=>e?e.split(", ").join("-"):""},{title:"纠错时间",dataIndex:"createTime",key:"createTime",align:"center"},{title:"操作",dataIndex:"operation",align:"center"}];return v.value||e.pop(),e})),b=i({knowledgeName:""}),{onSearch:h,onReset:_,pagination:w,dataSource:C,getList:I,searchFormRef:T,onTableChange:N,sortedInfo:L}=Ja({fetchData:rl,formatParams:()=>({...b})}),R=i({visible:!1,id:"1"}),U=()=>{R.visible=!1},S=async e=>{var a;await(a={knowledgeId:e.id},Ka("/base/error/correction/del",a)),Y.success("删除成功"),I()};return(e,i)=>{const c=te,u=le,p=ne,m=ie,v=re,I=ae,L=de,F=Z,A=a("router-link"),D=fe,O=ce;return o(),f(g,null,[r("div",null,[s(F,{class:"search-box"},{default:l((()=>[s(L,{ref_key:"searchFormRef",ref:T,layout:"inline",model:n(b)},{default:l((()=>[s(I,{gutter:[24,16]},{default:l((()=>[s(p,null,{default:l((()=>[s(u,{label:"条目标题",name:"knowledgeName"},{default:l((()=>[s(c,{value:n(b).knowledgeName,"onUpdate:value":i[0]||(i[0]=e=>n(b).knowledgeName=e),valueModifiers:{trim:!0},placeholder:"请输入条目标题",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(p,null,{default:l((()=>[s(u,null,{default:l((()=>[s(v,{size:20},{default:l((()=>[s(m,{type:"primary",onClick:n(h)},{default:l((()=>[zn])),_:1},8,["onClick"]),s(m,{onClick:n(_)},{default:l((()=>[Yn])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(F,{class:"table-box mt20"},{default:l((()=>[s(O,{rowKey:"id",columns:n(k),"data-source":n(C),pagination:n(w),bordered:"",onChange:n(N)},{bodyCell:l((({column:e,text:a,record:n})=>["knowledgeName"===e.dataIndex?(o(),t(A,{key:0,to:{name:"ArticleDetail",query:{id:n.id}}},{default:l((()=>[x(d(a),1)])),_:2},1032,["to"])):y("",!0),"operation"===e.dataIndex?(o(),f(g,{key:1},[s(m,{type:"link",class:"action-btn",onClick:e=>(e=>{R.visible=!0,R.id=e.id})({id:n.id})},{default:l((()=>[Bn])),_:2},1032,["onClick"]),s(D,{title:"确定要删除该条目吗?","ok-text":"确认","cancel-text":"取消",onConfirm:e=>S({id:n.id}),onCancel:i[1]||(i[1]=()=>{})},{default:l((()=>[s(m,{type:"link",class:"action-btn"},{default:l((()=>[$n])),_:1})])),_:2},1032,["onConfirm"])],64)):y("",!0)])),_:1},8,["columns","data-source","pagination","onChange"])])),_:1})]),n(R).visible?(o(),t(Pn,{key:0,id:n(R).id,onCancel:U},null,8,["id"])):y("",!0)],64)}}}),[["__scopeId","data-v-5f84ca7e"]]);const Gn=()=>{const e=k({title:{text:"知识数量统计",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} 个"},xAxis:{type:"category",data:[""],axisLabel:{interval:0,rotate:-38}},yAxis:{type:"value"},series:[{name:"知识数量统计",type:"bar",data:[0]}]});return{countStatisticalOption:e,fetchKnowledgeNumber:async a=>{const t=await(l=a,Ka("/dict/statistics/type/knowledge/number",l));var l;const n=[],o=[];t.forEach((e=>{n.push(e.dictName),o.push(e.num)})),e.value.xAxis.data=n,e.value.series[0].data=o}}},Jn=(e,a,t)=>{const l=[],n=[];return e.forEach((e=>{if("2"===a.timeType){const a=ia().set("month",Number(e.xAxisData)).format("YYYY-MM");l.push(a)}else"flag"===t?l.push(Xa[e.xAxisData]):l.push(e.xAxisData);n.push(e.num)})),{xAxisData:l,seriesData:n}},Wn=()=>{const e=k({title:{text:"知识数量增长趋势",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} 个"},xAxis:{type:"category",data:[""],axisLabel:{interval:0,rotate:-38}},yAxis:{type:"value"},series:[{name:"知识数量增长趋势",type:"line",data:[0]}]});return{countTrendOption:e,fetchDateRangeCount:async a=>{const t=await(l=a,Ka("/base/statistics/increase",l));var l;const{xAxisData:n,seriesData:o}=Jn(t,a);e.value.xAxis.data=n,e.value.series[0].data=o}}},Xn=()=>{const e=k({title:{text:"知识类型数量统计",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} 个"},xAxis:{type:"category",data:["专题","图片","视频","文件"]},yAxis:{type:"value"},series:[{name:"知识类型数量统计",type:"bar",data:[120,200,150,80]}]});return{typeCountStatisticalOption:e,fetchKnowledgeTypeNumber:async a=>{const t=await(l=a,Ka("/dict/statistics/knowledge/flag/number",l));var l;const{xAxisData:n,seriesData:o}=Jn(t,a,"flag");e.value.xAxis.data=n,e.value.series[0].data=o}}},Qn=()=>{const e=[{title:"序号",dataIndex:"index",align:"center",width:80,customRender:({index:e})=>e+1},{title:"条目",dataIndex:"knowledgeName",align:"center"},{title:"类型",dataIndex:"knowledgeFlag",key:"knowledgeFlag",align:"center",customRender:({text:e})=>Xa[e]},{title:"分类",dataIndex:"knowledgeTypeName",key:"knowledgeTypeName",align:"center",customRender:({text:e})=>e?e.split(", ").join("-"):""},{title:"创建人",dataIndex:"creator",align:"center"},{title:"评价",dataIndex:"evaluate",align:"center"},{title:"浏览量",dataIndex:"browseNum",align:"center"}],a=k([]);return{columns:e,topData:a,fetchTopData:async()=>{const{records:e}=await Ka("base/query/ranking");a.value=e}}},Zn=()=>{const e=k([]);return{employeeContributionRankingColumns:[{title:"序号",dataIndex:"index",align:"center",width:80,customRender:({index:e})=>e+1},{title:"姓名",dataIndex:"userName",align:"center"},{title:"科室",dataIndex:"deptName",align:"center"},{title:"数量",dataIndex:"num",align:"center"}],employeeContributionData:e,fetchEmployeeContributionData:async a=>{const t=await(l=a,Ka("/user/statistics/user/create/knowledge/num",l));var l;e.value=t}}},eo=()=>{const e=k({title:{text:"科室贡献",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:[""]},series:[{name:"科室贡献",type:"pie",radius:"55%",center:["50%","60%"],data:[{}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]});return{departmentContributionOption:e,fetchDepartmentContributionData:async a=>{const t=await(l=a,Ka("/dept/statistics/dept/create/knowledge/ration",l));var l;e.value.series[0].data=t.map((e=>({value:e.num,name:e.xAxisData}))),e.value.legend.data=t.map((e=>e.xAxisData))}}};const ao=e=>(A("data-v-19ae7d02"),e=e(),D(),e),to=x("本周"),lo=x("本月"),no=x("本年"),oo=x("自定义时间范围"),so=ao((()=>r("div",{class:"title mb15"},"热门排行榜",-1))),io=ao((()=>r("div",{class:"title mb15"},"员工贡献排行榜",-1)));const ro=[{path:"/",component:Ya,meta:{title:"知识首页",icon:"HomeFilled",level:"1",key:"Home"},children:[{path:"",name:"Home",component:st}]},{path:"/myKnowledge",name:"myKnowledge",component:Ya,meta:{title:"我的知识",icon:"BookFilled"},children:[{path:"knowledge",name:"KnowledgeList",meta:{title:"我的知识",keepAlive:!0,key:"KnowledgeList"},component:Nt},{path:"create",name:"KnowledgeCreate",meta:{title:"创建知识",isMenu:!1,keepAlive:!1},component:Xt},{path:"create-topic",name:"KnowledgeCreateTopic",meta:{title:"创建标题",isMenu:!1,keepAlive:!1},component:nl},{path:"article-detail",name:"ArticleDetail",meta:{title:"详情",isMenu:!1,keepAlive:!1},component:nn},{path:"collection",name:"CollectionList",meta:{title:"我的收藏",keepAlive:!0,key:"CollectionList"},component:Fn},{path:"correction",name:"CorrectionList",meta:{title:"我的纠错",keepAlive:!0,key:"CorrectionList"},component:Hn}]},{path:"/statistical",component:Ya,meta:{title:"统计报表",icon:"PieChartFilled",level:"1",key:"Statistical"},children:[{path:"",name:"Statistical",component:Na(e({name:"Statistical",setup(e){const r=k("0"),c="YYYY-MM-DD",u=ia().startOf("month").format(c),p=ia().endOf("month").format(c),m=k([u,p]),{countStatisticalOption:f,fetchKnowledgeNumber:v}=Gn(),{countTrendOption:g,fetchDateRangeCount:b}=Wn(),{typeCountStatisticalOption:h,fetchKnowledgeTypeNumber:_}=Xn(),{columns:w,topData:C,fetchTopData:I}=Qn(),{employeeContributionRankingColumns:T,employeeContributionData:N,fetchEmployeeContributionData:L}=Zn(),{departmentContributionOption:R,fetchDepartmentContributionData:U}=eo();return j((()=>{const e=i({timeType:r.value});"3"===r.value&&(e.startTime=m.value[0],e.endTime=m.value[1]),(e=>{v(e),b(e),_(e),I(),L(e),U(e)})(e)})),(e,i)=>{const u=ge,p=ye,v=se,k=a("v-chart"),b=ne,_=ae,I=a("router-link"),L=ce,U=Z;return o(),t(U,null,{default:l((()=>[s(p,{class:"mb50 mr10",value:r.value,"onUpdate:value":i[0]||(i[0]=e=>r.value=e)},{default:l((()=>[s(u,{value:"0"},{default:l((()=>[to])),_:1}),s(u,{value:"1"},{default:l((()=>[lo])),_:1}),s(u,{value:"2"},{default:l((()=>[no])),_:1}),s(u,{value:"3"},{default:l((()=>[oo])),_:1})])),_:1},8,["value"]),"3"===r.value?(o(),t(v,{key:0,value:m.value,"onUpdate:value":i[1]||(i[1]=e=>m.value=e),format:c,"value-format":c,valueFormat:"YYYY-MM-DD"},null,8,["value"])):y("",!0),s(_,{class:"mb24"},{default:l((()=>[s(b,{span:12},{default:l((()=>[s(k,{class:"chart",option:n(f)},null,8,["option"])])),_:1}),s(b,{span:12},{default:l((()=>[s(k,{class:"chart",option:n(g)},null,8,["option"])])),_:1})])),_:1}),s(_,{class:"mb24"},{default:l((()=>[s(b,{span:12},{default:l((()=>[s(k,{class:"chart",option:n(h)},null,8,["option"])])),_:1})])),_:1}),s(_,{class:"mb24"},{default:l((()=>[s(b,{span:24},{default:l((()=>[so,s(L,{columns:n(w),"data-source":n(C),bordered:"",pagination:!1},{bodyCell:l((({column:e,text:a,record:n})=>["knowledgeName"===e.dataIndex?(o(),t(I,{key:0,to:{name:"ArticleDetail",query:{id:n.id}}},{default:l((()=>[x(d(a),1)])),_:2},1032,["to"])):y("",!0)])),_:1},8,["columns","data-source"])])),_:1})])),_:1}),s(_,{class:"mb24"},{default:l((()=>[s(b,{span:12},{default:l((()=>[io,s(L,{columns:n(T),"data-source":n(N),bordered:"",pagination:!1},null,8,["columns","data-source"])])),_:1}),s(b,{span:12},{default:l((()=>[s(k,{class:"chart",option:n(R)},null,8,["option"])])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-19ae7d02"]])}]},{path:"/systemSetter",name:"systemSetter",component:Ya,meta:{title:"系统管理",icon:"SettingFilled"},children:[{path:"user",name:"UserList",meta:{title:"用户管理",keepAlive:!0,key:"UserList"},component:gn},{path:"role",name:"RoleList",meta:{title:"角色与权限",keepAlive:!0,key:"RoleList"},component:Cn},{path:"dictionary",name:"Dictionary",meta:{title:"数据字典",keepAlive:!1,key:"Dictionary"},component:Nn}]}],co=[{path:"/not-login",meta:{isMenu:!1},component:$a,children:[{path:"",component:Ha}]}],uo=De({history:Oe(),routes:[...ro,...co]});const po=We();(async()=>{ra([da,ca,ua,pa,ma,fa,va,ga]);const e=q(ya);!function(e){e.use(po)}(e),uo.beforeEach((async(e,a,t)=>{console.log("🚀 ~ file: permission.ts ~ line 10 ~ router.beforeEach ~ to ~ token",e.query.token);const l=localStorage.getItem("token");return co.some((({path:a})=>e.path===a))?t():l||e.query.token?(e.query.token&&localStorage.setItem("token",e.query.token),Ea().userInfo.pUserId||await Ea().getUserLogged(),await Ea().getMenuAuth(),t()):t({path:"/not-login"})})),uo.afterEach(((e,a)=>{!1===e.meta.isMenu&&window.scrollTo(0,0)})),e.use(Ne).use(uo).use(ha).use(xa).mount("#app"),e.component("v-chart",Le)})();
