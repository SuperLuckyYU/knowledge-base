import{d as e,ac as a,a2 as t,a3 as l,u as n,o,c as s,g as i,b as r,a6 as d,I as c,M as u,p,a8 as m,a as f,ad as v,F as y,a7 as g,r as k,e as b,ah as h,N as _,t as w,K as C,h as x,_ as I,ai as T,aj as N,w as L,s as R,A as U,S,ak as F,al as A,am as D,f as O,U as j}from"./@vue-b526e9a7.js";import{z as q,_ as K,A as M,D as V,a as P,b as E,m as z,c as Y,L as B,M as $,d as H,e as G,f as J,g as W,T as X,C as Q,h as Z,i as ee,I as ae,j as te,k as le,S as ne,R as oe,B as se,l as ie,F as re,n as de,o as ce,U as ue,p as pe,q as me,r as fe,s as ve,t as ye,u as ge,v as ke,w as be,x as he,y as _e,E as we,G as Ce,H as xe,J as Ie,K as Te,N as Ne}from"./ant-design-vue-bd8ca4f5.js";import{C as Le}from"./vue-echarts-d07ff7d2.js";import"./echarts-wordcloud-9c1875a5.js";import{C as Re}from"./clipboard-e8d95c39.js";import{u as Ue,o as Se,a as Fe,b as Ae,c as De,d as Oe}from"./vue-router-0183cbfe.js";import{a0 as je,a1 as qe,a2 as Ke,a3 as Me,a4 as Ve,a5 as Pe,a6 as Ee,f as ze,a7 as Ye,P as Be,G as $e,Q as He,M as Ge}from"./@ant-design-40c238bf.js";import{d as Je,c as We}from"./pinia-b21cc72f.js";import{a as Xe}from"./js-cookie-1db5286e.js";import{a as Qe}from"./axios-95009a82.js";import{m as Ze,c as ea,d as aa}from"./lodash-es-5953ec5c.js";import{E as ta,a as la,b as na}from"./element-plus-d759c790.js";import{V as oa}from"./vue-cropper-25aa6222.js";import{T as sa,E as ia}from"./@wangeditor-b05a5de4.js";import{d as ra}from"./dayjs-938c682c.js";import{u as da,a as ca,b as ua,c as pa,d as ma,e as fa,f as va,g as ya,h as ga}from"./echarts-7075129c.js";import"./@babel-81c9ad16.js";import"./resize-observer-polyfill-c24c855f.js";import"./vue-types-932461d1.js";import"./@ctrl-2e17fe3b.js";import"./dom-align-896e8735.js";import"./async-validator-efc2d198.js";import"./scroll-into-view-if-needed-4c99f3d7.js";import"./compute-scroll-into-view-6152c361.js";import"./resize-detector-94afada7.js";import"./vue-demi-5b9a0fa5.js";import"./@vueuse-1afec6d3.js";import"./@element-plus-531af0b3.js";import"./tslib-ed971494.js";import"./zrender-9f78e07a.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&a(e)})).observe(document,{childList:!0,subtree:!0})}function a(e){if(e.ep)return;e.ep=!0;const a=function(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerpolicy&&(a.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?a.credentials="include":"anonymous"===e.crossorigin?a.credentials="omit":a.credentials="same-origin",a}(e);fetch(e.href,a)}}();const ka=e({setup(e){const i=q;return(e,r)=>{const d=a("router-view"),c=K;return o(),t(c,{locale:n(i)},{default:l((()=>[s(d)])),_:1},8,["locale"])}}}),ba={autoSetContainer:!1,appendToBody:!0},ha=(e,a)=>new Promise((function(t,l){const n=document.createElement("button"),o=new Re(n,{text:function(){return e},action:function(){return"copy"},container:"object"==typeof a?a:document.body});o.on("success",(function(e){o.destroy(),t(e)})),o.on("error",(function(e){o.destroy(),l(e)})),ba.appendToBody&&document.body.appendChild(n),n.click(),ba.appendToBody&&document.body.removeChild(n)})),_a={install:function(e){e.config.globalProperties.$clipboardConfig=ba,e.config.globalProperties.$copyText=ha,e.directive("clipboard",{mounted:function(e,a){if("success"===a.arg)e._vClipboard_success=a.value;else if("error"===a.arg)e._vClipboard_error=a.value;else{const t=new Re(e,{text:function(){return a.value},action:function(){return"cut"===a.arg?"cut":"copy"},container:ba.autoSetContainer?e:void 0});t.on("success",(function(a){const t=e._vClipboard_success;t&&t(a)})),t.on("error",(function(a){const t=e._vClipboard_error;t&&t(a)})),e._vClipboard=t}},updated:function(e,a){"success"===a.arg?e._vClipboard_success=a.value:"error"===a.arg?e._vClipboard_error=a.value:(e._vClipboard.text=function(){return a.value},e._vClipboard.action=function(){return"cut"===a.arg?"cut":"copy"})},unmounted:function(e,a){"success"===a.arg?delete e._vClipboard_success:"error"===a.arg?delete e._vClipboard_error:(e._vClipboard.destroy(),delete e._vClipboard)}})},config:ba},wa=(e,a)=>{let t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download",a),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)};const Ca=(e,a)=>{if(!e)return;const t=function(e,a){let t=window.atob(e),l=t.length,n=new Uint8Array(l);for(;l--;)n[l]=t.charCodeAt(l);return new Blob([n],{type:a})}(e,"application/pdf"),l=window.URL.createObjectURL(t);wa(l,a)},xa=(e,a)=>{if(!e)return;const t=new Blob([e],{type:"application/pdf"}),l=window.URL.createObjectURL(t);wa(l,a)},Ia={install:function(e){e.config.globalProperties.$downloadFileByBase64=Ca,e.config.globalProperties.$downloadFileByFileFlow=xa}},Ta="知识库智能管理系统",Na={defaultAvatar:"//s.go2yd.com/a/thead_meiguoduizhang.png"};var La=(e,a)=>{const t=e.__vccOpts||e;for(const[l,n]of a)t[l]=n;return t};const Ra={class:"user-name"};var Ua=La(e({props:{name:{type:String},avatar:{type:String},emailAddr:{type:String}},setup(e){var a;const u=i({DEFAULT_AVATAR:null==(a=Na)?void 0:a.defaultAvatar});return(a,i)=>{const p=M,m=V;return o(),t(m,null,{default:l((()=>[r("div",{class:"user-info",onClick:i[0]||(i[0]=c((()=>{}),["prevent"]))},[s(p,{src:e.avatar||n(u).DEFAULT_AVATAR,alt:`${e.name}'s avatar`},null,8,["src","alt"]),r("span",Ra,d(e.name||"管理员"),1)])])),_:1})}}}),[["__scopeId","data-v-e3cad32e"]]);const Sa=e({components:{SkinFilled:je,SettingFilled:qe,BookFilled:Ke,HomeFilled:Me,DashboardFilled:Ve,PieChartFilled:Pe},props:{route:{type:Object,value:{}}},setup(e){const{route:a}=u(e),t=p((()=>{var e,t,l,n,o;return"1"===(null==(t=null==(e=a.value)?void 0:e.meta)?void 0:t.level)?null==(n=null==(l=a.value)?void 0:l.meta)?void 0:n.key:null==(o=a.value)?void 0:o.name}));return{...u(e),key:t}}}),Fa={class:"nav-text"};var Aa=La(Sa,[["render",function(e,n,s,i,c,u){var p,k,b,h,_,w,C;const x=a("Menus",!0),I=P,T=E;return(null==(p=e.route)?void 0:p.children)&&"1"!==(null==(b=null==(k=e.route)?void 0:k.meta)?void 0:b.level)&&!1!==(null==(h=e.route.meta)?void 0:h.isMenu)?(o(),t(I,{key:e.route.name,title:(null==(_=e.route.meta)?void 0:_.title)||"未命名"},{icon:l((()=>{var a;return[(o(),t(m(null==(a=e.route.meta)?void 0:a.icon)))]})),default:l((()=>[(o(!0),f(y,null,v(e.route.children,(e=>{var a;return o(),f(y,null,[!1!==(null==(a=e.meta)?void 0:a.isMenu)?(o(),t(x,{key:0,route:e},null,8,["route"])):g("",!0)],64)})),256))])),_:1},8,["title"])):(o(),f(y,{key:1},[!1!==(null==(C=null==(w=e.route)?void 0:w.meta)?void 0:C.isMenu)?(o(),t(T,{key:e.key},{icon:l((()=>{var a,l;return[(o(),t(m(null==(l=null==(a=e.route)?void 0:a.meta)?void 0:l.icon)))]})),default:l((()=>{var a,t;return[r("span",Fa,d((null==(t=null==(a=e.route)?void 0:a.meta)?void 0:t.title)||"未命名"),1)]})),_:1})):g("",!0)],64))}]]);const Da=(e,a=!0)=>(Object.keys(e).forEach((t=>{void 0!==e[t]&&null!==e[t]||delete e[t],a&&""===e[t]&&delete e[t],"[]"!==JSON.stringify(e[t])&&"{}"!==JSON.stringify(e[t])||delete e[t]})),e),Oa=e=>{if(!e.length)return[];if("string"==typeof e){const a=e.split("/");return[{uid:"-1",status:"done",thumbUrl:e,type:"image/png",name:a[a.length-1],response:e}]}return"object"==typeof e?e.map(((e,a)=>{const t=e.split("/");return{uid:(-(a+1)).toString(),status:"done",thumbUrl:e,type:"image/png",name:t[t.length-1],response:e}})):[]},ja=e=>{z.error(e)},qa=e=>{if(!1===e.useDefaultParms)return{};const a=Ea(),t={userId:a.userInfo.pUserId,opUser:a.userInfo.userName};return Da(t),t},Ka=Qe.create({baseURL:"http://47.98.251.91:8662",timeout:1e4,showMsg:!1});Ka.defaults.withCredentials=!0,Ka.interceptors.request.use((function(e){if(void 0!==navigator.onLine&&!1===navigator.onLine)return Promise.reject({message:"网络未链接",code:-1});if("get"==e.method&&(e.params={...qa(e),...e.params}),"post"==e.method){const a={...qa(e),...e.data};if(!1===e.useGenParams)return Ze(e.data)?(e.data=e.data.map((a=>({...a,...qa(e)}))),e):e;e.data=e.data instanceof FormData?e.data:a}return e}),(function(e){return Promise.reject(e)})),Ka.interceptors.response.use((function(e){var a,t;const{data:l,config:n}=e;if(-1!==(null==(a=n.url)?void 0:a.indexOf("pandora.yidian-inc.com")))return l&&"success"===l.status?l:Promise.reject();const o=null!=(t=l.code)?t:-1;if(1e3!==o){const e=l.message||"未定义错误";return ja(l.message),Promise.reject({code:o,message:e})}return n.showMsg&&l.message&&z.info(l.message),l.data}),(function(e){return e.code&&-1===e.code||(e.message="接口请求错误，请联系管理员"),ja(e.message),Promise.reject(e)}));const Ma=(e,a,t)=>Ka.get(e,{params:a,...t}),Va=(e,a,t)=>Ka.post(e,a,t);const Pa=Xe.get("userInfo")?JSON.parse(Xe.get("userInfo")):{userName:"",sex:1,moblie:"",pUserId:"",photo:"",id:""},Ea=Je({id:"app-user",state:()=>({userInfo:Pa,authList:[],menuList:[],menuOperateAuthMap:{}}),getters:{},actions:{async getUserLogged(){var e;try{const a=await async function(e){return Ma("/user/parse/token",e)}({token:null!=(e=Xe.get("token"))?e:""});this.userInfo=a,Xe.set("userInfo",JSON.stringify(a))}catch(a){return!1}},async getMenuAuth(){try{const e=await async function(){return Ma("/menu/query/user")}(),a=[],t={},l=(e,a,n,o=!1)=>{var s,i,r;for(let d=0;d<e.length;d++){const c=e[d];for(let e=0;e<a.length;e++){const u=a[e];if(u.menuName===(null==(s=c.meta)?void 0:s.title)&&u.children&&u.children.length>0)if("1"===(null==(i=c.meta)?void 0:i.level)||o){const e=u.children.filter((e=>"仅查看"===e.menuName||"可编辑"===e.menuName)).length>0,a=u.children.filter((e=>"可编辑"===e.menuName)).length>0,l=ea(c);t[c.meta.key]=a,this.menuOperateAuthMap=t,e&&n.push(l)}else n.push(ea(c)),n[d].children=[],l(null!=(r=c.children)?r:[],u.children,n[d].children,!0)}}};l(fo,e,a),yo.options.routes=[...a,...vo],this.menuList=a}catch(e){return!1}},redirectToLogin(){const e=location.href;location.href=`//pandora.yidian-inc.com/tools/admin/login?callback=${e}`}}}),za=Je({id:"keep-alive",state:()=>({caches:[]}),getters:{getCaches(){return this.caches}},actions:{ADD(e){this.caches.indexOf(e)<0&&this.caches.push(e)},REMOVE(e){this.caches=this.caches.filter((a=>a!=e))},CLEAN(){this.caches=[]}}});const Ya={key:0,class:"title"};var Ba=La(e({setup(e){!function(){const e=Ue(),a=za();e.meta.keepAlive&&a.ADD(e.name);const t=(e,t)=>{!1!==e.meta.isMenu&&a.REMOVE(t.name),e.meta.keepAlive&&a.ADD(e.name)};Se(((e,a,l)=>{t(e,a),l()})),Fe(((e,a,l)=>{t(e,a),l()}))}();const r=Ae(),c=Ue(),u=Ea(),_=za(),w=k(!1),C=i({title:Ta,selectedKeys:[""],openKeys:[],name:"",avatar:""}),x=u.menuList,I=p((()=>_.getCaches.join(","))),T=({key:e,selectedKeys:a})=>{r.push({name:e}),C.selectedKeys=a};return b((async()=>{C.selectedKeys=[c.name],C.openKeys=[c.path.split("/")[1]];const{userName:e,photo:a}=u.userInfo;C.name=e,C.avatar=a})),(e,i)=>{const r=a("router-link"),u=B,p=$,k=H,b=a("router-view"),_=G,N=Y;return o(),t(N,{class:"layout-wrap"},{default:l((()=>[s(u,{class:"header-container"},{default:l((()=>[s(r,{class:"app-logo",to:"/"},{default:l((()=>[w.value?g("",!0):(o(),f("h1",Ya,d(n(C).title),1))])),_:1}),s(Ua,{name:n(C).name,avatar:n(C).avatar},null,8,["name","avatar"])])),_:1}),s(k,{class:"sider-container",collapsed:w.value,"onUpdate:collapsed":i[1]||(i[1]=e=>w.value=e)},{default:l((()=>[s(p,{selectedKeys:n(C).selectedKeys,openKeys:n(C).openKeys,"onUpdate:openKeys":i[0]||(i[0]=e=>n(C).openKeys=e),theme:"dark",mode:"inline",onSelect:T},{default:l((()=>[(o(!0),f(y,null,v(n(x),(e=>(o(),t(Aa,{route:e},null,8,["route"])))),256))])),_:1},8,["selectedKeys","openKeys"])])),_:1},8,["collapsed"]),s(N,{style:{marginLeft:"200px"}},{default:l((()=>[s(_,{id:"content-container"},{default:l((()=>[(o(),t(b,{key:n(c).fullPath},{default:l((({Component:e,route:a})=>[(o(),t(h,{include:n(I)},[(o(),t(m(e),{key:a.meta.path}))],1032,["include"]))])),_:1}))])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-028e1ff6"]]);const $a={class:"app-container"};var Ha=La({name:"FullScreenLayout"},[["render",function(e,n,i,r,d,c){const u=a("router-view");return o(),f("div",$a,[s(u,null,{default:l((({Component:e})=>[(o(),t(m(e)))])),_:1})])}]]);var Ga=La({},[["render",function(e,a){const l=J;return o(),t(l,{status:"403",title:"暂无权限","sub-title":"对不起，您暂时没有此页面的访问权限，请前往父级系统登录后通过父系统内菜单再次点击进入"})}]]);const Ja={field:"",order:void 0,columnKey:""};function Wa(e){const{fetchData:a,formatParams:t,formatResponse:l,paginationOption:o=["current","size"],pageSize:s=20,firstLoaded:r=!0}=e,d=k(),c=k(Ja),m=i({dataSource:[],tableLoading:!1,total:0,current:1,size:s,selectedRowKeys:[]}),f=p((()=>({total:m.total,current:m.current,pageSize:m.size,showTotal:e=>`共${e}条`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],onChange:e=>{m.current=e},onShowSizeChange:(e,a)=>{m.current=1,m.size=a}}))),v=p((()=>({selectedRowKeys:n(m.selectedRowKeys),onChange:e=>{m.selectedRowKeys=e}}))),y=async()=>{m.tableLoading=!0;try{const e=t();let[n,s]=o;const i=Da({[n]:m.current,[s]:m.size,sort_field:c.value.field,sort_value:c.value.order,...e}),r=await a(i);if(m.tableLoading=!1,l){const{list:e,total:a}=await l(r);return m.dataSource=e,void(m.total=a)}m.dataSource=r.records,m.total=r.total}catch(e){throw e}},g=()=>new Promise(((e,a)=>{d.value.validate().then((()=>{e()})).catch((()=>{a()}))})),b=()=>{c.value=Ja,m.selectedRowKeys=[]};return _((()=>{r&&y()})),{...u(m),onSearch:()=>{g().then((()=>{m.current=1,b(),y()}))},onReset:()=>{d.value.resetFields(),m.current=1,b(),y()},pagination:f,getList:y,searchFormRef:d,onTableChange:(e,a,t)=>{c.value=t,y()},sortedInfo:c,rowSelection:v}}const Xa=e=>Ma("/base/home",e),Qa={1:"条目",2:"文档",3:"图片",4:"视频",5:"专题"},Za=[{label:"知识分类",value:"1"},{label:"知识类型",value:"2"}],et=e=>Ma("/dict/tree/query",e);const at=e({name:"TypeTree",props:{knowledgeType:null,knowledgeFlag:null},emits:["update:knowledgeType","update:knowledgeFlag","change"],setup(e,{emit:a}){const r=e,d=i({status:"1"});u(r);const c=k(""),p=k([]),m=async()=>{const e=await et({type:d.status});p.value=e,p.value.unshift({dictName:"全部",id:"",parentId:""})};m();const g=()=>{m(),a("update:knowledgeType",""),a("update:knowledgeFlag","")},b=e=>{c.value=e.id.toString(),"1"===d.status?(a("update:knowledgeType",w(e.id)),a("update:knowledgeFlag","")):(a("update:knowledgeType",""),a("update:knowledgeFlag",w(e.id))),a("change",w(e.id))};return(e,a)=>{const i=W,r=X,c=Q;return o(),f("div",null,[s(c,{class:"table-box mt20"},{default:l((()=>[s(r,{activeKey:n(d).status,"onUpdate:activeKey":a[0]||(a[0]=e=>n(d).status=e),type:"card",tabBarGutter:6,class:"search-tabs mb15",onChange:g},{default:l((()=>[(o(!0),f(y,null,v(n(Za),(e=>(o(),t(i,{key:e.value,tab:e.label},null,8,["tab"])))),128))])),_:1},8,["activeKey"]),p.value.length?(o(),t(n(la),{key:1,data:p.value,"node-key":"id","check-on-click-node":"","default-expand-all":"","highlight-current":"","expand-on-click-node":!1,"default-checked-keys":[],props:{label:"dictName"},onNodeClick:b},null,8,["data"])):(o(),t(n(ta),{key:0,"image-size":200,description:"暂无数据"}))])),_:1})])}}}),tt=e({props:{value:null},emits:["update:value"],setup(e,{emit:a}){const l=e,{value:s}=u(l),i=k([]),r=k(ea(s.value)),d=async e=>{const a={};e&&(a.itemName=e);const{records:t}=await(l=a,Ma("/item/query",l));var l;i.value=t.map((e=>({value:e.id,label:e.itemName})))},c=aa((e=>{d(e)}),300);b((()=>{d()}));const p=e=>{r.value=e,a("update:value",r)};return(e,a)=>{const l=Z;return o(),t(l,{value:r.value,"onUpdate:value":a[0]||(a[0]=e=>r.value=e),options:i.value,placeholder:"请选择项目",style:{width:"200px"},"show-search":"","allow-clear":"","filter-option":!1,onSearch:n(c),onChange:p},null,8,["value","options","onSearch"])}}});const lt=C("创建时间"),nt=C("浏览量"),ot=C("查询"),st=C("重置");var it=La(e({name:"Home",setup(e){const r=p((()=>[{title:"知识条目",dataIndex:"knowledgeName",key:"knowledgeName",align:"center",width:200,ellipsis:!0},{title:"类型",dataIndex:"knowledgeFlag",key:"knowledgeFlag",align:"center",width:80,customRender:({text:e})=>Qa[e]},{title:"分类",dataIndex:"knowledgeTypeName",key:"knowledgeTypeName",align:"center",width:80,customRender:({text:e})=>e?e.split(", ").join("-"):""},{title:"安全级别",dataIndex:"securityLevelName",key:"securityLevelName",align:"center"},{title:"有效期",dataIndex:"deadline",key:"deadline",align:"center"},{title:"创建人",dataIndex:"creator",key:"creator",align:"center"},{title:"创建时间",dataIndex:"createTime",key:"createTime",align:"center"}])),c="YYYY-MM-DD",u=i({knowledgeFlag:"",knowledgeType:"",knowledgeName:"",author:"",itemId:"",dateRange:[],sortType:"createTime"}),{onSearch:m,onReset:v,pagination:k,dataSource:b,getList:h,searchFormRef:_,onTableChange:w,sortedInfo:x}=Wa({fetchData:Xa,formatParams(){const e=u.dateRange,a={...u};return delete a.dateRange,e.length&&(a.startTime=e[0],a.endTime=e[1]),a}}),I=()=>{m()};return(e,i)=>{const p=ae,h=te,x=le,T=ne,N=Z,L=oe,R=se,U=ie,S=ee,F=re,A=Q,D=a("router-link"),O=de;return o(),f("div",null,[s(A,{class:"search-box mt15"},{default:l((()=>[s(F,{ref_key:"searchFormRef",ref:_,layout:"inline",model:n(u)},{default:l((()=>[s(S,{gutter:[24,16]},{default:l((()=>[s(x,null,{default:l((()=>[s(h,{label:"标题",name:"knowledgeName"},{default:l((()=>[s(p,{value:n(u).knowledgeName,"onUpdate:value":i[0]||(i[0]=e=>n(u).knowledgeName=e),valueModifiers:{trim:!0},placeholder:"请输入标题",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(x,null,{default:l((()=>[s(h,{label:"作者",name:"author"},{default:l((()=>[s(p,{value:n(u).author,"onUpdate:value":i[1]||(i[1]=e=>n(u).author=e),valueModifiers:{trim:!0},placeholder:"请输入作者",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(x,null,{default:l((()=>[s(h,{label:"项目",name:"itemId"},{default:l((()=>[s(tt,{value:n(u).itemId,"onUpdate:value":i[2]||(i[2]=e=>n(u).itemId=e)},null,8,["value"])])),_:1})])),_:1}),s(x,null,{default:l((()=>[s(h,{label:"排序方式",name:"sortType"},{default:l((()=>[s(N,{value:n(u).sortType,"onUpdate:value":i[3]||(i[3]=e=>n(u).sortType=e),style:{width:"120px"},"allow-clear":""},{default:l((()=>[s(T,{value:"createTime"},{default:l((()=>[lt])),_:1}),s(T,{value:"browseNum"},{default:l((()=>[nt])),_:1})])),_:1},8,["value"])])),_:1})])),_:1}),s(x,null,{default:l((()=>[s(h,{label:"创建时间",name:"dateRange"},{default:l((()=>[s(L,{value:n(u).dateRange,"onUpdate:value":i[4]||(i[4]=e=>n(u).dateRange=e),format:c,"value-format":c,"allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(x,null,{default:l((()=>[s(h,null,{default:l((()=>[s(U,{size:20},{default:l((()=>[s(R,{type:"primary",onClick:n(m)},{default:l((()=>[ot])),_:1},8,["onClick"]),s(R,{onClick:n(v)},{default:l((()=>[st])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(S,null,{default:l((()=>[s(x,{span:4},{default:l((()=>[s(at,{knowledgeType:n(u).knowledgeType,"onUpdate:knowledgeType":i[5]||(i[5]=e=>n(u).knowledgeType=e),knowledgeFlag:n(u).knowledgeFlag,"onUpdate:knowledgeFlag":i[6]||(i[6]=e=>n(u).knowledgeFlag=e),onChange:I},null,8,["knowledgeType","knowledgeFlag"])])),_:1}),s(x,{span:20},{default:l((()=>[s(A,{class:"table-box mt20"},{default:l((()=>[s(O,{rowKey:"id",columns:n(r),"data-source":n(b),pagination:n(k),bordered:"",onChange:n(w)},{bodyCell:l((({column:e,text:a,record:n})=>["knowledgeName"===e.dataIndex?(o(),t(D,{key:0,to:{name:"ArticleDetail",query:{id:n.id}}},{default:l((()=>[C(d(a),1)])),_:2},1032,["to"])):g("",!0),"deadline"===e.dataIndex?(o(),f(y,{key:1},[C(d("0"===n.expirationType?"永久有效":n.endTime),1)],64)):g("",!0)])),_:1},8,["columns","data-source","pagination","onChange"])])),_:1})])),_:1})])),_:1})])}}}),[["__scopeId","data-v-9b308f72"]]);const rt=e=>Va("/base/tail/log/save",e),dt=e=>Ma("/base/tail/log/query",e);function ct(){return{share:e=>{const{id:a,title:t,type:l,endTime:n}=e;ce.info({title:"分享",okText:"确认",maskClosable:!0,content:x("div",{},[x("p",{class:"mt15"},[x("span","标题："),x("span",{class:"link"},t)]),x("p",{class:"mt15"},`类型：${Qa[l]}     有效期：${n}`)]),onOk:async()=>{await rt({knowledgeId:a,logType:0});try{await ha(`${window.location.protocol}//${window.location.host}${window.location.pathname}#/myKnowledge/article-detail?id=${a}`),z.success("文章链接也复制到您的剪切板!")}catch(e){z.error("复制失败")}}})}}}const ut=e=>Ma("/base/query",e),pt=e=>Va("/base/save",e),mt=e=>Va("/base/update",e),ft=e=>Ma("/base/detail",e),vt=e=>{const a=new FormData;return a.append("file",e),Va("/file/upload",a,{headers:{"Content-type":"multipart/form-data"}})},yt={class:"ant-upload-drag-icon"},gt=r("p",{class:"ant-upload-text"},"单击或拖动文件到该区域进行上传",-1),kt=r("p",{class:"ant-upload-hint"},"支持单次或批量上传",-1),bt=e({emits:["success","cancel"],setup(e,{emit:a}){const d=re.useForm,c=i({labelCol:{span:4},wrapperCol:{span:20}}),u=i({fileList:[],category:""}),p=i({fileList:[{required:!0,message:"请选择文件！"}],category:[{required:!0,message:"请选择知识分类！"}]}),m=k([]);(async()=>{const e=await et({type:"1"});m.value=e})();const f=({file:e})=>{if(!e.status){const a=u.fileList.indexOf(e),t=u.fileList.slice();t.splice(a,1),u.fileList=t}},v=e=>!0,y=async({onSuccess:e,onError:a,file:t},l)=>{(async t=>{const l=await vt(t);if(l)e&&e(l),u.fileList[u.fileList.length-1].thumbUrl=l;else{const e="上传失败";a&&a(e)}})(t)},g=e=>"error"===e.status||(ce.confirm({title:"确定删除吗?",icon:s(ze),content:"",okText:"确定",okType:"danger",cancelText:"取消",onOk:()=>{const a=u.fileList.indexOf(e);u.fileList.splice(a,1)},onCancel(){}}),!1),{resetFields:b,validate:h,validateInfos:_}=d(u,p),w=async()=>{try{const t=(({fileList:e,category:a})=>e.map((e=>({accessory:e.response||"",knowledgeName:e.name,knowledgeType:a,knowledgeFlag:"1"}))))(await h());await(e=t,Va("base/batch/save",e,{useGenParams:!1})),z.success("成功!"),a("success"),C()}catch(t){}var e},C=()=>{b(),a("cancel",!1)};return(e,a)=>{const i=ue,d=te,p=pe,k=re,b=ce;return o(),t(b,{width:"600px",title:"批量上传文档",visible:!0,destroyOnClose:"",onOk:w,onCancel:C},{default:l((()=>[s(k,T(N(n(c))),{default:l((()=>[s(d,I({label:"文档"},n(_).fileList),{default:l((()=>[s(i,{fileList:n(u).fileList,"onUpdate:fileList":a[0]||(a[0]=e=>n(u).fileList=e),name:"file",multiple:!0,"custom-request":y,"before-upload":v,onRemove:g,onChange:f},{default:l((()=>[r("p",yt,[s(n(Ee))]),gt,kt])),_:1},8,["fileList"])])),_:1},16),s(d,I({label:"知识分类"},n(_).category),{default:l((()=>[s(p,{value:n(u).category,"onUpdate:value":a[1]||(a[1]=e=>n(u).category=e),style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},fieldNames:{children:"children",label:"dictName",value:"id"},placeholder:"请选择知识分类","allow-clear":"","tree-default-expand-all":"","tree-data":m.value},null,8,["value","tree-data"])])),_:1},16)])),_:1},16)])),_:1})}}});const ht=C("查询"),_t=C("重置"),wt=C("新建知识"),Ct=C("批量上传文档"),xt=C("新建专题"),It=C("分享"),Tt=C("编辑 "),Nt=C("删除");var Lt=La(e({name:"KnowledgeList",setup(e){const c=Ae(),u=Ue(),m=Ea(),v=u.meta.key,k=p((()=>m.menuOperateAuthMap[v])),b=p((()=>{R.value;const e=[{title:"类型",dataIndex:"knowledgeFlag",key:"knowledgeFlag",align:"center",width:80,customRender:({text:e})=>Qa[e]},{title:"知识条目",dataIndex:"knowledgeName",key:"knowledgeName",align:"center",width:300,ellipsis:!0},{title:"分类",dataIndex:"knowledgeTypeName",key:"knowledgeTypeName",align:"center",customRender:({text:e})=>e?e.split(", ").join("-"):""},{title:"创建时间",dataIndex:"createTime",key:"createTime",align:"center"},{title:"最后编辑时间",dataIndex:"updateTime",key:"updateTime",align:"center"},{title:"操作",dataIndex:"operation",align:"center"}];return k.value||e.pop(),e})),h=i({knowledgeName:"",sortType:"createTime"}),{onSearch:_,onReset:w,pagination:x,dataSource:I,getList:T,searchFormRef:N,onTableChange:L,sortedInfo:R}=Wa({fetchData:ut,formatParams:()=>({...h})}),U=(e,a)=>{if(3===e.knowledgeFlag)return c.push({name:"KnowledgeCreateTopic",query:e.id?{id:e.id,type:a}:{type:a}});c.push({name:"KnowledgeCreate",query:e.id?{id:e.id,type:a}:{type:a}})},S=async e=>{var a;await(a={id:e},Ma("/base/del",a)),z.success("删除成功！"),T()},F=i({visible:!1}),A=()=>{F.visible=!0},D=()=>{F.visible=!1},{share:O}=ct();return(e,i)=>{const u=ae,p=te,m=le,v=se,R=ie,j=ee,q=re,K=Q,M=a("router-link"),V=me,P=de;return o(),f(y,null,[r("div",null,[s(K,{class:"search-box"},{default:l((()=>[s(q,{ref_key:"searchFormRef",ref:N,layout:"inline",model:n(h)},{default:l((()=>[s(j,{gutter:[24,16]},{default:l((()=>[s(m,null,{default:l((()=>[s(p,{label:"条目标题",name:"knowledgeName"},{default:l((()=>[s(u,{value:n(h).knowledgeName,"onUpdate:value":i[0]||(i[0]=e=>n(h).knowledgeName=e),valueModifiers:{trim:!0},placeholder:"请输入条目标题",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(m),s(m,null,{default:l((()=>[s(p,null,{default:l((()=>[s(R,{size:20},{default:l((()=>[s(v,{type:"primary",onClick:n(_)},{default:l((()=>[ht])),_:1},8,["onClick"]),s(v,{onClick:n(w)},{default:l((()=>[_t])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(K,{class:"table-box mt20"},{default:l((()=>[n(k)?(o(),t(j,{key:0,class:"action-btn-box"},{default:l((()=>[s(v,{class:"mr15",style:{"background-color":"#36bc62","border-color":"#36bc62"},type:"primary",onClick:i[1]||(i[1]=e=>U({id:""},"create"))},{default:l((()=>[wt])),_:1}),s(v,{class:"mr15",onClick:A},{default:l((()=>[Ct])),_:1}),s(v,{onClick:i[2]||(i[2]=e=>{return a={id:""},t="create",void c.push({name:"KnowledgeCreateTopic",query:a.id?{id:a.id,type:t}:{type:t}});var a,t})},{default:l((()=>[xt])),_:1})])),_:1})):g("",!0),s(P,{rowKey:"id",columns:n(b),"data-source":n(I),pagination:n(x),bordered:"",onChange:n(L)},{bodyCell:l((({column:e,text:a,record:r})=>["knowledgeName"===e.dataIndex?(o(),t(M,{key:0,to:{name:"ArticleDetail",query:{id:r.id}}},{default:l((()=>[C(d(a),1)])),_:2},1032,["to"])):g("",!0),"operation"===e.dataIndex?(o(),f(y,{key:1},[s(v,{type:"link",class:"action-btn",onClick:e=>n(O)({id:r.id,title:r.knowledgeName,type:r.knowledgeFlag,endTime:"0"===r.expirationType?"永久有效":r.endTime})},{default:l((()=>[It])),_:2},1032,["onClick"]),s(v,{type:"link",class:"action-btn",onClick:e=>U({id:r.id,knowledgeFlag:r.knowledgeFlag},"update")},{default:l((()=>[Tt])),_:2},1032,["onClick"]),s(V,{title:"确定要删除此项目吗？","ok-text":"确定","cancel-text":"取消",onConfirm:e=>S(r.id),onCancel:i[3]||(i[3]=()=>{})},{default:l((()=>[s(v,{type:"link",class:"action-btn"},{default:l((()=>[Nt])),_:1})])),_:2},1032,["onConfirm"])],64)):g("",!0)])),_:1},8,["columns","data-source","pagination","onChange"])])),_:1})]),n(F).visible?(o(),t(bt,{key:0,onSuccess:n(T),onCancel:D},null,8,["onSuccess"])):g("",!0)],64)}}}),[["__scopeId","data-v-159e8729"]]);const Rt={class:"upload-wrapper clearfix"},Ut=C(" 点击上传 "),St={key:0},Ft=r("div",{class:"ant-upload-text"},"上传",-1),At=["src"],Dt={style:{width:"100%",height:"450px"}},Ot=e({props:{modelValue:{type:Array,default:()=>[]},isAllowUpload:{type:Boolean,default:!0},maxLength:{type:Number,default:100},crop:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},type:{type:String,default:"0"}},emits:["update:modelValue","onBeforeUpload"],setup(e,{expose:a,emit:i}){const d=e,{modelValue:c,crop:p}=u(d),m=k(!1),v=k(""),b=k([]),h=k({});b.value=ea(c.value);const _=k(!1),C=k(null),x=k(""),I=k(""),T=()=>{m.value=!1,v.value=""},N=e=>{v.value=e.thumbUrl,m.value=!0},R=({file:e})=>{if(!e.status||p.value){p.value&&(h.value=e);const a=b.value.indexOf(e),t=b.value.slice();t.splice(a,1),b.value=t}"removed"===e.status&&i("update:modelValue",w(b.value))},U=e=>{if(i("onBeforeUpload"),!d.isAllowUpload)return!1;const a=e.type.split("/")[0],t=e.type.split("/")[1],l="image"===a,n=["jpg","jpeg","png","gif","bmp"],o=e.size/1024/1024<8;return l&&!o?(z.error("图片必须小于8MB！"),!1):l&&-1===n.indexOf(t)?(z.error("文件格式错误，支持文件格式为：jpg、jpeg、png、gif、bmp"),!1):!(l&&n.indexOf(t)>-1)||new Promise((a=>{const t=new FileReader;t.readAsDataURL(e),t.onload=()=>{const e=document.createElement("img");e.src=t.result,e.onload=()=>{const t=document.createElement("canvas");t.width=e.naturalWidth,t.height=e.naturalHeight;const l=t.getContext("2d");if(l){l.drawImage(e,0,0);const a={font:"microsoft yahei",textArray:["北京市海淀区水务局"],density:3};((e,a,t,l)=>{let n=0;n=a>=3456?50:a>=2700?30:a>=2e3?26:20,e.fillStyle="white",e.font=`${n}px ${l.font}`,e.lineWidth=1,e.fillStyle="rgba(255,255,255,0.3)",e.textAlign="left",e.textBaseline="middle";const o=Math.max(a,t),s=Math.floor(o/l.density);let i=[0];for(;i[i.length-1]<o/2;)i.push(i[i.length-1]+s);i.push(...i.slice(1,i.length).map((e=>-e)));for(let r=0;r<i.length;r++)for(let o=0;o<i.length;o++)e.save(),e.translate(a/2,t/2),e.rotate(-Math.PI/5),l.textArray.length>3&&(l.textArray=l.textArray.slice(0,3)),l.textArray.forEach(((a,t)=>{let l=n*t+2;e.fillText(a,i[r],i[o]+l)})),e.restore()})(l,e.naturalWidth,e.naturalHeight,a)}t.toBlob(a)}}}))},S=async({onSuccess:e,onError:a,file:t},l)=>{if(p.value&&!l){I.value=t.name,_.value=!0;const e=await(e=>new Promise(((a,t)=>{const l=new FileReader;l.readAsDataURL(e),l.onload=()=>a(l.result),l.onerror=e=>t(e)})))(t);return void(x.value=e)}(async t=>{const n=await vt(t);if(n)e&&e(n),p.value&&b.value.push(h.value),b.value[b.value.length-1].thumbUrl=n,l&&(b.value[b.value.length-1].status="success",b.value[b.value.length-1].response=n),i("update:modelValue",w(b.value));else{const e="上传失败";a&&a(e),l&&(b.value[b.value.length-1].status="error")}})(t)},F=e=>"error"===e.status||(ce.confirm({title:"确定删除吗?",icon:s(ze),content:"",okText:"确定",okType:"danger",cancelText:"取消",onOk:()=>{const a=b.value.indexOf(e);b.value.splice(a,1),i("update:modelValue",w(b.value))},onCancel(){}}),!1),A=()=>{C.value.getCropData((e=>{const a=((e,a)=>{const t=e.split(","),l=t[0].match(/:(.*?);/)[1],n=atob(t[1]);let o=n.length;const s=new Uint8Array(o);for(;o--;)s[o]=n.charCodeAt(o);return new File([s],a,{type:l})})(e,I.value);i("update:modelValue",w(b.value)),S({file:a,action:"",method:"POST"},!0)})),_.value=!1},D=()=>{_.value=!1;const e=b.value.length-1,a=b.value.slice();a.splice(e,1),b.value=a,i("update:modelValue",a)};L(c,(e=>{w(e).length?b.value=ea(e):b.value=[]}));return a({hasPendingTask:()=>b.value.some((e=>"uploading"===e.status))}),(a,i)=>{const d=se,c=fe,u=ce;return o(),f(y,null,[r("div",Rt,["2"===e.type?(o(),t(c,{key:0,"file-list":b.value,"onUpdate:file-list":i[0]||(i[0]=e=>b.value=e),"custom-request":S,"before-upload":U,onRemove:F,onChange:R,disabled:e.disabled},{default:l((()=>[s(d,null,{default:l((()=>[s(n(Ye)),Ut])),_:1})])),_:1},8,["file-list","disabled"])):(o(),t(c,{key:1,"file-list":b.value,"onUpdate:file-list":i[1]||(i[1]=e=>b.value=e),"list-type":"picture-card","custom-request":S,"before-upload":U,onRemove:F,onPreview:N,onChange:R,isImageUrl:()=>!0,disabled:e.disabled},{default:l((()=>[b.value.length<e.maxLength?(o(),f("div",St,[s(n(Be),{class:"upload-icon"}),Ft])):g("",!0)])),_:1},8,["file-list","isImageUrl","disabled"])),s(u,{visible:m.value,footer:null,onCancel:T},{default:l((()=>[v.value?(o(),f("img",{key:0,alt:"example",style:{width:"100%"},src:v.value},null,8,At)):g("",!0)])),_:1},8,["visible"])]),s(u,{title:"裁剪图片",visible:_.value,width:800,onOk:A,onCancel:D},{default:l((()=>[r("div",Dt,[s(n(oa),{autoCrop:"",img:x.value,ref_key:"cropper",ref:C,centerBox:"",fixed:"",canMove:!1,fixedNumber:[20,13]},null,8,["img"])])])),_:1},8,["visible"])],64)}}});const jt={class:"base-editor border"};var qt=La(e({props:{modelValue:{type:String,default:()=>[]}},emits:["update:modelValue"],setup(e,{emit:a}){const t=e,{modelValue:l}=u(t),i=R(),r=k("default"),d=k("");setTimeout((()=>{d.value=ea(l.value)}),1e3);const c={},p={placeholder:"请输入内容..."};U((()=>{const e=i.value;null!=e&&e.destroy()}));const m=e=>{i.value=e},v=e=>{a("update:modelValue",e.getHtml())};return(e,a)=>(o(),f("div",jt,[s(n(sa),{class:"border-bt",editor:n(i),defaultConfig:c,mode:r.value},null,8,["editor","mode"]),s(n(ia),{class:"editor",defaultConfig:p,mode:r.value,modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),onOnCreated:m,onOnChange:v},null,8,["mode","modelValue"])]))}}),[["__scopeId","data-v-be0a4460"]]);const Kt=e({setup(e){const a=[{title:"条目标题",dataIndex:"knowledgeName",key:"knowledgeName",align:"center"},{title:"操作",dataIndex:"operation",align:"center",width:110}];return(e,n)=>{const s=de;return o(),t(s,I({columns:a},e.$attrs),{bodyCell:l((({column:a,record:t})=>["operation"===a.dataIndex?S(e.$slots,"operation",{key:0,record:t}):g("",!0)])),_:3},16)}}}),Mt=C("查询"),Vt=e({props:{selectedRows:null},emits:["success","cancel"],setup(e,{emit:a}){const r=e,{selectedRows:c}=u(r),p=i({selectedRow:[]}),m=i({knowledgeName:""}),{onSearch:f,onReset:v,pagination:y,dataSource:g,getList:k,searchFormRef:h,onTableChange:_}=Wa({fetchData:ut,formatParams:()=>m,pageSize:10,formatResponse(e){const{records:a,total:t}=e;return c.value.forEach((e=>{a.forEach((a=>{e.id===a.id&&(a.checked=!0)}))})),{list:a,total:t}}}),w=()=>{const e={selectedRows:p.selectedRow};a("success",e),x()},x=()=>{a("cancel")};return b((async()=>{await k()})),(e,a)=>{const i=ae,r=te,c=le,u=se,v=ie,k=ee,b=re,I=Q,T=ce;return o(),t(T,{title:"选择知识条目",visible:!0,maskClosable:!1,closable:!1,centered:"",width:"80%",destroyOnClose:"","body-style":{height:"80vh","overflow-y":"auto"},onOk:w,onCancel:x},{default:l((()=>[s(I,{class:"search-box"},{default:l((()=>[s(b,{ref_key:"searchFormRef",ref:h,layout:"inline",model:n(m)},{default:l((()=>[s(k,{gutter:[24,16]},{default:l((()=>[s(c,null,{default:l((()=>[s(r,{label:"标题",name:"knowledgeName"},{default:l((()=>[s(i,{value:n(m).knowledgeName,"onUpdate:value":a[0]||(a[0]=e=>n(m).knowledgeName=e),valueModifiers:{trim:!0},placeholder:"请输入知识条目标题",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(c,null,{default:l((()=>[s(r,null,{default:l((()=>[s(v,{size:20},{default:l((()=>[s(u,{type:"primary",onClick:n(f)},{default:l((()=>[Mt])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(Kt,{rowKey:"id","data-source":n(g),pagination:n(y),bordered:"",onChange:n(_)},{operation:l((({record:e})=>[s(u,{type:e.checked?"primary":"",disabled:e.disabled,onClick:a=>{return(t=e).checked=!t.checked,void(t.checked?p.selectedRow.push(t):p.selectedRow.splice(p.selectedRow.findIndex((e=>e.id==t.id)),1));var t}},{default:l((()=>[C(d(e.checked?"已添加":"添加"),1)])),_:2},1032,["type","disabled","onClick"])])),_:1},8,["data-source","pagination","onChange"])])),_:1})}}});const Pt={class:"page-title"},Et=C("文档"),zt=C("图片"),Yt=C("视频"),Bt=C("永久有效"),$t=C("自定义有效期"),Ht=C("关联知识"),Gt=C("移除"),Jt=C("保存"),Wt=C("取消");var Xt=(e=>(e.update="编辑",e.create="新增",e))(Xt||{});var Qt=La(e({setup(e){const a=Ue(),u=Ae(),{type:m="create",id:v=""}=a.query,h=Ea(),_={2:"文档",3:"图片",4:"视频"},C=[{label:"水务局内部公开",value:"0"},{label:"同科室公开",value:"1"},{label:"私有",value:"3"}],x=k("");b((async()=>{"update"===m&&await(async()=>{const e=await ft({id:v}),{knowledgeFlag:a,knowledgeName:t,knowledgeType:l,accessory:n,documentNum:o,archiveTime:s,pagination:i,content:r,securityLevel:d,expirationType:c,endTime:u,longitude:p,latitude:m,relateds:f,version:y}=e;N.entry=t,N.type=a+"",N.category=l,N.doc_number=o,N.file_date=s,N.pages_num=i,N.content=r,N.safe_level=null!=d?d:"0",N.expiration_type=null!=c?c:"0",N.expiration_date=u,N.file=Oa(n.split(",")),S.knowledgeList=f,x.value=y})()}));const T=re.useForm;let{modelRef:N,rulesRef:L}=function(){const e=i({type:"2",file:[],entry:"",category:"",doc_number:"",file_date:"",pages_num:"",storage_location:"",content:"",label:[],safe_level:"0",expiration_type:"0",expiration_date:"",project:"",location:""}),a=p((()=>({type:[{required:!0,message:"请选择知识类型"}],file:[{required:"0"!==e.type,message:"请上传文件"}],entry:[{required:!0,message:"请填写知识条目"}],category:[{required:!0,message:"请选择知识分类"}],doc_number:[{required:!1}],file_date:[{required:!1}],pages_num:[{required:!1}],storage_location:[{required:!1}],content:[{required:!1}],label:[{required:!1}],safe_level:[{required:!1}],expiration_type:[{required:!1}],expiration_date:[{required:!1}],project:[{required:!1}],location:[{required:!1}],knowledge:[{required:!1}]})));return{modelRef:e,rulesRef:a}}();const R=()=>{N.file=[]},U=k([]);(async()=>{const e=await et({type:"1"});U.value=e})();const S=i({visible:!1,knowledgeList:[]}),F=e=>{const{selectedRows:a}=e;S.knowledgeList.push(...a)},{resetFields:A,validate:D,validateInfos:O}=T(N,L),j=async()=>{try{const e=(e=>{const{category:a,content:t,doc_number:l,entry:n,expiration_date:o,expiration_type:s,file:i,file_date:r,pages_num:d,safe_level:c,storage_location:u,type:p}=e,m={knowledgeFlag:p,knowledgeName:n,knowledgeType:a,accessory:w(i).map((e=>e.response)).join(","),documentNum:l,archiveTime:r,pagination:d,location:u,content:t,securityLevel:c,endTime:o,itemId:"",expirationType:s,relateds:S.knowledgeList.map((e=>e.id)).join(","),userId:h.userInfo.id,parentUserId:h.userInfo.pUserId};return Da(m)})(await D());await(async e=>"create"===m?await pt(e):await mt({...e,id:v,version:x.value}))(e),z.success("操作成功！"),q()}catch(e){}},q=()=>{A(),u.back()};return(e,a)=>{const i=ve,u=ye,p=te,v=ae,k=pe,b=ge,h=ke,w=se,x=be,T=le,L=ee,A=re,D=Q;return o(),f(y,null,[s(D,null,{default:l((()=>[r("div",Pt,d(Xt[n(m)])+"知识",1),s(A,{class:"mt24","label-col":{span:2},"wrapper-col":{span:14}},{default:l((()=>[s(p,I({label:"知识类型"},n(O).type),{default:l((()=>[s(u,{value:n(N).type,"onUpdate:value":a[0]||(a[0]=e=>n(N).type=e),onChange:R},{default:l((()=>[s(i,{value:"2"},{default:l((()=>[Et])),_:1}),s(i,{value:"3"},{default:l((()=>[zt])),_:1}),s(i,{value:"4"},{default:l((()=>[Yt])),_:1})])),_:1},8,["value"])])),_:1},16),s(p,I({label:_[n(N).type]},n(O).file),{default:l((()=>[s(Ot,{modelValue:n(N).file,"onUpdate:modelValue":a[1]||(a[1]=e=>n(N).file=e),"max-length":8,type:n(N).type},null,8,["modelValue","type"])])),_:1},16,["label"]),s(p,I({label:"知识条目"},n(O).entry),{default:l((()=>[s(v,{value:n(N).entry,"onUpdate:value":a[2]||(a[2]=e=>n(N).entry=e),placeholder:"请填写知识条目"},null,8,["value"])])),_:1},16),s(p,I({label:"知识分类"},n(O).category),{default:l((()=>[s(k,{value:n(N).category,"onUpdate:value":a[3]||(a[3]=e=>n(N).category=e),style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},fieldNames:{children:"children",label:"dictName",value:"id"},placeholder:"请选择知识分类","allow-clear":"","tree-default-expand-all":"","tree-data":U.value},null,8,["value","tree-data"])])),_:1},16),"2"===n(N).type?(o(),f(y,{key:0},[s(p,I({label:"文号"},n(O).doc_number),{default:l((()=>[s(v,{value:n(N).doc_number,"onUpdate:value":a[4]||(a[4]=e=>n(N).doc_number=e),placeholder:"请填写文号"},null,8,["value"])])),_:1},16),s(p,I({label:"档案日期"},n(O).file_date),{default:l((()=>[s(b,{value:n(N).file_date,"onUpdate:value":a[5]||(a[5]=e=>n(N).file_date=e),valueFormat:"YYYY-MM-DD"},null,8,["value"])])),_:1},16),s(p,I({label:"页数"},n(O).pages_num),{default:l((()=>[s(v,{value:n(N).pages_num,"onUpdate:value":a[6]||(a[6]=e=>n(N).pages_num=e),placeholder:"请填写页数"},null,8,["value"])])),_:1},16),s(p,I({label:"存放地点"},n(O).storage_location),{default:l((()=>[s(v,{value:n(N).storage_location,"onUpdate:value":a[7]||(a[7]=e=>n(N).storage_location=e),placeholder:"请填写存放地点"},null,8,["value"])])),_:1},16)],64)):g("",!0),s(p,I({label:"知识内容"},n(O).content),{default:l((()=>[s(qt,{modelValue:n(N).content,"onUpdate:modelValue":a[8]||(a[8]=e=>n(N).content=e)},null,8,["modelValue"])])),_:1},16),s(p,I({label:"安全级别"},n(O).safe_level),{default:l((()=>[s(u,{value:n(N).safe_level,"onUpdate:value":a[9]||(a[9]=e=>n(N).safe_level=e),options:C},null,8,["value"])])),_:1},16),s(p,I({label:"有效期"},n(O).expiration_type),{default:l((()=>[s(u,{value:n(N).expiration_type,"onUpdate:value":a[10]||(a[10]=e=>n(N).expiration_type=e)},{default:l((()=>[s(h,{value:"0"},{default:l((()=>[Bt])),_:1}),s(h,{value:"1"},{default:l((()=>[$t])),_:1})])),_:1},8,["value"])])),_:1},16),"1"===n(N).expiration_type?(o(),t(p,I({key:1,"wrapper-col":{offset:2}},n(O).expiration_date),{default:l((()=>[s(b,{value:n(N).expiration_date,"onUpdate:value":a[11]||(a[11]=e=>n(N).expiration_date=e),valueFormat:"YYYY-MM-DD"},null,8,["value"])])),_:1},16)):g("",!0),s(p,I({label:"关联知识"},n(O).knowledge),{default:l((()=>[r("div",null,[s(w,{class:"mr15",type:"primary",onClick:a[12]||(a[12]=e=>n(S).visible=!0)},{default:l((()=>[Ht])),_:1}),r("span",null,"已关联 "+d(n(S).knowledgeList.length)+" 条知识",1)]),s(Kt,{class:"mt24",rowKey:"id","data-source":n(S).knowledgeList,pagination:!1,bordered:""},{operation:l((({record:e})=>[s(w,{type:"primary",size:"small",onClick:a=>{return t=e,void S.knowledgeList.splice(S.knowledgeList.findIndex((e=>e.id==t.id)),1);var t}},{default:l((()=>[Gt])),_:2},1032,["onClick"])])),_:1},8,["data-source"])])),_:1},16),"readonly"!==n(m)?(o(),t(L,{key:2},{default:l((()=>[s(x),s(T,{span:24,style:{"text-align":"right"}},{default:l((()=>[s(w,{type:"primary",onClick:c(j,["prevent"])},{default:l((()=>[Jt])),_:1},8,["onClick"]),s(w,{style:{"margin-left":"10px"},onClick:q},{default:l((()=>[Wt])),_:1})])),_:1})])),_:1})):g("",!0)])),_:1})])),_:1}),n(S).visible?(o(),t(Vt,{key:0,"selected-rows":n(S).knowledgeList,onSuccess:F,onCancel:a[13]||(a[13]=e=>n(S).visible=!1)},null,8,["selected-rows"])):g("",!0)],64)}}}),[["__scopeId","data-v-14ee118d"]]);const Zt={class:"page-title"},el=C("关联知识"),al=C("移除"),tl=C("保存"),ll=C("取消");var nl=(e=>(e.update="编辑",e.create="新增",e))(nl||{});var ol=La(e({setup(e){const a=Ue(),u=Ae(),m=Ea(),{type:v="create",id:h=""}=a.query,_=[{label:"水务局内部公开",value:"0"},{label:"同科室公开",value:"1"},{label:"私有",value:"3"}],w=re.useForm,{modelRef:C,rulesRef:x}={modelRef:i({knowledgeName:"",knowledgeType:"",content:"",labels:[],securityLevel:"0",location:""}),rulesRef:p((()=>({knowledgeName:[{required:!0,message:"请填写标题"}],knowledgeType:[{required:!0,message:"请选择分类"}],content:[{required:!0,message:"请填写专题描述"}],labels:[{required:!1}],securityLevel:[{required:!1}],location:[{required:!1}],knowledge:[{required:!1}]})))},T=k("");b((async()=>{"update"===v&&await(async()=>{const e=await ft({id:h}),{knowledgeName:a,knowledgeType:t,content:l,securityLevel:n,longitude:o,latitude:s,relateds:i,version:r}=e;C.knowledgeName=a,C.knowledgeType=t,C.content=l,C.securityLevel=null!=n?n:"0",N.knowledgeList=i,T.value=r})()}));const N=i({visible:!1,knowledgeList:[]}),L=e=>{const{selectedRows:a}=e;N.knowledgeList.push(...a)},R=k([]);(async()=>{const e=await et({type:"1"});R.value=e})();const{resetFields:U,validate:S,validateInfos:F}=w(C,x),A=async()=>{try{const e=(e=>{const{knowledgeName:a,knowledgeType:t,content:l,securityLevel:n}=e,o={knowledgeFlag:"5",knowledgeName:a,knowledgeType:t,content:l,securityLevel:n,relateds:N.knowledgeList.map((e=>e.id)).join(","),userId:m.userInfo.id,parentUserId:m.userInfo.pUserId};return Da(o)})(await S());await(async e=>"create"===v?await pt(e):await mt({...e,id:h,version:T.value}))(e),z.success("操作成功！"),D()}catch(e){}},D=()=>{U(),u.back()};return(e,a)=>{const i=ae,u=te,p=pe,m=he,k=ye,b=se,h=be,w=le,x=ee,T=re,U=Q;return o(),f(y,null,[s(U,null,{default:l((()=>[r("div",Zt,d(nl[n(v)])+"专题",1),s(T,{class:"mt24","label-col":{span:2},"wrapper-col":{span:14}},{default:l((()=>[s(u,I({label:"专题标题"},n(F).knowledgeName),{default:l((()=>[s(i,{value:n(C).knowledgeName,"onUpdate:value":a[0]||(a[0]=e=>n(C).knowledgeName=e),placeholder:"请填写专题标题"},null,8,["value"])])),_:1},16),s(u,I({label:"分类"},n(F).knowledgeType),{default:l((()=>[s(p,{value:n(C).knowledgeType,"onUpdate:value":a[1]||(a[1]=e=>n(C).knowledgeType=e),style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},fieldNames:{children:"children",label:"dictName",value:"id"},placeholder:"请选择知识分类","allow-clear":"","tree-default-expand-all":"","tree-data":R.value},null,8,["value","tree-data"])])),_:1},16),s(u,I({label:"专题描述"},n(F).content),{default:l((()=>[s(m,{value:n(C).content,"onUpdate:value":a[2]||(a[2]=e=>n(C).content=e),rows:4,placeholder:"请填写专题描述",maxlength:6},null,8,["value"])])),_:1},16),s(u,I({label:"安全级别"},n(F).securityLevel),{default:l((()=>[s(k,{value:n(C).securityLevel,"onUpdate:value":a[3]||(a[3]=e=>n(C).securityLevel=e),options:_},null,8,["value"])])),_:1},16),s(u,I({label:"关联知识"},n(F).knowledge),{default:l((()=>[r("div",null,[s(b,{class:"mr15",type:"primary",onClick:a[4]||(a[4]=e=>n(N).visible=!0)},{default:l((()=>[el])),_:1}),r("span",null,"已关联 "+d(n(N).knowledgeList.length)+" 条知识",1)]),s(Kt,{class:"mt24",rowKey:"id","data-source":n(N).knowledgeList,pagination:!1,bordered:""},{operation:l((({record:e})=>[s(b,{type:"primary",size:"small",onClick:a=>{return t=e,void N.knowledgeList.splice(N.knowledgeList.findIndex((e=>e.id==t.id)),1);var t}},{default:l((()=>[al])),_:2},1032,["onClick"])])),_:1},8,["data-source"])])),_:1},16),"readonly"!==n(v)?(o(),t(x,{key:0},{default:l((()=>[s(h),s(w,{span:24,style:{"text-align":"right"}},{default:l((()=>[s(b,{type:"primary",onClick:c(A,["prevent"])},{default:l((()=>[tl])),_:1},8,["onClick"]),s(b,{style:{"margin-left":"10px"},onClick:D},{default:l((()=>[ll])),_:1})])),_:1})])),_:1})):g("",!0)])),_:1})])),_:1}),n(N).visible?(o(),t(Vt,{key:0,"selected-rows":n(N).knowledgeList,onSuccess:L,onCancel:a[5]||(a[5]=e=>n(N).visible=!1)},null,8,["selected-rows"])):g("",!0)],64)}}}),[["__scopeId","data-v-b678398a"]]);const sl=e=>Ma("/base/collection/query",e),il=e=>Ma("/base/cancel/collection",e);const rl=(e,a)=>{(function(e){return new Promise((a=>{const t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Access-Control-Allow-Origin","*"),t.responseType="blob",t.onload=()=>{200===t.status&&a(t.response)},t.send()}))})(e).then((e=>{!function(e,a){const t=document.createElement("a"),l=document.querySelector("body");t.href=window.URL.createObjectURL(e),t.download=a,t.style.display="none",l&&l.appendChild(t),t.click(),l&&l.removeChild(t),window.URL.revokeObjectURL(t.href)}(e,a)}))};const dl=e=>Ma("/base/error/correction/query",e),cl={class:"ant-upload-drag-icon"},ul=r("p",{class:"ant-upload-text"},"单击或拖动文件到该区域进行上传",-1),pl=r("p",{class:"ant-upload-hint"},"支持单次或批量上传",-1),ml=e({props:{id:null},emits:["success","cancel"],setup(e,{emit:a}){const d=e,{id:c}=u(d),p=re.useForm,m=i({labelCol:{span:4},wrapperCol:{span:20}}),f=i({content:"",picture:[],accessory:[]}),v=i({content:[{required:!0,message:"请选择纠错内容！"}],picture:[{required:!1}],accessory:[{required:!1}]}),y=({file:e})=>{if(!e.status){const a=f.accessory.indexOf(e),t=f.accessory.slice();t.splice(a,1),f.accessory=t}},g=e=>!0,k=async({onSuccess:e,onError:a,file:t},l)=>{(async t=>{const l=await vt(t);if(l)e&&e(l),f.accessory[f.accessory.length-1].thumbUrl=l;else{const e="上传失败";a&&a(e)}})(t)},b=e=>"error"===e.status||(ce.confirm({title:"确定删除吗?",icon:s(ze),content:"",okText:"确定",okType:"danger",cancelText:"取消",onOk:()=>{const a=f.accessory.indexOf(e);f.accessory.splice(a,1)},onCancel(){}}),!1),{resetFields:h,validate:_,validateInfos:w}=p(f,v),C=async()=>{try{const t=(({content:e,picture:a,accessory:t})=>({knowledgeId:c.value,content:e,picture:a.map((e=>e.response)).join(","),accessory:t.map((e=>e.response)).join(",")}))(await _());await(e=t,Va("/base/error/correction/save",e)),z.success("成功!"),a("success"),x()}catch(t){}var e},x=()=>{h(),a("cancel",!1)};return(e,a)=>{const i=he,d=te,c=ue,u=re,p=ce;return o(),t(p,{width:"600px",title:"内容纠错",visible:!0,destroyOnClose:"",onOk:C,onCancel:x},{default:l((()=>[s(u,T(N(n(m))),{default:l((()=>[s(d,I({label:"内容"},n(w).content),{default:l((()=>[s(i,{value:n(f).content,"onUpdate:value":a[0]||(a[0]=e=>n(f).content=e),rows:4,placeholder:"请填写描述",maxlength:6},null,8,["value"])])),_:1},16),s(d,I({label:"补充图片"},n(w).picture),{default:l((()=>[s(Ot,{modelValue:n(f).picture,"onUpdate:modelValue":a[1]||(a[1]=e=>n(f).picture=e),"max-length":8,type:"1"},null,8,["modelValue"])])),_:1},16),s(d,I({label:"补充附件"},n(w).accessory),{default:l((()=>[s(c,{fileList:n(f).accessory,"onUpdate:fileList":a[2]||(a[2]=e=>n(f).accessory=e),name:"file",multiple:!0,"custom-request":k,"before-upload":g,onRemove:b,onChange:y},{default:l((()=>[r("p",cl,[s(n(Ee))]),ul,pl])),_:1},8,["fileList"])])),_:1},16)])),_:1},16)])),_:1})}}}),fl=r("div",null,"内容:",-1),vl=["innerHTML"],yl=e({props:{content:null},emits:["success","cancel"],setup(e,{emit:a}){const i=e,{content:d}=u(i),c=()=>{a("success"),p()},p=()=>{a("cancel")};return(e,a)=>{const i=le,u=ee,m=ce;return o(),t(m,{title:"查看修订内容",visible:!0,maskClosable:!1,closable:!1,width:"600px",destroyOnClose:"",onOk:c,onCancel:p},{default:l((()=>[s(u,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[fl])),_:1}),s(i,{span:19},{default:l((()=>[r("div",{innerHTML:n(d)},null,8,vl)])),_:1})])),_:1})])),_:1})}}}),gl={class:"ant-rate-text"},kl=e({props:{knowledgeId:null},emits:["success","cancel"],setup(e,{emit:a}){const c=e,{knowledgeId:p}=u(c),m=re.useForm,f=i({labelCol:{span:4},wrapperCol:{span:20}}),v=i({rate:1}),y=i({rate:[{required:!0,message:"请选择分数！"}]}),{resetFields:g,validate:k,validateInfos:b}=m(v,y),h=async()=>{try{const t=await k();await(e={...t,knowledgeId:p.value},Va("base/rate/save",e)),z.success("成功!"),a("success"),_()}catch(t){}var e},_=()=>{g(),a("cancel",!1)};return(e,a)=>{const i=_e,c=te,u=re,p=ce;return o(),t(p,{width:"400px",title:"评价",visible:!0,destroyOnClose:"",onOk:h,onCancel:_},{default:l((()=>[s(u,T(N(n(f))),{default:l((()=>[s(c,I({label:"评分"},n(b).rate),{default:l((()=>[s(i,{value:n(v).rate,"onUpdate:value":a[0]||(a[0]=e=>n(v).rate=e)},null,8,["value"]),r("span",gl,d(n(v).rate)+"分",1)])),_:1},16)])),_:1},16)])),_:1})}}});const bl=e=>(F("data-v-aed7a5be"),e=e(),A(),e),hl={class:"ant-rate-text"},_l=C("分享"),wl=C("纠错"),Cl=bl((()=>r("span",{class:"label"},"分类: ",-1))),xl={class:"value"},Il=bl((()=>r("span",{class:"label"},"安全级别: ",-1))),Tl={class:"value"},Nl=bl((()=>r("span",{class:"label"},"有效时间: ",-1))),Ll={class:"value"},Rl=bl((()=>r("span",{class:"label"},"标签: ",-1))),Ul={class:"value"},Sl=bl((()=>r("span",{class:"label"},"创建人: ",-1))),Fl={class:"value"},Al=bl((()=>r("span",{class:"label"},"创建时间: ",-1))),Dl={class:"value"},Ol=bl((()=>r("span",{class:"label"},"状态: ",-1))),jl={class:"value"},ql=bl((()=>r("span",{class:"label"},"内容: ",-1))),Kl=["innerHTML"],Ml=bl((()=>r("span",{class:"label"},"附件列表: ",-1))),Vl={class:"file"},Pl=C("下载"),El=bl((()=>r("span",{class:"label"},"相关知识: ",-1))),zl={class:"file"},Yl={class:"user-info"},Bl={class:"user-name"},$l={class:"base-info mb24"},Hl=bl((()=>r("div",{class:"title mb15"},"基本信息",-1))),Gl=bl((()=>r("span",{class:"label"},"科室",-1))),Jl={class:"value"},Wl=bl((()=>r("span",{class:"label"},"性别",-1))),Xl={class:"value"},Ql=bl((()=>r("span",{class:"label"},"联系电话",-1))),Zl={class:"value"},en=bl((()=>r("span",{class:"label"},"最后修改时间",-1))),an={class:"value"},tn=bl((()=>r("span",{class:"label"},"直接领导",-1))),ln={class:"value"},nn={class:"version"},on=bl((()=>r("div",{class:"version-title"},"条目版本",-1))),sn=C("查看"),rn={class:"log"},dn=bl((()=>r("div",{class:"log-title"},"日志",-1)));var cn=La(e({name:"ArticleDetail",setup(e){var a;const c=Ue();Ae();const{id:u=""}=c.query,p=i({DEFAULT_AVATAR:null==(a=Na)?void 0:a.defaultAvatar}),m=[{title:"版本",dataIndex:"version"},{title:"修订人",dataIndex:"creator"},{title:"修订时间",dataIndex:"createTime"},{title:"操作",dataIndex:"operation"}],h=[{title:"类型",dataIndex:"logType",customRender:({text:e})=>0===e?"分享":"下载"},{title:"附件名称",dataIndex:"accessoryName",customRender:({text:e})=>null!=e?e:"-"},{title:"操作人",dataIndex:"userName"},{title:"操作时间",dataIndex:"createTime"}],_=k([]),w=k(0),x=k(!1),I=k({evaluate:0,accessory:"",archiveStatus:0,content:"",createTime:"",knowledgeName:"",knowledgeTypeName:"",labels:[],relateds:[],securityLevelName:"",expirationType:"",endTime:"",collectStatus:0,creator:"",user:{},archiveUserName:"",logs:[],knowledgeFlag:""}),T=async()=>{const e=await ft({id:u});I.value=e;const a=e.accessory.split(",");_.value=a.map((e=>{const a=e.split("/");return a[a.length-1]})),I.value.knowledgeTypeName=e.knowledgeTypeName.split(",").join("-"),w.value=e.evaluate},N=async()=>{const e=await(a={knowledgeId:u},Ma("base/rate/check/state",a));var a;x.value=e},{onSearch:L,pagination:R,dataSource:U,getList:S,onTableChange:F}=Wa({fetchData:dt,formatParams:()=>({knowledgeId:u})});b((async()=>{await T(),await N()}));const A=async()=>{const e={knowledgeId:u};if(1===I.value.collectStatus)return await il(e),z.success("取消收藏成功！"),void(I.value.collectStatus=0);var a;await(a=e,Ma("/base/collection",a)),z.success("收藏成功！"),I.value.collectStatus=1},{correctState:D,handleOpenCorrectDialog:O,handleCloseCorrectDialog:j}=function(e){const a=i({visible:!1,id:e});return{correctState:a,handleOpenCorrectDialog:()=>{a.visible=!0},handleCloseCorrectDialog:()=>{a.visible=!1}}}(u),{viewContentState:q,handleViewContent:K,handleCloseViewContentDialog:V}=function(){const e=i({visible:!1,content:""});return{viewContentState:e,handleViewContent:a=>{e.visible=!0,e.content=a},handleCloseViewContentDialog:()=>{e.visible=!1}}}(),{rateState:P,handleRate:E,handleCloseRateDialog:Y}=function(e){const a=i({visible:!1,id:e});return{rateState:a,handleRate:()=>{a.visible=!0},handleCloseRateDialog:()=>{a.visible=!1}}}(u),B=()=>{T(),N()},{share:$}=ct();return(e,a)=>{const i=le,c=ee,k=_e,b=se,T=we,N=M,L=de,S=Q;return o(),f(y,null,[s(S,null,{default:l((()=>[s(c,null,{default:l((()=>[s(i,{span:16},{default:l((()=>[s(c,{class:"mb24"},{default:l((()=>[s(i,{span:12,class:"title"},{default:l((()=>[C(d(I.value.knowledgeName),1)])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:12},{default:l((()=>[s(k,{value:w.value,"onUpdate:value":a[0]||(a[0]=e=>w.value=e),"allow-half":"",disabled:""},null,8,["value"]),r("span",hl,d(w.value)+"分",1)])),_:1}),s(i,{span:12},{default:l((()=>[s(b,{type:"link",class:"mr10",onClick:A},{default:l((()=>[C(d(1===I.value.collectStatus?"取消收藏":"收藏"),1)])),_:1}),s(b,{type:"link",class:"mr10",onClick:a[1]||(a[1]=e=>n($)({id:n(u),title:I.value.knowledgeName,type:I.value.knowledgeFlag,endTime:"0"===I.value.expirationType?"永久有效":I.value.endTime}))},{default:l((()=>[_l])),_:1}),s(b,{type:"link",class:"mr10",onClick:n(O)},{default:l((()=>[wl])),_:1},8,["onClick"]),s(b,{type:"link",onClick:n(E),disabled:x.value},{default:l((()=>[C(d(x.value?"已评价":"评价"),1)])),_:1},8,["onClick","disabled"])])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:12},{default:l((()=>[Cl,r("span",xl,d(I.value.knowledgeTypeName),1)])),_:1}),s(i,{span:12},{default:l((()=>[Il,r("span",Tl,d(I.value.securityLevelName),1)])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:12},{default:l((()=>[Nl,r("span",Ll,d("0"===I.value.expirationType?"永久有效":I.value.endTime),1)])),_:1}),s(i,{span:12},{default:l((()=>[Rl,r("span",Ul,[(o(!0),f(y,null,v(I.value.labels,(e=>(o(),t(T,{class:"tag-item mr10",color:"blue"},{default:l((()=>[C(d(e.labelName),1)])),_:2},1024)))),256))])])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:12},{default:l((()=>[Sl,r("span",Fl,d(I.value.creator),1)])),_:1}),s(i,{span:12},{default:l((()=>[Al,r("span",Dl,d(I.value.createTime),1)])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:12},{default:l((()=>[Ol,r("span",jl,d(0===I.value.archiveStatus?"未归档":"已归档"),1)])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:23},{default:l((()=>[ql,r("div",{class:"value editor-content-view",innerHTML:I.value.content},null,8,Kl)])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[Ml])),_:1}),s(i,{span:19},{default:l((()=>[(o(!0),f(y,null,v(_.value,((e,a)=>(o(),t(c,null,{default:l((()=>[s(i,{span:17},{default:l((()=>[r("div",Vl,d(e),1)])),_:2},1024),s(i,{span:2},{default:l((()=>[s(b,{class:"link-btn",type:"link",onClick:e=>(async e=>{const a=I.value.accessory.split(",");rl(a[e],_.value[e]),await rt({accessoryName:_.value[e],knowledgeId:u,logType:1})})(a)},{default:l((()=>[Pl])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),256))])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[El])),_:1}),s(i,{span:19},{default:l((()=>[(o(!0),f(y,null,v(I.value.relateds,(e=>(o(),f("div",zl,d(e.knowledgeName),1)))),256))])),_:1})])),_:1})])),_:1}),s(i,{span:8},{default:l((()=>[r("div",Yl,[s(N,{src:n(p).DEFAULT_AVATAR},null,8,["src"]),r("div",Bl,d(I.value.creator),1)]),s(n(na)),r("div",$l,[Hl,s(c,{class:"mb10"},{default:l((()=>[s(i,{span:12},{default:l((()=>[Gl])),_:1}),s(i,{span:12},{default:l((()=>[r("span",Jl,d(I.value.user.deptName),1)])),_:1})])),_:1}),s(c,{class:"mb10"},{default:l((()=>[s(i,{span:12},{default:l((()=>[Wl])),_:1}),s(i,{span:12},{default:l((()=>[r("span",Xl,d(0===I.value.user.sex?"男":"女"),1)])),_:1})])),_:1}),s(c,{class:"mb10"},{default:l((()=>[s(i,{span:12},{default:l((()=>[Ql])),_:1}),s(i,{span:12},{default:l((()=>[r("span",Zl,d(I.value.user.moblie),1)])),_:1})])),_:1}),s(c,{class:"mb10"},{default:l((()=>[s(i,{span:12},{default:l((()=>[en])),_:1}),s(i,{span:12},{default:l((()=>[r("span",an,d(I.value.user.updateTime),1)])),_:1})])),_:1}),s(c,{class:"mb10"},{default:l((()=>[s(i,{span:12},{default:l((()=>[tn])),_:1}),s(i,{span:12},{default:l((()=>[r("span",ln,d(I.value.user.higherUp),1)])),_:1})])),_:1})]),r("div",nn,[on,s(L,{columns:m,"data-source":I.value.logs,bordered:""},{bodyCell:l((({column:e,text:a,record:s})=>["operation"===e.dataIndex?(o(),t(b,{key:0,type:"link",class:"action-btn",onClick:e=>n(K)(s.content)},{default:l((()=>[sn])),_:2},1032,["onClick"])):g("",!0)])),_:1},8,["data-source"])]),r("div",rn,[dn,s(L,{rowKey:"id",columns:h,"data-source":n(U),pagination:n(R),bordered:"",onChange:n(F)},null,8,["data-source","pagination","onChange"])])])),_:1})])),_:1})])),_:1}),n(D).visible?(o(),t(ml,{key:0,id:n(u),onCancel:n(j)},null,8,["id","onCancel"])):g("",!0),n(q).visible?(o(),t(yl,{key:1,content:n(q).content,onCancel:n(V)},null,8,["content","onCancel"])):g("",!0),n(P).visible?(o(),t(kl,{key:2,knowledgeId:n(P).id,onSuccess:B,onCancel:n(Y)},null,8,["knowledgeId","onCancel"])):g("",!0)],64)}}}),[["__scopeId","data-v-aed7a5be"]]);const un=e=>Ma("/user/query",e),pn=e=>Ma("/role/query",e),mn=e({props:{info:null},emits:["success","cancel"],setup(e,{emit:a}){const n=e,{info:i}=u(n),r=k([]),c=k([]);(async()=>{const{records:e}=await pn({});c.value=e.map((({roleName:e,roleDesc:a,id:t})=>({label:`${e}（${a}）`,value:t})))})();const p=async()=>{const e={userIds:i.value.map((e=>e.puserId)).join(","),roleIds:r.value.join(",")};var t;await(t=e,Va("/user/set/role",t)),z.success("设置成功"),a("success"),m()},m=()=>{a("cancel",!1)};return(e,a)=>{const n=xe,i=le,u=ee,g=Ce,k=ce;return o(),t(k,{title:"设置角色",visible:!0,closable:!1,width:"600px",destroyOnClose:!0,onOk:p,onCancel:m},{default:l((()=>[s(g,{value:r.value,"onUpdate:value":a[0]||(a[0]=e=>r.value=e)},{default:l((()=>[(o(!0),f(y,null,v(c.value,(e=>(o(),t(u,null,{default:l((()=>[s(i,{span:24},{default:l((()=>[s(n,{value:e.value},{default:l((()=>[C(d(e.label),1)])),_:2},1032,["value"])])),_:2},1024)])),_:2},1024)))),256))])),_:1},8,["value"])])),_:1})}}}),fn=C(" 确认回收该用户所有权限？ "),vn=e({props:{info:null},emits:["success","cancel"],setup(e,{emit:a}){const n=e,{info:s}=u(n),i=async()=>{const e={userIds:s.value.map((e=>e.id)).join(",")};var t;await(t=e,Ma("/user/del/role",t)),z.success("回收成功"),a("success"),r()},r=()=>{a("cancel",!1)};return(e,a)=>{const n=ce;return o(),t(n,{visible:!0,closable:!1,width:"400px",destroyOnClose:!0,onOk:i,onCancel:r},{default:l((()=>[fn])),_:1})}}});const yn=C("查询"),gn=C("重置"),kn=C("设置角色"),bn=C("回收权限"),hn=C("查看操作日志");var _n=La(e({name:"UserList",setup(e){const a=k([{label:"超级管理员",value:"00"},{label:"子系统管理员",value:"01"},{label:"业务导员",value:"02"},{label:"局领导",value:"03"}]),r=[{title:"账号",dataIndex:"account",key:"account",align:"center"},{title:"姓名",dataIndex:"userName",key:"userName",align:"center"},{title:"职务",dataIndex:"position",key:"position",align:"center"},{title:"办公室电话",dataIndex:"officeTelephone",key:"officeTelephone",align:"center"},{title:"手机号",dataIndex:"moblie",key:"moblie",align:"center"},{title:"直接上级",dataIndex:"higherUp",key:"higherUp",align:"center"},{title:"系统角色",dataIndex:"roleName",key:"roleName",align:"center"}],d=k([]),c=i([]),u=k([]),p=i({userName:"",rid:[]});L(u,(e=>{u.value.length>0?p.deptId=u.value[0]:p.deptId=""}));const m={onChange:(e,a)=>{d.value=a}},{onSearch:v,onReset:y,pagination:b,dataSource:h,searchFormRef:_,onTableChange:w,getList:C}=Wa({fetchData:un,formatParams:()=>({...p})});(async()=>{const e=await Ma("/dept/tree/query");Object.assign(c,e)})();const x=i({visible:!1}),I=()=>{x.visible=!0},T=()=>{x.visible=!1},N=i({visible:!1}),R=()=>{N.visible=!0},U=()=>{N.visible=!1};return(e,i)=>{const k=ae,L=te,S=le,F=Ie,A=se,D=ie,O=ee,j=re,q=Q,K=Te,M=de;return o(),f("div",null,[s(q,{class:"search-box"},{default:l((()=>[s(j,{ref_key:"searchFormRef",ref:_,layout:"inline",model:n(p)},{default:l((()=>[s(O,{gutter:[24,16]},{default:l((()=>[s(S,null,{default:l((()=>[s(L,{label:"姓名",name:"userName"},{default:l((()=>[s(k,{value:n(p).userName,"onUpdate:value":i[0]||(i[0]=e=>n(p).userName=e),valueModifiers:{trim:!0},placeholder:"请输入姓名",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(S,null,{default:l((()=>[s(L,{label:"角色",name:"rid"},{default:l((()=>[s(F,{style:{"min-width":"250px"},value:n(p).rid,"onUpdate:value":i[1]||(i[1]=e=>n(p).rid=e),options:a.value,placeholder:"请选择角色","allow-clear":""},null,8,["value","options"])])),_:1})])),_:1}),s(S,null,{default:l((()=>[s(L,null,{default:l((()=>[s(D,{size:20},{default:l((()=>[s(A,{type:"primary",onClick:n(v)},{default:l((()=>[yn])),_:1},8,["onClick"]),s(A,{onClick:n(y)},{default:l((()=>[gn])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(O,{class:"mt20"},{default:l((()=>[s(S,{span:8},{default:l((()=>[s(q,{class:"mr15",title:"组织结构"},{default:l((()=>[s(K,{"tree-data":n(c),"field-names":{title:"deptName",key:"id",children:"children"},defaultExpandAll:"",selectedKeys:u.value,"onUpdate:selectedKeys":i[2]||(i[2]=e=>u.value=e)},null,8,["tree-data","selectedKeys"])])),_:1})])),_:1}),s(S,{span:16},{default:l((()=>[s(q,null,{default:l((()=>[s(O,{class:"action-btn-box"},{default:l((()=>[s(A,{class:"mr15",type:"primary",disabled:!d.value.length,onClick:R},{default:l((()=>[kn])),_:1},8,["disabled"]),s(A,{danger:"",onClick:I,disabled:!d.value.length},{default:l((()=>[bn])),_:1},8,["disabled"])])),_:1}),s(M,{rowKey:"id","row-selection":m,columns:r,"data-source":n(h),pagination:n(b),bordered:"",onChange:n(w)},{bodyCell:l((({column:e,record:a})=>["operation"===e.dataIndex?(o(),t(A,{key:0,type:"link",class:"action-btn",onClick:e=>{}},{default:l((()=>[hn])),_:2},1032,["onClick"])):g("",!0)])),_:1},8,["data-source","pagination","onChange"])])),_:1})])),_:1})])),_:1}),n(N).visible?(o(),t(mn,{key:0,info:d.value,onSuccess:n(C),onCancel:U},null,8,["info","onSuccess"])):g("",!0),n(x).visible?(o(),t(vn,{key:1,info:d.value,onSuccess:n(C),onCancel:T},null,8,["info","onSuccess"])):g("",!0)])}}}),[["__scopeId","data-v-1f0201ae"]]);const wn=e({props:{type:null,info:null},emits:["success","cancel"],setup(e,{emit:a}){const r=e,{type:d,info:c}=u(r),p=re.useForm,m=i({labelCol:{span:4},wrapperCol:{span:20}}),f=i({name:"",desc:""}),v=k([]),y=k([]),g=i({name:[{required:!0,message:"请填写角色名称！"}],desc:[{required:!1}],menu:[{required:!0,message:"请选择菜单项！"}]}),b=i([]),h={};(async()=>{const e=await Ma("/menu/tree/query");Object.assign(b,e);const a=e=>{e.forEach((({id:e,menuName:t,children:l})=>{h[e]=t,l&&l.length&&a(l)}))};a(e)})();const _=async()=>{var e,a;const{roleName:t,roleDesc:l,menus:n}=await(o={id:null!=(a=null==(e=null==c?void 0:c.value)?void 0:e.id)?a:""},Ma("/role/detail",o));var o;f.desc=l,f.name=t,v.value=n?n.filter((({status:e})=>"0"===e)).map((e=>e.menuId)):[],y.value=n?n.filter((({status:e})=>"1"===e)).map((e=>e.menuId)):[]};"update"===d.value&&_();const w=(e,a)=>{y.value=a.halfCheckedKeys},{resetFields:C,validate:x,validateInfos:L}=p(f,g),R=async e=>{var a,t;const{name:l,desc:n}=e,o=[];v.value.forEach((e=>{"可编辑"!==h[e]&&"仅查看"!==h[e]&&o.push(h[e])}));let s=v.value.map((e=>({menuId:e})));s=[...s,...y.value.map((e=>({menuId:e,status:1})))];const i={roleName:l,roleDesc:n,menuDTOS:s,roleModules:o.join(",")};if("create"===d.value)return await(r=i,Va("/role/save",r));var r;const u={...i,id:null!=(t=null==(a=null==c?void 0:c.value)?void 0:a.id)?t:""};return await(e=>Va("/role/update",e))(u)},U=async()=>{try{const e=await x();await R(e),z.success("成功!"),a("success"),S()}catch(e){}},S=()=>{C(),a("cancel",!1)};return(e,a)=>{const i=ae,r=te,c=he,u=Te,p=re,y=ce;return o(),t(y,{visible:!0,title:"create"===n(d)?"新建角色":"更新角色",closable:!1,width:"600px",destroyOnClose:!0,onOk:U,onCancel:S},{default:l((()=>[s(p,T(N(n(m))),{default:l((()=>[s(r,I({label:"角色名称"},n(L).name),{default:l((()=>[s(i,{value:n(f).name,"onUpdate:value":a[0]||(a[0]=e=>n(f).name=e),placeholder:"请输入角色名称"},null,8,["value"])])),_:1},16),s(r,I({label:"角色描述"},n(L).desc),{default:l((()=>[s(c,{value:n(f).desc,"onUpdate:value":a[1]||(a[1]=e=>n(f).desc=e),rows:4,maxlength:6},null,8,["value"])])),_:1},16),s(r,I({label:"菜单列表"},n(L).menu),{default:l((()=>[s(u,{checkedKeys:v.value,"onUpdate:checkedKeys":a[2]||(a[2]=e=>v.value=e),checkable:"","tree-data":n(b),fieldNames:{children:"children",title:"menuName",key:"id"},onCheck:w},null,8,["checkedKeys","tree-data"])])),_:1},16)])),_:1},16)])),_:1},8,["title"])}}});const Cn=C("查询"),xn=C("重置"),In=C("新建"),Tn=C("编辑"),Nn=C("删除");var Ln=La(e({name:"RoleList",setup(e){const a=[{title:"角色名称",dataIndex:"roleName",key:"roleName",align:"center"},{title:"模块",dataIndex:"roleModules",key:"roleModules",align:"center"},{title:"描述",dataIndex:"roleDesc",key:"roleDesc",align:"center"},{title:"操作",dataIndex:"operation",align:"center"}],r=i({roleName:""}),{onSearch:d,onReset:c,pagination:u,dataSource:p,searchFormRef:m,onTableChange:v,getList:k}=Wa({fetchData:pn,formatParams:()=>({...r})}),b=async({id:e})=>{var a;await(a={roleId:e},Ma("/role/del",a)),z.success("删除成功！"),k()},h=i({visible:!1,currentRow:{},type:"create"}),_=(e,a)=>{h.visible=!0,h.type=e,a&&(h.currentRow=a)},w=()=>{h.visible=!1};return(e,i)=>{const C=ae,x=te,I=le,T=se,N=ie,L=ee,R=re,U=Q,S=de;return o(),f("div",null,[s(U,{class:"search-box"},{default:l((()=>[s(R,{ref_key:"searchFormRef",ref:m,layout:"inline",model:n(r)},{default:l((()=>[s(L,{gutter:[24,16]},{default:l((()=>[s(I,null,{default:l((()=>[s(x,{label:"角色名称",name:"roleName"},{default:l((()=>[s(C,{value:n(r).roleName,"onUpdate:value":i[0]||(i[0]=e=>n(r).roleName=e),valueModifiers:{trim:!0},placeholder:"请输入角色名称",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(I,null,{default:l((()=>[s(x,null,{default:l((()=>[s(N,{size:20},{default:l((()=>[s(T,{type:"primary",onClick:n(d)},{default:l((()=>[Cn])),_:1},8,["onClick"]),s(T,{onClick:n(c)},{default:l((()=>[xn])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(U,null,{default:l((()=>[s(L,{class:"action-btn-box"},{default:l((()=>[s(T,{style:{"background-color":"#36bc62","border-color":"#36bc62"},type:"primary",onClick:i[1]||(i[1]=e=>_("create"))},{default:l((()=>[In])),_:1})])),_:1}),s(S,{rowKey:"id",columns:a,"data-source":n(p),pagination:n(u),bordered:"",onChange:n(v)},{bodyCell:l((({column:e,record:a})=>["operation"===e.dataIndex?(o(),f(y,{key:0},[s(T,{type:"link",class:"action-btn",onClick:e=>_("update",a)},{default:l((()=>[Tn])),_:2},1032,["onClick"]),s(T,{type:"link",class:"action-btn",onClick:e=>b(a)},{default:l((()=>[Nn])),_:2},1032,["onClick"])],64)):g("",!0)])),_:1},8,["data-source","pagination","onChange"])])),_:1}),n(h).visible?(o(),t(wn,{key:0,type:n(h).type,info:n(h).currentRow,onSuccess:n(k),onCancel:w},null,8,["type","info","onSuccess"])):g("",!0)])}}}),[["__scopeId","data-v-22c78eb9"]]);const Rn=e({props:{type:null,category:null,id:null,name:null},emits:["success","cancel"],setup(e,{emit:a}){const r=e,{type:d,name:c,category:p,id:m}=u(r),f=re.useForm,v=i({labelCol:{span:4},wrapperCol:{span:20}}),y=i({name:"update"===d.value?c.value:""}),g=i({name:[{required:!0,message:"请填写名称！"}]}),{resetFields:k,validate:b,validateInfos:h}=f(y,g),_=async e=>{return"create"===d.value?await(a={dictName:e.name,dictPid:m.value,dictType:p.value},Va("/dict/add",a)):await(e=>Va("/dict/update",e))({dictName:e.name,id:m.value,dictType:p.value});var a},w=async()=>{try{const e=await b();await _(e),z.success("成功！"),a("success"),C()}catch(e){}},C=()=>{k(),a("cancel",!1)};return(e,a)=>{const i=ae,r=te,c=re,u=ce;return o(),t(u,{visible:!0,title:"create"===n(d)?"新建":"更新",closable:!1,width:"400px",destroyOnClose:!0,onOk:w,onCancel:C},{default:l((()=>[s(c,T(N(n(v))),{default:l((()=>[s(r,I({label:"名称"},n(h).name),{default:l((()=>[s(i,{value:n(y).name,"onUpdate:value":a[0]||(a[0]=e=>n(y).name=e),placeholder:"请输入名称"},null,8,["value"])])),_:1},16)])),_:1},16)])),_:1},8,["title"])}}});const Un=C("新建"),Sn={class:"custom-tree-node"},Fn=e({name:"Dictionary",setup(e){const a=i({status:"1"}),c=k([]),u=async()=>{const e=await et({type:a.status});c.value=e};u();const p=()=>{u()},m=i({visible:!1,id:"",type:"create",category:"0",name:""}),b=(e,t)=>{var l;const n={visible:!0,id:null!=(l=null==t?void 0:t.id)?l:"",type:e,category:a.status,name:"update"===e?t&&t.dictName:""};Object.assign(m,n),u()},h=async(e,a)=>{await(e=>Ma("/dict/del",e))({id:a.id+""}),z.success("删除成功！"),u()},_=()=>{m.visible=!1,u()};return(e,i)=>{const u=W,k=X,w=Q,C=se,x=ee,I=me;return o(),f("div",null,[s(w,{class:"search-box-wrap mt15"},{default:l((()=>[s(k,{activeKey:n(a).status,"onUpdate:activeKey":i[0]||(i[0]=e=>n(a).status=e),type:"card",tabBarGutter:6,class:"search-tabs",onChange:p},{default:l((()=>[(o(!0),f(y,null,v(n(Za),(e=>(o(),t(u,{key:e.value,tab:e.label},null,8,["tab"])))),128))])),_:1},8,["activeKey"])])),_:1}),s(w,{class:"table-box mt20"},{default:l((()=>["1"===n(a).status?(o(),t(x,{key:0,class:"action-btn-box"},{default:l((()=>[s(C,{style:{"background-color":"#36bc62","border-color":"#36bc62"},type:"primary",onClick:i[1]||(i[1]=e=>b("create"))},{default:l((()=>[Un])),_:1})])),_:1})):g("",!0),c.value.length?(o(),t(n(la),{key:2,data:c.value,"node-key":"id","default-expand-all":"","expand-on-click-node":!1,props:{label:"dictName"}},D({_:2},["1"===n(a).status?{name:"default",fn:l((({node:e,data:a})=>[r("span",Sn,[r("span",null,d(e.label),1),r("span",null,[s(n($e),{onClick:e=>b("create",a),class:"mr5"},null,8,["onClick"]),s(n(He),{onClick:e=>b("update",a),class:"mr5"},null,8,["onClick"]),s(I,{title:"确定要删除该节点吗?","ok-text":"确认","cancel-text":"取消",onConfirm:e=>h(0,a),onCancel:i[2]||(i[2]=()=>{})},{default:l((()=>[s(n(Ge))])),_:2},1032,["onConfirm"])])])]))}:void 0]),1032,["data"])):(o(),t(n(ta),{key:1,"image-size":200,description:"暂无数据"}))])),_:1}),n(m).visible?(o(),t(Rn,{key:0,type:n(m).type,category:n(m).category,id:n(m).id,name:n(m).name,onSuccess:i[3]||(i[3]=()=>{}),onCancel:_},null,8,["type","category","id","name"])):g("",!0)])}}});const An=C("查询"),Dn=C("重置"),On=C("取消收藏 "),jn=C("分享");var qn=La(e({name:"CollectionList",setup(e){Ae();const r=Ue(),c=Ea(),u=r.meta.key,m=p((()=>c.menuOperateAuthMap[u])),v=p((()=>{N.value;const e=[{title:"类型",dataIndex:"knowledgeFlag",key:"knowledgeFlag",align:"center",customRender:({text:e})=>Qa[e]},{title:"知识条目",dataIndex:"knowledgeName",key:"knowledgeName",align:"center"},{title:"分类",dataIndex:"knowledgeTypeName",key:"knowledgeTypeName",align:"center",customRender:({text:e})=>e?e.split(", ").join("-"):""},{title:"评分",dataIndex:"evaluate",key:"evaluate",align:"center"},{title:"收藏时间",dataIndex:"createTime",key:"createTime",align:"center"},{title:"操作",dataIndex:"operation",align:"center"}];return m.value||e.pop(),e})),k=i({knowledgeName:""}),{onSearch:b,onReset:h,pagination:_,dataSource:w,getList:x,searchFormRef:I,onTableChange:T,sortedInfo:N}=Wa({fetchData:sl,formatParams:()=>({...k})}),{share:L}=ct();return(e,i)=>{const r=ae,c=te,u=le,p=se,m=ie,N=ee,R=re,U=Q,S=a("router-link"),F=de;return o(),f("div",null,[s(U,{class:"search-box"},{default:l((()=>[s(R,{ref_key:"searchFormRef",ref:I,layout:"inline",model:n(k)},{default:l((()=>[s(N,{gutter:[24,16]},{default:l((()=>[s(u,null,{default:l((()=>[s(c,{label:"条目标题",name:"knowledgeName"},{default:l((()=>[s(r,{value:n(k).knowledgeName,"onUpdate:value":i[0]||(i[0]=e=>n(k).knowledgeName=e),valueModifiers:{trim:!0},placeholder:"请输入条目标题",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(u,null,{default:l((()=>[s(c,null,{default:l((()=>[s(m,{size:20},{default:l((()=>[s(p,{type:"primary",onClick:n(b)},{default:l((()=>[An])),_:1},8,["onClick"]),s(p,{onClick:n(h)},{default:l((()=>[Dn])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(U,{class:"table-box mt20"},{default:l((()=>[s(F,{rowKey:"id",columns:n(v),"data-source":n(w),pagination:n(_),bordered:"",onChange:n(T)},{bodyCell:l((({column:e,text:a,record:i})=>["knowledgeName"===e.dataIndex?(o(),t(S,{key:0,to:{name:"ArticleDetail",query:{id:i.id}}},{default:l((()=>[C(d(a),1)])),_:2},1032,["to"])):g("",!0),"operation"===e.dataIndex?(o(),f(y,{key:1},[s(p,{type:"link",class:"action-btn",onClick:e=>(async e=>{await il({knowledgeId:e.id}),z.success("取消收藏成功"),x()})({id:i.id})},{default:l((()=>[On])),_:2},1032,["onClick"]),s(p,{type:"link",class:"action-btn",onClick:e=>n(L)({id:i.id,title:i.knowledgeName,type:i.knowledgeFlag,endTime:"0"===i.expirationType?"永久有效":i.endTime})},{default:l((()=>[jn])),_:2},1032,["onClick"])],64)):g("",!0)])),_:1},8,["columns","data-source","pagination","onChange"])])),_:1})])}}}),[["__scopeId","data-v-55dba0da"]]);const Kn=e=>(F("data-v-f8c94e24"),e=e(),A(),e),Mn=Kn((()=>r("div",null,"纠错内容:",-1))),Vn=Kn((()=>r("div",null,"补充图片:",-1))),Pn=Kn((()=>r("span",{class:"label"},"附件列表: ",-1))),En={class:"file"},zn=C("下载"),Yn=Kn((()=>r("div",null,"纠错人:",-1))),Bn=Kn((()=>r("div",null,"纠错时间:",-1))),$n=C("关闭");var Hn=La(e({props:{id:null},emits:["success","cancel"],setup(e,{emit:a}){const c=e,p=k([]),m=i({accessory:"",content:"",createTime:"",id:"",knowledgeId:"",opUser:"",picture:"",userId:""}),h=k([]),{id:_}=u(c),w=async()=>{const e=await(a={knowledgeId:_.value},Ma("/base/error/correction/detail",a));var a;Object.assign(m,e);const t=e.accessory.split(",");if(p.value=t.map((e=>{const a=e.split("/");return a[a.length-1]})),e.picture){const e=m.picture.split(",");h.value=Oa(e)}};b((()=>{w()}));const x=()=>{a("success"),I()},I=()=>{a("cancel")};return(e,a)=>{const i=le,c=ee,u=se,k=ce;return o(),t(k,{title:"查看",visible:!0,maskClosable:!1,closable:!1,width:"600px",destroyOnClose:"",onOk:x,onCancel:I},{footer:l((()=>[s(u,{key:"back",onClick:I},{default:l((()=>[$n])),_:1})])),default:l((()=>[s(c,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[Mn])),_:1}),s(i,{span:19},{default:l((()=>[C(d(n(m).content),1)])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[Vn])),_:1}),s(i,{span:19},{default:l((()=>[s(Ot,{disabled:"",type:"1",modelValue:h.value,"max-length":h.value.length},null,8,["modelValue","max-length"])])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[Pn])),_:1}),s(i,{span:19},{default:l((()=>[(o(!0),f(y,null,v(p.value,((e,a)=>(o(),t(c,null,{default:l((()=>[s(i,{span:17},{default:l((()=>[r("div",En,d(e),1)])),_:2},1024),s(i,{span:2},{default:l((()=>[e?(o(),t(u,{key:0,class:"link-btn",type:"link",onClick:e=>(e=>{const a=m.accessory.split(",");rl(a[e],p.value[e])})(a)},{default:l((()=>[zn])),_:2},1032,["onClick"])):g("",!0)])),_:2},1024)])),_:2},1024)))),256))])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[Yn])),_:1}),s(i,{span:19},{default:l((()=>[C(d(n(m).opUser),1)])),_:1})])),_:1}),s(c,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[Bn])),_:1}),s(i,{span:19},{default:l((()=>[C(d(n(m).createTime),1)])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-f8c94e24"]]);const Gn=C("查询"),Jn=C("重置"),Wn=C("查看 "),Xn=C("删除");var Qn=La(e({name:"CorrectionList",setup(e){Ae();const c=Ue(),u=Ea(),m=c.meta.key,v=p((()=>u.menuOperateAuthMap[m])),k=p((()=>{L.value;const e=[{title:"类型",dataIndex:"knowledgeFlag",key:"knowledgeFlag",align:"center",customRender:({text:e})=>Qa[e]},{title:"知识条目",dataIndex:"knowledgeName",key:"knowledgeName",align:"center"},{title:"分类",dataIndex:"knowledgeTypeName",key:"knowledgeTypeName",align:"center",customRender:({text:e})=>e?e.split(", ").join("-"):""},{title:"纠错时间",dataIndex:"createTime",key:"createTime",align:"center"},{title:"操作",dataIndex:"operation",align:"center"}];return v.value||e.pop(),e})),b=i({knowledgeName:""}),{onSearch:h,onReset:_,pagination:w,dataSource:x,getList:I,searchFormRef:T,onTableChange:N,sortedInfo:L}=Wa({fetchData:dl,formatParams:()=>({...b})}),R=i({visible:!1,id:"1"}),U=()=>{R.visible=!1},S=async e=>{var a;await(a={knowledgeId:e.id},Ma("/base/error/correction/del",a)),z.success("删除成功"),I()};return(e,i)=>{const c=ae,u=te,p=le,m=se,v=ie,I=ee,L=re,F=Q,A=a("router-link"),D=me,O=de;return o(),f(y,null,[r("div",null,[s(F,{class:"search-box"},{default:l((()=>[s(L,{ref_key:"searchFormRef",ref:T,layout:"inline",model:n(b)},{default:l((()=>[s(I,{gutter:[24,16]},{default:l((()=>[s(p,null,{default:l((()=>[s(u,{label:"条目标题",name:"knowledgeName"},{default:l((()=>[s(c,{value:n(b).knowledgeName,"onUpdate:value":i[0]||(i[0]=e=>n(b).knowledgeName=e),valueModifiers:{trim:!0},placeholder:"请输入条目标题",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(p,null,{default:l((()=>[s(u,null,{default:l((()=>[s(v,{size:20},{default:l((()=>[s(m,{type:"primary",onClick:n(h)},{default:l((()=>[Gn])),_:1},8,["onClick"]),s(m,{onClick:n(_)},{default:l((()=>[Jn])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(F,{class:"table-box mt20"},{default:l((()=>[s(O,{rowKey:"id",columns:n(k),"data-source":n(x),pagination:n(w),bordered:"",onChange:n(N)},{bodyCell:l((({column:e,text:a,record:n})=>["knowledgeName"===e.dataIndex?(o(),t(A,{key:0,to:{name:"ArticleDetail",query:{id:n.id}}},{default:l((()=>[C(d(a),1)])),_:2},1032,["to"])):g("",!0),"operation"===e.dataIndex?(o(),f(y,{key:1},[s(m,{type:"link",class:"action-btn",onClick:e=>(e=>{R.visible=!0,R.id=e.id})({id:n.id})},{default:l((()=>[Wn])),_:2},1032,["onClick"]),s(D,{title:"确定要删除该条目吗?","ok-text":"确认","cancel-text":"取消",onConfirm:e=>S({id:n.id}),onCancel:i[1]||(i[1]=()=>{})},{default:l((()=>[s(m,{type:"link",class:"action-btn"},{default:l((()=>[Xn])),_:1})])),_:2},1032,["onConfirm"])],64)):g("",!0)])),_:1},8,["columns","data-source","pagination","onChange"])])),_:1})]),n(R).visible?(o(),t(Hn,{key:0,id:n(R).id,onCancel:U},null,8,["id"])):g("",!0)],64)}}}),[["__scopeId","data-v-5f84ca7e"]]);const Zn=()=>{const e=k({title:{text:"知识数量统计",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} 个"},xAxis:{type:"category",data:[""],axisLabel:{interval:0,rotate:-38}},yAxis:{type:"value"},series:[{name:"知识数量统计",type:"bar",data:[0]}]});return{countStatisticalOption:e,fetchKnowledgeNumber:async a=>{const t=await(l=a,Ma("/dict/statistics/type/knowledge/number",l));var l;const n=[],o=[];t.forEach((e=>{n.push(e.dictName),o.push(e.num)})),e.value.xAxis.data=n,e.value.series[0].data=o}}},eo=(e,a,t)=>{const l=[],n=[];return e.forEach((e=>{if("2"===a.timeType){const a=ra().set("month",Number(e.xAxisData)).format("YYYY-MM");l.push(a)}else"flag"===t?l.push(Qa[e.xAxisData]):l.push(e.xAxisData);n.push(e.num)})),{xAxisData:l,seriesData:n}},ao=()=>{const e=k({title:{text:"知识数量增长趋势",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} 个"},xAxis:{type:"category",data:[""],axisLabel:{interval:0,rotate:-38}},yAxis:{type:"value"},series:[{name:"知识数量增长趋势",type:"line",data:[0]}]});return{countTrendOption:e,fetchDateRangeCount:async a=>{const t=await(l=a,Ma("/base/statistics/increase",l));var l;const{xAxisData:n,seriesData:o}=eo(t,a);e.value.xAxis.data=n,e.value.series[0].data=o}}},to=()=>{const e=k({title:{text:"知识类型数量统计",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} 个"},xAxis:{type:"category",data:["专题","图片","视频","文件"]},yAxis:{type:"value"},series:[{name:"知识类型数量统计",type:"bar",data:[120,200,150,80]}]});return{typeCountStatisticalOption:e,fetchKnowledgeTypeNumber:async a=>{const t=await(l=a,Ma("/dict/statistics/knowledge/flag/number",l));var l;const{xAxisData:n,seriesData:o}=eo(t,a,"flag");e.value.xAxis.data=n,e.value.series[0].data=o}}},lo=()=>{const e=[{title:"序号",dataIndex:"index",align:"center",width:80,customRender:({index:e})=>e+1},{title:"条目",dataIndex:"knowledgeName",align:"center"},{title:"类型",dataIndex:"knowledgeFlag",key:"knowledgeFlag",align:"center",customRender:({text:e})=>Qa[e]},{title:"分类",dataIndex:"knowledgeTypeName",key:"knowledgeTypeName",align:"center",customRender:({text:e})=>e?e.split(", ").join("-"):""},{title:"创建人",dataIndex:"creator",align:"center"},{title:"评价",dataIndex:"evaluate",align:"center"},{title:"浏览量",dataIndex:"browseNum",align:"center"}],a=k([]);return{columns:e,topData:a,fetchTopData:async()=>{const{records:e}=await Ma("base/query/ranking");a.value=e}}},no=()=>{const e=k([]);return{employeeContributionRankingColumns:[{title:"序号",dataIndex:"index",align:"center",width:80,customRender:({index:e})=>e+1},{title:"姓名",dataIndex:"userName",align:"center"},{title:"科室",dataIndex:"deptName",align:"center"},{title:"数量",dataIndex:"num",align:"center"}],employeeContributionData:e,fetchEmployeeContributionData:async a=>{const t=await(l=a,Ma("/user/statistics/user/create/knowledge/num",l));var l;e.value=t}}},oo=()=>{const e=k({title:{text:"科室贡献",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:[""]},series:[{name:"科室贡献",type:"pie",radius:"55%",center:["50%","60%"],data:[{}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]});return{departmentContributionOption:e,fetchDepartmentContributionData:async a=>{const t=await(l=a,Ma("/dept/statistics/dept/create/knowledge/ration",l));var l;e.value.series[0].data=t.map((e=>({value:e.num,name:e.xAxisData}))),e.value.legend.data=t.map((e=>e.xAxisData))}}};const so=e=>(F("data-v-19ae7d02"),e=e(),A(),e),io=C("本周"),ro=C("本月"),co=C("本年"),uo=C("自定义时间范围"),po=so((()=>r("div",{class:"title mb15"},"热门排行榜",-1))),mo=so((()=>r("div",{class:"title mb15"},"员工贡献排行榜",-1)));const fo=[{path:"/",component:Ba,meta:{title:"知识首页",icon:"HomeFilled",level:"1",key:"Home"},children:[{path:"",name:"Home",component:it}]},{path:"/myKnowledge",name:"myKnowledge",component:Ba,meta:{title:"我的知识",icon:"BookFilled"},children:[{path:"knowledge",name:"KnowledgeList",meta:{title:"我的知识",keepAlive:!0,key:"KnowledgeList"},component:Lt},{path:"create",name:"KnowledgeCreate",meta:{title:"创建知识",isMenu:!1,keepAlive:!1},component:Qt},{path:"create-topic",name:"KnowledgeCreateTopic",meta:{title:"创建标题",isMenu:!1,keepAlive:!1},component:ol},{path:"article-detail",name:"ArticleDetail",meta:{title:"详情",isMenu:!1,keepAlive:!1},component:cn},{path:"collection",name:"CollectionList",meta:{title:"我的收藏",keepAlive:!0,key:"CollectionList"},component:qn},{path:"correction",name:"CorrectionList",meta:{title:"我的纠错",keepAlive:!0,key:"CorrectionList"},component:Qn}]},{path:"/statistical",component:Ba,meta:{title:"统计报表",icon:"PieChartFilled",level:"1",key:"Statistical"},children:[{path:"",name:"Statistical",component:La(e({name:"Statistical",setup(e){const r=k("0"),c="YYYY-MM-DD",u=ra().startOf("month").format(c),p=ra().endOf("month").format(c),m=k([u,p]),{countStatisticalOption:f,fetchKnowledgeNumber:v}=Zn(),{countTrendOption:y,fetchDateRangeCount:b}=ao(),{typeCountStatisticalOption:h,fetchKnowledgeTypeNumber:_}=to(),{columns:w,topData:x,fetchTopData:I}=lo(),{employeeContributionRankingColumns:T,employeeContributionData:N,fetchEmployeeContributionData:L}=no(),{departmentContributionOption:R,fetchDepartmentContributionData:U}=oo();return O((()=>{const e=i({timeType:r.value});"3"===r.value&&(e.startTime=m.value[0],e.endTime=m.value[1]),(e=>{v(e),b(e),_(e),I(),L(e),U(e)})(e)})),(e,i)=>{const u=ve,p=ye,v=oe,k=a("v-chart"),b=le,_=ee,I=a("router-link"),L=de,U=Q;return o(),t(U,null,{default:l((()=>[s(p,{class:"mb50 mr10",value:r.value,"onUpdate:value":i[0]||(i[0]=e=>r.value=e)},{default:l((()=>[s(u,{value:"0"},{default:l((()=>[io])),_:1}),s(u,{value:"1"},{default:l((()=>[ro])),_:1}),s(u,{value:"2"},{default:l((()=>[co])),_:1}),s(u,{value:"3"},{default:l((()=>[uo])),_:1})])),_:1},8,["value"]),"3"===r.value?(o(),t(v,{key:0,value:m.value,"onUpdate:value":i[1]||(i[1]=e=>m.value=e),format:c,"value-format":c,valueFormat:"YYYY-MM-DD"},null,8,["value"])):g("",!0),s(_,{class:"mb24"},{default:l((()=>[s(b,{span:12},{default:l((()=>[s(k,{class:"chart",option:n(f)},null,8,["option"])])),_:1}),s(b,{span:12},{default:l((()=>[s(k,{class:"chart",option:n(y)},null,8,["option"])])),_:1})])),_:1}),s(_,{class:"mb24"},{default:l((()=>[s(b,{span:12},{default:l((()=>[s(k,{class:"chart",option:n(h)},null,8,["option"])])),_:1})])),_:1}),s(_,{class:"mb24"},{default:l((()=>[s(b,{span:24},{default:l((()=>[po,s(L,{columns:n(w),"data-source":n(x),bordered:"",pagination:!1},{bodyCell:l((({column:e,text:a,record:n})=>["knowledgeName"===e.dataIndex?(o(),t(I,{key:0,to:{name:"ArticleDetail",query:{id:n.id}}},{default:l((()=>[C(d(a),1)])),_:2},1032,["to"])):g("",!0)])),_:1},8,["columns","data-source"])])),_:1})])),_:1}),s(_,{class:"mb24"},{default:l((()=>[s(b,{span:12},{default:l((()=>[mo,s(L,{columns:n(T),"data-source":n(N),bordered:"",pagination:!1},null,8,["columns","data-source"])])),_:1}),s(b,{span:12},{default:l((()=>[s(k,{class:"chart",option:n(R)},null,8,["option"])])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-19ae7d02"]])}]},{path:"/systemSetter",name:"systemSetter",component:Ba,meta:{title:"系统管理",icon:"SettingFilled"},children:[{path:"user",name:"UserList",meta:{title:"用户管理",keepAlive:!0,key:"UserList"},component:_n},{path:"role",name:"RoleList",meta:{title:"角色与权限",keepAlive:!0,key:"RoleList"},component:Ln},{path:"dictionary",name:"Dictionary",meta:{title:"数据字典",keepAlive:!1,key:"Dictionary"},component:Fn}]}],vo=[{path:"/not-login",meta:{isMenu:!1},component:Ha,children:[{path:"",component:Ga}]}],yo=De({history:Oe(),routes:[...fo,...vo]});const go=We();(async()=>{da([ca,ua,pa,ma,fa,va,ya,ga]);const e=j(ka);!function(e){e.use(go)}(e),yo.beforeEach((async(e,a,t)=>{const l=Xe.get("token");return vo.some((({path:a})=>e.path===a))?t():l||e.query.token?(e.query.token&&Xe.set("token",e.query.token,{expires:1}),Ea().userInfo.pUserId||await Ea().getUserLogged(),await Ea().getMenuAuth(),t()):t({path:"/not-login"})})),yo.afterEach(((e,a)=>{!1===e.meta.isMenu&&window.scrollTo(0,0)})),e.use(Ne).use(yo).use(_a).use(Ia).mount("#app"),e.component("v-chart",Le)})();
