import{d as e,ac as a,a2 as t,a3 as l,u as n,o,c as s,g as i,b as d,a6 as r,I as u,ah as c,ai as p,M as m,p as v,a8 as f,a as y,ad as g,F as b,a7 as k,r as h,e as _,aj as w,N as C,t as x,K as I,h as N,_ as T,ak as L,al as R,w as U,s as S,A as O,S as A,am as D,f as F,U as j}from"./@vue-b55b200f.js";import{z as q,_ as M,A as K,a as V,M as P,D as z,b as E,m as B,c as Y,L as $,d as H,e as G,f as J,g as W,T as Z,C as X,h as Q,i as ee,I as ae,j as te,k as le,S as ne,R as oe,B as se,l as ie,F as de,n as re,o as ue,p as ce,U as pe,q as me,r as ve,s as fe,t as ye,u as ge,v as be,w as ke,x as he,y as _e,E as we,G as Ce,H as xe,J as Ie,K as Ne,N as Te}from"./ant-design-vue-96fbe675.js";import{C as Le}from"./vue-echarts-17fec547.js";import"./echarts-wordcloud-9c1875a5.js";import{C as Re}from"./clipboard-e8d95c39.js";import{u as Ue,o as Se,a as Oe,b as Ae,c as De,d as Fe}from"./vue-router-1604a974.js";import{a0 as je,a1 as qe,a2 as Me,a3 as Ke,a4 as Ve,a5 as Pe,a6 as ze,a7 as Ee,a8 as Be,P as Ye,a9 as $e,f as He,aa as Ge,ab as Je,G as We,Q as Ze,M as Xe}from"./@ant-design-3a34fe17.js";import{d as Qe,c as ea}from"./pinia-a10667d2.js";import{a as aa}from"./js-cookie-1db5286e.js";import{a as ta}from"./axios-95009a82.js";import{m as la,c as na,d as oa}from"./lodash-es-5953ec5c.js";import{E as sa,a as ia,b as da}from"./element-plus-e85a148b.js";import{V as ra}from"./vue-cropper-69c8d6c6.js";import{T as ua,E as ca}from"./@wangeditor-1728e006.js";import{i as pa,u as ma,a as va,b as fa,c as ya,d as ga,e as ba,f as ka,g as ha,h as _a}from"./echarts-7075129c.js";import{d as wa}from"./dayjs-938c682c.js";import"./@babel-81c9ad16.js";import"./resize-observer-polyfill-c24c855f.js";import"./vue-types-932461d1.js";import"./@ctrl-2e17fe3b.js";import"./dom-align-896e8735.js";import"./async-validator-efc2d198.js";import"./scroll-into-view-if-needed-4c99f3d7.js";import"./compute-scroll-into-view-6152c361.js";import"./resize-detector-94afada7.js";import"./vue-demi-5b9a0fa5.js";import"./@vueuse-1afec6d3.js";import"./@element-plus-68633451.js";import"./tslib-ed971494.js";import"./zrender-9f78e07a.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&a(e)})).observe(document,{childList:!0,subtree:!0})}function a(e){if(e.ep)return;e.ep=!0;const a=function(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerpolicy&&(a.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?a.credentials="include":"anonymous"===e.crossorigin?a.credentials="omit":a.credentials="same-origin",a}(e);fetch(e.href,a)}}();const Ca=e({setup(e){const i=q;return(e,d)=>{const r=a("router-view"),u=M;return o(),t(u,{locale:n(i)},{default:l((()=>[s(r)])),_:1},8,["locale"])}}}),xa={autoSetContainer:!1,appendToBody:!0},Ia=(e,a)=>new Promise((function(t,l){const n=document.createElement("button"),o=new Re(n,{text:function(){return e},action:function(){return"copy"},container:"object"==typeof a?a:document.body});o.on("success",(function(e){o.destroy(),t(e)})),o.on("error",(function(e){o.destroy(),l(e)})),xa.appendToBody&&document.body.appendChild(n),n.click(),xa.appendToBody&&document.body.removeChild(n)})),Na={install:function(e){e.config.globalProperties.$clipboardConfig=xa,e.config.globalProperties.$copyText=Ia,e.directive("clipboard",{mounted:function(e,a){if("success"===a.arg)e._vClipboard_success=a.value;else if("error"===a.arg)e._vClipboard_error=a.value;else{const t=new Re(e,{text:function(){return a.value},action:function(){return"cut"===a.arg?"cut":"copy"},container:xa.autoSetContainer?e:void 0});t.on("success",(function(a){const t=e._vClipboard_success;t&&t(a)})),t.on("error",(function(a){const t=e._vClipboard_error;t&&t(a)})),e._vClipboard=t}},updated:function(e,a){"success"===a.arg?e._vClipboard_success=a.value:"error"===a.arg?e._vClipboard_error=a.value:(e._vClipboard.text=function(){return a.value},e._vClipboard.action=function(){return"cut"===a.arg?"cut":"copy"})},unmounted:function(e,a){"success"===a.arg?delete e._vClipboard_success:"error"===a.arg?delete e._vClipboard_error:(e._vClipboard.destroy(),delete e._vClipboard)}})},config:xa},Ta=(e,a)=>{let t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download",a),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)};const La=(e,a)=>{if(!e)return;const t=function(e,a){let t=window.atob(e),l=t.length,n=new Uint8Array(l);for(;l--;)n[l]=t.charCodeAt(l);return new Blob([n],{type:a})}(e,"application/pdf"),l=window.URL.createObjectURL(t);Ta(l,a)},Ra=(e,a)=>{if(!e)return;const t=new Blob([e],{type:"application/pdf"}),l=window.URL.createObjectURL(t);Ta(l,a)},Ua={install:function(e){e.config.globalProperties.$downloadFileByBase64=La,e.config.globalProperties.$downloadFileByFileFlow=Ra}},Sa="知识库智能管理系统",Oa={defaultAvatar:"//s.go2yd.com/a/thead_meiguoduizhang.png"};var Aa=(e,a)=>{const t=e.__vccOpts||e;for(const[l,n]of a)t[l]=n;return t};const Da={class:"user-name"},Fa=(e=>(c("data-v-026148ae"),e=e(),p(),e))((()=>d("span",null,[d("a",{class:"link",href:"/"},"返回登录")],-1)));var ja=Aa(e({props:{name:{type:String},avatar:{type:String},emailAddr:{type:String}},setup(e){var a;const c=i({DEFAULT_AVATAR:null==(a=Oa)?void 0:a.defaultAvatar});return(a,i)=>{const p=K,m=V,v=P,f=z;return o(),t(f,null,{overlay:l((()=>[s(v,null,{default:l((()=>[s(m,{key:"1"},{default:l((()=>[s(n(je)),Fa])),_:1})])),_:1})])),default:l((()=>[d("div",{class:"user-info",onClick:i[0]||(i[0]=u((()=>{}),["prevent"]))},[s(p,{src:e.avatar||n(c).DEFAULT_AVATAR,alt:`${e.name}'s avatar`},null,8,["src","alt"]),d("span",Da,r(e.name||"管理员"),1)])])),_:1})}}}),[["__scopeId","data-v-026148ae"]]);const qa=e({components:{SkinOutlined:qe,SettingOutlined:Me,BookOutlined:Ke,HomeOutlined:Ve,DashboardOutlined:Pe,BarChartOutlined:ze},props:{route:{type:Object,value:{}}},setup(e){const{route:a}=m(e),t=v((()=>{var e,t,l,n,o;return"1"===(null==(t=null==(e=a.value)?void 0:e.meta)?void 0:t.level)?null==(n=null==(l=a.value)?void 0:l.meta)?void 0:n.key:null==(o=a.value)?void 0:o.name}));return{...m(e),key:t}}}),Ma={class:"nav-text"};var Ka=Aa(qa,[["render",function(e,n,s,i,u,c){var p,m,v,h,_,w,C;const x=a("Menus",!0),I=E,N=V;return(null==(p=e.route)?void 0:p.children)&&"1"!==(null==(v=null==(m=e.route)?void 0:m.meta)?void 0:v.level)&&!1!==(null==(h=e.route.meta)?void 0:h.isMenu)?(o(),t(I,{key:e.route.name,title:(null==(_=e.route.meta)?void 0:_.title)||"未命名"},{icon:l((()=>{var a;return[(o(),t(f(null==(a=e.route.meta)?void 0:a.icon)))]})),default:l((()=>[(o(!0),y(b,null,g(e.route.children,(e=>{var a;return o(),y(b,null,[!1!==(null==(a=e.meta)?void 0:a.isMenu)?(o(),t(x,{key:0,route:e},null,8,["route"])):k("",!0)],64)})),256))])),_:1},8,["title"])):(o(),y(b,{key:1},[!1!==(null==(C=null==(w=e.route)?void 0:w.meta)?void 0:C.isMenu)?(o(),t(N,{key:e.key},{icon:l((()=>{var a,l;return[(o(),t(f(null==(l=null==(a=e.route)?void 0:a.meta)?void 0:l.icon)))]})),default:l((()=>{var a,t;return[d("span",Ma,r((null==(t=null==(a=e.route)?void 0:a.meta)?void 0:t.title)||"未命名"),1)]})),_:1})):k("",!0)],64))}]]);const Va=e=>{B.error(e)},Pa=e=>{if(!1===e.useDefaultParms)return{};const a=$a();return{userId:a.userInfo.pUserId,opUser:a.userInfo.userName}},za=ta.create({baseURL:"http://47.98.251.91:8662",timeout:1e4,showMsg:!1});za.defaults.withCredentials=!0,za.interceptors.request.use((function(e){if(void 0!==navigator.onLine&&!1===navigator.onLine)return Promise.reject({message:"网络未链接",code:-1});if("get"==e.method&&(e.params={...Pa(e),...e.params}),"post"==e.method){const a={...Pa(e),...e.data};if(!1===e.useGenParams)return la(e.data)?(e.data=e.data.map((a=>({...a,...Pa(e)}))),e):e;e.data=e.data instanceof FormData?e.data:a}return e}),(function(e){return Promise.reject(e)})),za.interceptors.response.use((function(e){var a,t;const{data:l,config:n}=e;if(-1!==(null==(a=n.url)?void 0:a.indexOf("pandora.yidian-inc.com")))return l&&"success"===l.status?l:Promise.reject();const o=null!=(t=l.code)?t:-1;if(1e3!==o){const e=l.message||"未定义错误";return Va(l.message),Promise.reject({code:o,message:e})}return n.showMsg&&l.message&&B.info(l.message),l.data}),(function(e){return e.code&&-1===e.code||(e.message="接口请求错误，请联系管理员"),Va(e.message),Promise.reject(e)}));const Ea=(e,a,t)=>za.get(e,{params:a,...t}),Ba=(e,a,t)=>za.post(e,a,t);const Ya=aa.get("userInfo")?JSON.parse(aa.get("userInfo")):{userName:"",sex:1,moblie:"",pUserId:"",photo:"",id:""},$a=Qe({id:"app-user",state:()=>({userInfo:Ya,authList:[],menuList:[],menuOperateAuthMap:{}}),getters:{},actions:{async getUserLogged(){var e;try{const a=await async function(e){return Ea("/user/parse/token",e)}({token:null!=(e=aa.get("token"))?e:""});this.userInfo=a,aa.set("userInfo",JSON.stringify(a))}catch(a){return!1}},async getMenuAuth(){try{const e=await async function(){return Ea("/menu/query/user")}(),a=[],t={},l=(e,a,n,o=!1)=>{var s,i,d;for(let r=0;r<e.length;r++){const u=e[r];for(let e=0;e<a.length;e++){const c=a[e];if(c.menuName===(null==(s=u.meta)?void 0:s.title)&&c.children&&c.children.length>0)if("1"===(null==(i=u.meta)?void 0:i.level)||o){const e=c.children.filter((e=>"仅查看"===e.menuName||"可编辑"===e.menuName)).length>0,a=c.children.filter((e=>"可编辑"===e.menuName)).length>0,l=na(u);t[u.meta.key]=a,this.menuOperateAuthMap=t,e&&n.push(l)}else n.push(na(u)),n[r].children=[],l(null!=(d=u.children)?d:[],c.children,n[r].children,!0)}}};l($o,e,a),Go.options.routes=[...a,...Ho],this.menuList=a}catch(e){return!1}},redirectToLogin(){const e=location.href;location.href=`//pandora.yidian-inc.com/tools/admin/login?callback=${e}`}}}),Ha=Qe({id:"keep-alive",state:()=>({caches:[]}),getters:{getCaches(){return this.caches}},actions:{ADD(e){this.caches.indexOf(e)<0&&this.caches.push(e)},REMOVE(e){this.caches=this.caches.filter((a=>a!=e))},CLEAN(){this.caches=[]}}});const Ga={key:0,class:"title"};var Ja=Aa(e({setup(e){!function(){const e=Ue(),a=Ha();e.meta.keepAlive&&a.ADD(e.name);const t=(e,t)=>{!1!==e.meta.isMenu&&a.REMOVE(t.name),e.meta.keepAlive&&a.ADD(e.name)};Se(((e,a,l)=>{t(e,a),l()})),Oe(((e,a,l)=>{t(e,a),l()}))}();const d=Ae(),u=Ue(),c=$a(),p=Ha(),m=h(!1),C=i({title:Sa,selectedKeys:[""],openKeys:[],name:"",avatar:""}),x=c.menuList,I=v((()=>p.getCaches.join(","))),N=({key:e,selectedKeys:a})=>{d.push({name:e}),C.selectedKeys=a};return _((async()=>{C.selectedKeys=[u.name],C.openKeys=[u.path.split("/")[1]];const{userName:e,photo:a}=c.userInfo;C.name=e,C.avatar=a})),(e,i)=>{const d=a("router-link"),c=P,p=$,v=H,h=a("router-view"),_=G,T=Y;return o(),t(T,{class:"layout-wrap"},{default:l((()=>[s(p,{class:"sider-container",collapsed:m.value,"onUpdate:collapsed":i[1]||(i[1]=e=>m.value=e),trigger:null,collapsible:""},{default:l((()=>[s(d,{class:"app-logo",to:"/"},{default:l((()=>[m.value?k("",!0):(o(),y("h1",Ga,r(n(C).title),1))])),_:1}),s(c,{selectedKeys:n(C).selectedKeys,openKeys:n(C).openKeys,"onUpdate:openKeys":i[0]||(i[0]=e=>n(C).openKeys=e),theme:"dark",mode:"inline",onSelect:N},{default:l((()=>[(o(!0),y(b,null,g(n(x),(e=>(o(),t(Ka,{route:e},null,8,["route"])))),256))])),_:1},8,["selectedKeys","openKeys"])])),_:1},8,["collapsed"]),s(T,{style:{marginLeft:"200px"}},{default:l((()=>[s(v,{class:"header-container"},{default:l((()=>[m.value?(o(),t(n(Ee),{key:0,class:"trigger",onClick:i[2]||(i[2]=()=>m.value=!m.value)})):(o(),t(n(Be),{key:1,class:"trigger",onClick:i[3]||(i[3]=()=>m.value=!m.value)})),s(ja,{name:n(C).name,avatar:n(C).avatar},null,8,["name","avatar"])])),_:1}),s(_,{id:"content-container"},{default:l((()=>[(o(),t(h,{key:n(u).fullPath},{default:l((({Component:e,route:a})=>[(o(),t(w,{include:n(I)},[(o(),t(f(e),{key:a.meta.path}))],1032,["include"]))])),_:1}))])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-2317c138"]]);const Wa={class:"app-container"};var Za=Aa({name:"FullScreenLayout"},[["render",function(e,n,i,d,r,u){const c=a("router-view");return o(),y("div",Wa,[s(c,null,{default:l((({Component:e})=>[(o(),t(f(e)))])),_:1})])}]]);var Xa=Aa({},[["render",function(e,a){const l=J;return o(),t(l,{status:"403",title:"暂无权限","sub-title":"对不起，您暂时没有此页面的访问权限，请前往父级系统登录后通过父系统内菜单再次点击进入"})}]]);const Qa=(e,a=!0)=>(Object.keys(e).forEach((t=>{void 0!==e[t]&&null!==e[t]||delete e[t],a&&""===e[t]&&delete e[t],"[]"!==JSON.stringify(e[t])&&"{}"!==JSON.stringify(e[t])||delete e[t]})),e),et=e=>{if(!e.length)return[];if("string"==typeof e){const a=e.split("/");return[{uid:"-1",status:"done",thumbUrl:e,type:"image/png",name:a[a.length-1],response:e}]}return"object"==typeof e?e.map(((e,a)=>{const t=e.split("/");return{uid:(-(a+1)).toString(),status:"done",thumbUrl:e,type:"image/png",name:t[t.length-1],response:e}})):[]},at={field:"",order:void 0,columnKey:""};function tt(e){const{fetchData:a,formatParams:t,formatResponse:l,paginationOption:o=["current","size"],pageSize:s=20,firstLoaded:d=!0}=e,r=h(),u=h(at),c=i({dataSource:[],tableLoading:!1,total:0,current:1,size:s,selectedRowKeys:[]}),p=v((()=>({total:c.total,current:c.current,pageSize:c.size,showTotal:e=>`共${e}条`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],onChange:e=>{c.current=e},onShowSizeChange:(e,a)=>{c.current=1,c.size=a}}))),f=v((()=>({selectedRowKeys:n(c.selectedRowKeys),onChange:e=>{c.selectedRowKeys=e}}))),y=async()=>{c.tableLoading=!0;try{const e=t();let[n,s]=o;const i=Qa({[n]:c.current,[s]:c.size,sort_field:u.value.field,sort_value:u.value.order,...e}),d=await a(i);if(c.tableLoading=!1,l){const{list:e,total:a}=await l(d);return c.dataSource=e,void(c.total=a)}c.dataSource=d.records,c.total=d.total}catch(e){throw e}},g=()=>new Promise(((e,a)=>{r.value.validate().then((()=>{e()})).catch((()=>{a()}))})),b=()=>{u.value=at,c.selectedRowKeys=[]};return C((()=>{d&&y()})),{...m(c),onSearch:()=>{g().then((()=>{c.current=1,b(),y()}))},onReset:()=>{r.value.resetFields(),c.current=1,b(),y()},pagination:p,getList:y,searchFormRef:r,onTableChange:(e,a,t)=>{u.value=t,y()},sortedInfo:u,rowSelection:f}}const lt=e=>Ea("/base/home",e),nt={1:"条目",2:"文档",3:"图片",4:"视频",5:"专题"},ot=[{label:"知识分类",value:"1"},{label:"知识类型",value:"2"}],st=e=>Ea("/dict/tree/query",e);const it=e({name:"TypeTree",props:{knowledgeType:null,knowledgeFlag:null},emits:["update:knowledgeType","update:knowledgeFlag","change"],setup(e,{emit:a}){const d=e,r=i({status:"1"});m(d);const u=h(""),c=h([]),p=async()=>{const e=await st({type:r.status});c.value=e,c.value.unshift({dictName:"全部",id:"",parentId:""})};p();const v=()=>{p(),a("update:knowledgeType",""),a("update:knowledgeFlag","")},f=e=>{u.value=e.id.toString(),"1"===r.status?(a("update:knowledgeType",x(e.id)),a("update:knowledgeFlag","")):(a("update:knowledgeType",""),a("update:knowledgeFlag",x(e.id))),a("change",x(e.id))};return(e,a)=>{const i=W,d=Z,u=X;return o(),y("div",null,[s(u,{class:"table-box mt20"},{default:l((()=>[s(d,{activeKey:n(r).status,"onUpdate:activeKey":a[0]||(a[0]=e=>n(r).status=e),type:"card",tabBarGutter:6,class:"search-tabs mb15",onChange:v},{default:l((()=>[(o(!0),y(b,null,g(n(ot),(e=>(o(),t(i,{key:e.value,tab:e.label},null,8,["tab"])))),128))])),_:1},8,["activeKey"]),c.value.length?(o(),t(n(ia),{key:1,data:c.value,"node-key":"id","check-on-click-node":"","default-expand-all":"","highlight-current":"","expand-on-click-node":!1,"default-checked-keys":[],props:{label:"dictName"},onNodeClick:f},null,8,["data"])):(o(),t(n(sa),{key:0,"image-size":200,description:"暂无数据"}))])),_:1})])}}}),dt=e=>Ea("/label/query",e),rt=e({props:{value:null},emits:["update:value"],setup(e,{emit:a}){const l=e,{value:s}=m(l),i=h([]),d=h(na(s.value)),r=async e=>{const a={};e&&(a.labelName=e);const{records:t}=await dt(a);i.value=t.map((e=>({value:e.id,label:e.labelName})))},u=oa((e=>{r(e)}),300);_((()=>{r()}));const c=e=>{d.value=e,a("update:value",d)};return(e,a)=>{const l=Q;return o(),t(l,{value:d.value,"onUpdate:value":a[0]||(a[0]=e=>d.value=e),options:i.value,placeholder:"请选择标签",style:{width:"200px"},"show-search":"","allow-clear":"","filter-option":!1,onSearch:n(u),onChange:c},null,8,["value","options","onSearch"])}}}),ut=e({props:{value:null},emits:["update:value"],setup(e,{emit:a}){const l=e,{value:s}=m(l),i=h([]),d=h(na(s.value)),r=async e=>{const a={};e&&(a.itemName=e);const{records:t}=await(l=a,Ea("/item/query",l));var l;i.value=t.map((e=>({value:e.id,label:e.itemName})))},u=oa((e=>{r(e)}),300);_((()=>{r()}));const c=e=>{d.value=e,a("update:value",d)};return(e,a)=>{const l=Q;return o(),t(l,{value:d.value,"onUpdate:value":a[0]||(a[0]=e=>d.value=e),options:i.value,placeholder:"请选择项目",style:{width:"200px"},"show-search":"","allow-clear":"","filter-option":!1,onSearch:n(u),onChange:c},null,8,["value","options","onSearch"])}}});const ct=I("创建时间"),pt=I("浏览量"),mt=I("查询"),vt=I("重置");var ft=Aa(e({name:"Home",setup(e){const d=v((()=>[{title:"知识条目",dataIndex:"knowledgeName",key:"knowledgeName",align:"center",width:200,ellipsis:!0},{title:"类型",dataIndex:"knowledgeFlag",key:"knowledgeFlag",align:"center",width:80,customRender:({text:e})=>nt[e]},{title:"分类",dataIndex:"knowledgeTypeName",key:"knowledgeTypeName",align:"center",width:80,customRender:({text:e})=>e?e.split(", ").join("-"):""},{title:"安全级别",dataIndex:"securityLevelName",key:"securityLevelName",align:"center"},{title:"有效期",dataIndex:"deadline",key:"deadline",align:"center"},{title:"创建人",dataIndex:"creator",key:"creator",align:"center"},{title:"创建时间",dataIndex:"createTime",key:"createTime",align:"center"}])),u="YYYY-MM-DD",c=i({knowledgeFlag:"",knowledgeType:"",knowledgeName:"",author:"",labelId:"",itemId:"",dateRange:[],sortType:"createTime"}),{onSearch:p,onReset:m,pagination:f,dataSource:g,getList:h,searchFormRef:_,onTableChange:w,sortedInfo:C}=tt({fetchData:lt,formatParams(){const e=c.dateRange,a={...c};return delete a.dateRange,e.length&&(a.startTime=e[0],a.endTime=e[1]),a}}),x=()=>{p()};return(e,i)=>{const v=ae,h=te,C=le,N=ne,T=Q,L=oe,R=se,U=ie,S=ee,O=de,A=X,D=a("router-link"),F=re;return o(),y("div",null,[s(A,{class:"search-box mt15"},{default:l((()=>[s(O,{ref_key:"searchFormRef",ref:_,layout:"inline",model:n(c)},{default:l((()=>[s(S,{gutter:[24,16]},{default:l((()=>[s(C,null,{default:l((()=>[s(h,{label:"标题",name:"knowledgeName"},{default:l((()=>[s(v,{value:n(c).knowledgeName,"onUpdate:value":i[0]||(i[0]=e=>n(c).knowledgeName=e),valueModifiers:{trim:!0},placeholder:"请输入标题",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(C,null,{default:l((()=>[s(h,{label:"作者",name:"author"},{default:l((()=>[s(v,{value:n(c).author,"onUpdate:value":i[1]||(i[1]=e=>n(c).author=e),valueModifiers:{trim:!0},placeholder:"请输入作者",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(C,null,{default:l((()=>[s(h,{label:"标签",name:"labelId"},{default:l((()=>[s(rt,{value:n(c).labelId,"onUpdate:value":i[2]||(i[2]=e=>n(c).labelId=e)},null,8,["value"])])),_:1})])),_:1}),s(C,null,{default:l((()=>[s(h,{label:"项目",name:"itemId"},{default:l((()=>[s(ut,{value:n(c).itemId,"onUpdate:value":i[3]||(i[3]=e=>n(c).itemId=e)},null,8,["value"])])),_:1})])),_:1}),s(C,null,{default:l((()=>[s(h,{label:"排序方式",name:"sortType"},{default:l((()=>[s(T,{value:n(c).sortType,"onUpdate:value":i[4]||(i[4]=e=>n(c).sortType=e),style:{width:"120px"},"allow-clear":""},{default:l((()=>[s(N,{value:"createTime"},{default:l((()=>[ct])),_:1}),s(N,{value:"browseNum"},{default:l((()=>[pt])),_:1})])),_:1},8,["value"])])),_:1})])),_:1}),s(C,null,{default:l((()=>[s(h,{label:"创建时间",name:"dateRange"},{default:l((()=>[s(L,{value:n(c).dateRange,"onUpdate:value":i[5]||(i[5]=e=>n(c).dateRange=e),format:u,"value-format":u,"allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(C,null,{default:l((()=>[s(h,null,{default:l((()=>[s(U,{size:20},{default:l((()=>[s(R,{type:"primary",onClick:n(p)},{default:l((()=>[mt])),_:1},8,["onClick"]),s(R,{onClick:n(m)},{default:l((()=>[vt])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(S,null,{default:l((()=>[s(C,{span:4},{default:l((()=>[s(it,{knowledgeType:n(c).knowledgeType,"onUpdate:knowledgeType":i[6]||(i[6]=e=>n(c).knowledgeType=e),knowledgeFlag:n(c).knowledgeFlag,"onUpdate:knowledgeFlag":i[7]||(i[7]=e=>n(c).knowledgeFlag=e),onChange:x},null,8,["knowledgeType","knowledgeFlag"])])),_:1}),s(C,{span:20},{default:l((()=>[s(A,{class:"table-box mt20"},{default:l((()=>[s(F,{rowKey:"id",columns:n(d),"data-source":n(g),pagination:n(f),bordered:"",onChange:n(w)},{bodyCell:l((({column:e,text:a,record:n})=>["knowledgeName"===e.dataIndex?(o(),t(D,{key:0,to:{name:"ArticleDetail",query:{id:n.id}}},{default:l((()=>[I(r(a),1)])),_:2},1032,["to"])):k("",!0),"deadline"===e.dataIndex?(o(),y(b,{key:1},[I(r("0"===n.expirationType?"永久有效":n.endTime),1)],64)):k("",!0)])),_:1},8,["columns","data-source","pagination","onChange"])])),_:1})])),_:1})])),_:1})])}}}),[["__scopeId","data-v-9da1c354"]]);function yt(){return{share:e=>{const{id:a,title:t,type:l,endTime:n}=e;ue.info({title:"分享",okText:"确认",maskClosable:!0,content:N("div",{},[N("p",{class:"mt15"},[N("span","标题："),N("span",{class:"link"},t)]),N("p",{class:"mt15"},`类型：${nt[l]}     有效期：${n}`)]),onOk(){Ia(`${window.location.protocol}//${window.location.host}${window.location.pathname}#/myKnowledge/article-detail?id=${a}`).then((()=>{B.success("文章链接也复制到您的剪切板!")})).catch((()=>{B.error("复制失败")}))}})}}}const gt=e=>Ea("/base/query",e),bt=e=>Ba("/base/save",e),kt=e=>Ba("/base/update",e),ht=e=>Ea("/base/detail",e),_t=()=>Ea("base/query/ranking"),wt=e=>{const a=new FormData;return a.append("file",e),Ba("/file/upload",a,{headers:{"Content-type":"multipart/form-data"}})};const Ct=e({props:{type:null,info:null},emits:["success","cancel"],setup(e,{emit:a}){const d=e,{type:r,info:u}=m(d),c=de.useForm,p=i({labelCol:{span:4},wrapperCol:{span:20}}),v=i({labelName:"update"===r.value?u.value.labelName:""}),f=i({labelName:[{required:!0,message:"请填写标签名称！"}]}),{resetFields:y,validate:g,validateInfos:b}=c(v,f),k=async e=>{return"create"===r.value?await(a=e,Ba("/label/save",a)):await(e=>Ba("/label/update",e))({...e,id:u.value.id});var a},h=async()=>{try{const e=await g();await k(e),B.success("成功!"),a("success"),_()}catch(e){}},_=()=>{y(),a("cancel",!1)};return(e,a)=>{const i=ae,d=te,u=de,c=ue;return o(),t(c,{visible:!0,title:"create"===n(r)?"新建":"编辑",closable:!1,width:"400px",destroyOnClose:!0,onOk:h,onCancel:_},{default:l((()=>[s(u,L(R(n(p))),{default:l((()=>[s(d,T({label:"名称"},n(b).labelName),{default:l((()=>[s(i,{value:n(v).labelName,"onUpdate:value":a[0]||(a[0]=e=>n(v).labelName=e),placeholder:"请输入标签名称"},null,8,["value"])])),_:1},16)])),_:1},16)])),_:1},8,["title"])}}}),xt=I(" 新增 "),It=e({props:{modelValue:null,type:null},emits:["update:modelValue"],setup(e,{emit:a}){const r=e,u=(e,{attrs:a})=>a.vnodes,{modelValue:c,type:p="create"}=m(r),v=h([]);setTimeout((()=>{v.value=na(c.value)}),1e3);const f=e=>{a("update:modelValue",e)},g=oa((e=>{N(e)}),300),{labelOptions:w,CreateLabelDialogState:C,handleCreateLabel:x,handleCancelLabelCreateDialog:I,fetchLabelList:N}=function(){const e=h([]),a=async a=>{const t={};a&&(t.labelName=a);const{records:l}=await dt(t),n=l.map((e=>({label:e.labelName,value:e.id})));e.value=n},t=i({visible:!1});return _((()=>{a()})),{fetchLabelList:a,labelOptions:e,CreateLabelDialogState:t,handleCreateLabel:()=>{t.visible=!0},handleCancelLabelCreateDialog:()=>{t.visible=!1}}}();return(e,a)=>{const i=ce,r=Q;return o(),y(b,null,[s(r,{value:v.value,"onUpdate:value":a[2]||(a[2]=e=>v.value=e),mode:"multiple",options:n(w),"filter-option":!1,placeholder:"请选择标签",onChange:f,onCancel:n(I),onSearch:n(g)},{dropdownRender:l((({menuNode:e})=>[s(u,{vnodes:e},null,8,["vnodes"]),s(i,{style:{margin:"4px 0"}}),d("div",{style:{padding:"4px 8px",cursor:"pointer"},onMousedown:a[0]||(a[0]=e=>e.preventDefault()),onClick:a[1]||(a[1]=(...e)=>n(x)&&n(x)(...e))},[s(n(Ye)),xt],32)])),_:1},8,["value","options","onCancel","onSearch"]),n(C).visible?(o(),t(Ct,{key:0,type:n(p),info:{},onSuccess:n(N),onCancel:n(I)},null,8,["type","info","onSuccess","onCancel"])):k("",!0)],64)}}}),Nt={class:"ant-upload-drag-icon"},Tt=d("p",{class:"ant-upload-text"},"单击或拖动文件到该区域进行上传",-1),Lt=d("p",{class:"ant-upload-hint"},"支持单次或批量上传",-1),Rt=e({emits:["success","cancel"],setup(e,{emit:a}){const r=de.useForm,u=i({labelCol:{span:4},wrapperCol:{span:20}}),c=i({fileList:[],category:"",label:[]}),p=i({fileList:[{required:!0,message:"请选择文件！"}],category:[{required:!0,message:"请选择知识分类！"}],label:[{required:!1}]}),m=h([]);(async()=>{const e=await st({type:"1"});m.value=e})();const v=({file:e})=>{if(!e.status){const a=c.fileList.indexOf(e),t=c.fileList.slice();t.splice(a,1),c.fileList=t}},f=e=>!0,y=async({onSuccess:e,onError:a,file:t},l)=>{(async t=>{const l=await wt(t);if(l)e&&e(l),c.fileList[c.fileList.length-1].thumbUrl=l;else{const e="上传失败";a&&a(e)}})(t)},g=e=>"error"===e.status||(ue.confirm({title:"确定删除吗?",icon:s(He),content:"",okText:"确定",okType:"danger",cancelText:"取消",onOk:()=>{const a=c.fileList.indexOf(e);c.fileList.splice(a,1)},onCancel(){}}),!1),{resetFields:b,validate:k,validateInfos:_}=r(c,p),w=async()=>{try{const t=(({fileList:e,category:a,label:t})=>e.map((e=>({accessory:e.response||"",knowledgeName:e.name,knowledgeType:a,knowledgeFlag:"1",labels:t.join(",")}))))(await k());await(e=t,Ba("base/batch/save",e,{useGenParams:!1})),B.success("成功!"),a("success"),C()}catch(t){}var e},C=()=>{b(),a("cancel",!1)};return(e,a)=>{const i=pe,r=te,p=me,b=de,k=ue;return o(),t(k,{width:"600px",title:"批量上传文档",visible:!0,destroyOnClose:"",onOk:w,onCancel:C},{default:l((()=>[s(b,L(R(n(u))),{default:l((()=>[s(r,T({label:"文档"},n(_).fileList),{default:l((()=>[s(i,{fileList:n(c).fileList,"onUpdate:fileList":a[0]||(a[0]=e=>n(c).fileList=e),name:"file",multiple:!0,"custom-request":y,"before-upload":f,onRemove:g,onChange:v},{default:l((()=>[d("p",Nt,[s(n($e))]),Tt,Lt])),_:1},8,["fileList"])])),_:1},16),s(r,T({label:"知识分类"},n(_).category),{default:l((()=>[s(p,{value:n(c).category,"onUpdate:value":a[1]||(a[1]=e=>n(c).category=e),style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},fieldNames:{children:"children",label:"dictName",value:"id"},placeholder:"请选择知识分类","allow-clear":"","tree-default-expand-all":"","tree-data":m.value},null,8,["value","tree-data"])])),_:1},16),s(r,T({label:"设置标签"},n(_).label),{default:l((()=>[s(It,{modelValue:n(c).label,"onUpdate:modelValue":a[2]||(a[2]=e=>n(c).label=e)},null,8,["modelValue"])])),_:1},16)])),_:1},16)])),_:1})}}});const Ut=I("查询"),St=I("重置"),Ot=I("新建知识"),At=I("批量上传文档"),Dt=I("新建专题"),Ft=I("分享"),jt=I("编辑 "),qt=I("删除");var Mt=Aa(e({name:"KnowledgeList",setup(e){const u=Ae(),c=Ue(),p=$a(),m=c.meta.key,f=v((()=>p.menuOperateAuthMap[m])),g=v((()=>{R.value;const e=[{title:"类型",dataIndex:"knowledgeFlag",key:"knowledgeFlag",align:"center",width:80,customRender:({text:e})=>nt[e]},{title:"知识条目",dataIndex:"knowledgeName",key:"knowledgeName",align:"center",width:300,ellipsis:!0},{title:"分类",dataIndex:"knowledgeTypeName",key:"knowledgeTypeName",align:"center",customRender:({text:e})=>e?e.split(", ").join("-"):""},{title:"创建时间",dataIndex:"createTime",key:"createTime",align:"center"},{title:"最后编辑时间",dataIndex:"updateTime",key:"updateTime",align:"center"},{title:"操作",dataIndex:"operation",align:"center"}];return f.value||e.pop(),e})),h=i({knowledgeName:"",labelId:"",sortType:"createTime"}),{onSearch:_,onReset:w,pagination:C,dataSource:x,getList:N,searchFormRef:T,onTableChange:L,sortedInfo:R}=tt({fetchData:gt,formatParams:()=>({...h})}),U=(e,a)=>{if(3===e.knowledgeFlag)return u.push({name:"KnowledgeCreateTopic",query:e.id?{id:e.id,type:a}:{type:a}});u.push({name:"KnowledgeCreate",query:e.id?{id:e.id,type:a}:{type:a}})},S=async e=>{var a;await(a={id:e},Ea("/base/del",a)),B.success("删除成功！"),N()},O=i({visible:!1}),A=()=>{O.visible=!0},D=()=>{O.visible=!1},{share:F}=yt();return(e,i)=>{const c=ae,p=te,m=le,v=se,R=ie,j=ee,q=de,M=X,K=a("router-link"),V=ve,P=re;return o(),y(b,null,[d("div",null,[s(M,{class:"search-box"},{default:l((()=>[s(q,{ref_key:"searchFormRef",ref:T,layout:"inline",model:n(h)},{default:l((()=>[s(j,{gutter:[24,16]},{default:l((()=>[s(m,null,{default:l((()=>[s(p,{label:"条目标题",name:"knowledgeName"},{default:l((()=>[s(c,{value:n(h).knowledgeName,"onUpdate:value":i[0]||(i[0]=e=>n(h).knowledgeName=e),valueModifiers:{trim:!0},placeholder:"请输入条目标题",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(m,null,{default:l((()=>[s(p,{label:"标签",name:"labelId"},{default:l((()=>[s(rt,{value:n(h).labelId,"onUpdate:value":i[1]||(i[1]=e=>n(h).labelId=e)},null,8,["value"])])),_:1})])),_:1}),s(m,null,{default:l((()=>[s(p,null,{default:l((()=>[s(R,{size:20},{default:l((()=>[s(v,{type:"primary",onClick:n(_)},{default:l((()=>[Ut])),_:1},8,["onClick"]),s(v,{onClick:n(w)},{default:l((()=>[St])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(M,{class:"table-box mt20"},{default:l((()=>[n(f)?(o(),t(j,{key:0,class:"action-btn-box"},{default:l((()=>[s(v,{class:"mr15",type:"primary",onClick:i[2]||(i[2]=e=>U({id:""},"create"))},{default:l((()=>[Ot])),_:1}),s(v,{class:"mr15",onClick:A},{default:l((()=>[At])),_:1}),s(v,{onClick:i[3]||(i[3]=e=>{return a={id:""},t="create",void u.push({name:"KnowledgeCreateTopic",query:a.id?{id:a.id,type:t}:{type:t}});var a,t})},{default:l((()=>[Dt])),_:1})])),_:1})):k("",!0),s(P,{rowKey:"id",columns:n(g),"data-source":n(x),pagination:n(C),bordered:"",onChange:n(L)},{bodyCell:l((({column:e,text:a,record:d})=>["knowledgeName"===e.dataIndex?(o(),t(K,{key:0,to:{name:"ArticleDetail",query:{id:d.id}}},{default:l((()=>[I(r(a),1)])),_:2},1032,["to"])):k("",!0),"operation"===e.dataIndex?(o(),y(b,{key:1},[s(v,{type:"link",class:"action-btn",onClick:e=>n(F)({id:d.id,title:d.knowledgeName,type:d.knowledgeFlag,endTime:"0"===d.expirationType?"永久有效":d.endTime})},{default:l((()=>[Ft])),_:2},1032,["onClick"]),s(v,{type:"link",class:"action-btn",onClick:e=>U({id:d.id,knowledgeFlag:d.knowledgeFlag},"update")},{default:l((()=>[jt])),_:2},1032,["onClick"]),s(V,{title:"确定要删除此项目吗？","ok-text":"确定","cancel-text":"取消",onConfirm:e=>S(d.id),onCancel:i[4]||(i[4]=()=>{})},{default:l((()=>[s(v,{type:"link",class:"action-btn"},{default:l((()=>[qt])),_:1})])),_:2},1032,["onConfirm"])],64)):k("",!0)])),_:1},8,["columns","data-source","pagination","onChange"])])),_:1})]),n(O).visible?(o(),t(Rt,{key:0,onSuccess:n(N),onCancel:D},null,8,["onSuccess"])):k("",!0)],64)}}}),[["__scopeId","data-v-b09ce2c2"]]);const Kt={class:"upload-wrapper clearfix"},Vt=I(" 点击上传 "),Pt={key:0},zt=d("div",{class:"ant-upload-text"},"上传",-1),Et=["src"],Bt={style:{width:"100%",height:"450px"}},Yt=e({props:{modelValue:{type:Array,default:()=>[]},isAllowUpload:{type:Boolean,default:!0},maxLength:{type:Number,default:100},crop:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},type:{type:String,default:"0"}},emits:["update:modelValue","onBeforeUpload"],setup(e,{expose:a,emit:i}){const r=e,{modelValue:u,crop:c}=m(r),p=h(!1),v=h(""),f=h([]),g=h({});f.value=na(u.value);const _=h(!1),w=h(null),C=h(""),I=h(""),N=()=>{p.value=!1,v.value=""},T=e=>{v.value=e.thumbUrl,p.value=!0},L=({file:e})=>{if(!e.status||c.value){c.value&&(g.value=e);const a=f.value.indexOf(e),t=f.value.slice();t.splice(a,1),f.value=t}"removed"===e.status&&i("update:modelValue",x(f.value))},R=e=>{if(i("onBeforeUpload"),!r.isAllowUpload)return!1;const a=e.type.split("/")[0],t=e.type.split("/")[1],l="image"===a,n=e.size/1024/1024<8;return l&&!n?(B.error("图片必须小于8MB！"),!1):!l||-1!==["jpg","jpeg","png","gif","bmp"].indexOf(t)||(B.error("文件格式错误，支持文件格式为：jpg、jpeg、png、gif、bmp"),!1)},S=async({onSuccess:e,onError:a,file:t},l)=>{if(c.value&&!l){I.value=t.name,_.value=!0;const e=await(e=>new Promise(((a,t)=>{const l=new FileReader;l.readAsDataURL(e),l.onload=()=>a(l.result),l.onerror=e=>t(e)})))(t);return void(C.value=e)}(async t=>{const n=await wt(t);if(n)e&&e(n),c.value&&f.value.push(g.value),f.value[f.value.length-1].thumbUrl=n,l&&(f.value[f.value.length-1].status="success",f.value[f.value.length-1].response=n),i("update:modelValue",x(f.value));else{const e="上传失败";a&&a(e),l&&(f.value[f.value.length-1].status="error")}})(t)},O=e=>"error"===e.status||(ue.confirm({title:"确定删除吗?",icon:s(He),content:"",okText:"确定",okType:"danger",cancelText:"取消",onOk:()=>{const a=f.value.indexOf(e);f.value.splice(a,1),i("update:modelValue",x(f.value))},onCancel(){}}),!1),A=()=>{w.value.getCropData((e=>{const a=((e,a)=>{const t=e.split(","),l=t[0].match(/:(.*?);/)[1],n=atob(t[1]);let o=n.length;const s=new Uint8Array(o);for(;o--;)s[o]=n.charCodeAt(o);return new File([s],a,{type:l})})(e,I.value);i("update:modelValue",x(f.value)),S({file:a,action:"",method:"POST"},!0)})),_.value=!1},D=()=>{_.value=!1;const e=f.value.length-1,a=f.value.slice();a.splice(e,1),f.value=a,i("update:modelValue",a)};U(u,(e=>{x(e).length?f.value=na(e):f.value=[]}));return a({hasPendingTask:()=>f.value.some((e=>"uploading"===e.status))}),(a,i)=>{const r=se,u=fe,c=ue;return o(),y(b,null,[d("div",Kt,["2"===e.type?(o(),t(u,{key:0,"file-list":f.value,"onUpdate:file-list":i[0]||(i[0]=e=>f.value=e),"custom-request":S,"before-upload":R,onRemove:O,onChange:L,disabled:e.disabled},{default:l((()=>[s(r,null,{default:l((()=>[s(n(Ge)),Vt])),_:1})])),_:1},8,["file-list","disabled"])):(o(),t(u,{key:1,"file-list":f.value,"onUpdate:file-list":i[1]||(i[1]=e=>f.value=e),"list-type":"picture-card","custom-request":S,"before-upload":R,onRemove:O,onPreview:T,onChange:L,isImageUrl:()=>!0,disabled:e.disabled},{default:l((()=>[f.value.length<e.maxLength?(o(),y("div",Pt,[s(n(Ye),{class:"upload-icon"}),zt])):k("",!0)])),_:1},8,["file-list","isImageUrl","disabled"])),s(c,{visible:p.value,footer:null,onCancel:N},{default:l((()=>[v.value?(o(),y("img",{key:0,alt:"example",style:{width:"100%"},src:v.value},null,8,Et)):k("",!0)])),_:1},8,["visible"])]),s(c,{title:"裁剪图片",visible:_.value,width:800,onOk:A,onCancel:D},{default:l((()=>[d("div",Bt,[s(n(ra),{autoCrop:"",img:C.value,ref_key:"cropper",ref:w,centerBox:"",fixed:"",canMove:!1,fixedNumber:[20,13]},null,8,["img"])])])),_:1},8,["visible"])],64)}}});const $t={class:"base-editor border"};var Ht=Aa(e({props:{modelValue:{type:String,default:()=>[]}},emits:["update:modelValue"],setup(e,{emit:a}){const t=e,{modelValue:l}=m(t),i=S(),d=h("default"),r=h("");setTimeout((()=>{r.value=na(l.value)}),1e3);const u={},c={placeholder:"请输入内容..."};O((()=>{const e=i.value;null!=e&&e.destroy()}));const p=e=>{i.value=e},v=e=>{a("update:modelValue",e.getHtml())};return(e,a)=>(o(),y("div",$t,[s(n(ua),{class:"border-bt",editor:n(i),defaultConfig:u,mode:d.value},null,8,["editor","mode"]),s(n(ca),{class:"editor",defaultConfig:c,mode:d.value,modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value=e),onOnCreated:p,onOnChange:v},null,8,["mode","modelValue"])]))}}),[["__scopeId","data-v-be0a4460"]]);const Gt=(e=>(c("data-v-0ab89469"),e=e(),p(),e))((()=>d("div",{id:"map",style:{width:"100%",height:"400px"}},null,-1)));var Jt=Aa(e({props:{modelValue:null},emits:["success","cancel","update:modelValue"],setup(e,{emit:a}){const n=e,{modelValue:s}=m(n);h("").value=na(s.value);const i=window.BMapGL;_((()=>{const e=new i.Map("map");e.centerAndZoom(new i.Point(116.23376,40.01477),12);const t=new i.Geocoder;e.addEventListener("click",(function(l){e.clearOverlays();const n=l.latlng,o=new i.Marker(new i.Point(n.lng,n.lat));e.addOverlay(o),t.getLocation(n,(function(e){const{lng:t,lat:l}=e.point;a("update:modelValue",`${t}, ${l}`)}))}))}));const d=async()=>{a("success"),r()},r=()=>{a("cancel",!1)};return(e,a)=>{const n=ue;return o(),t(n,{visible:!0,title:"获取位置",closable:!1,width:"600px",destroyOnClose:!0,onOk:d,onCancel:r},{default:l((()=>[Gt])),_:1})}}}),[["__scopeId","data-v-0ab89469"]]);const Wt=e({setup(e){const a=[{title:"条目标题",dataIndex:"knowledgeName",key:"knowledgeName",align:"center"},{title:"操作",dataIndex:"operation",align:"center",width:110}];return(e,n)=>{const s=re;return o(),t(s,T({columns:a},e.$attrs),{bodyCell:l((({column:a,record:t})=>["operation"===a.dataIndex?A(e.$slots,"operation",{key:0,record:t}):k("",!0)])),_:3},16)}}}),Zt=I("查询"),Xt=e({props:{selectedRows:null},emits:["success","cancel"],setup(e,{emit:a}){const d=e,{selectedRows:u}=m(d),c=i({selectedRow:[]}),p=i({knowledgeName:""}),{onSearch:v,onReset:f,pagination:y,dataSource:g,getList:b,searchFormRef:k,onTableChange:h}=tt({fetchData:gt,formatParams:()=>p,pageSize:10,formatResponse(e){const{records:a,total:t}=e;return u.value.forEach((e=>{a.forEach((a=>{e.id===a.id&&(a.checked=!0)}))})),{list:a,total:t}}}),w=()=>{const e={selectedRows:c.selectedRow};a("success",e),C()},C=()=>{a("cancel")};return _((async()=>{await b()})),(e,a)=>{const i=ae,d=te,u=le,m=se,f=ie,b=ee,_=de,x=X,N=ue;return o(),t(N,{title:"选择知识条目",visible:!0,maskClosable:!1,closable:!1,centered:"",width:"80%",destroyOnClose:"","body-style":{height:"80vh","overflow-y":"auto"},onOk:w,onCancel:C},{default:l((()=>[s(x,{class:"search-box"},{default:l((()=>[s(_,{ref_key:"searchFormRef",ref:k,layout:"inline",model:n(p)},{default:l((()=>[s(b,{gutter:[24,16]},{default:l((()=>[s(u,null,{default:l((()=>[s(d,{label:"标题",name:"knowledgeName"},{default:l((()=>[s(i,{value:n(p).knowledgeName,"onUpdate:value":a[0]||(a[0]=e=>n(p).knowledgeName=e),valueModifiers:{trim:!0},placeholder:"请输入知识条目标题",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(u,null,{default:l((()=>[s(d,null,{default:l((()=>[s(f,{size:20},{default:l((()=>[s(m,{type:"primary",onClick:n(v)},{default:l((()=>[Zt])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(Wt,{rowKey:"id","data-source":n(g),pagination:n(y),bordered:"",onChange:n(h)},{operation:l((({record:e})=>[s(m,{type:e.checked?"primary":"",disabled:e.disabled,onClick:a=>{return(t=e).checked=!t.checked,void(t.checked?c.selectedRow.push(t):c.selectedRow.splice(c.selectedRow.findIndex((e=>e.id==t.id)),1));var t}},{default:l((()=>[I(r(e.checked?"已添加":"添加"),1)])),_:2},1032,["type","disabled","onClick"])])),_:1},8,["data-source","pagination","onChange"])])),_:1})}}});const Qt={class:"page-title"},el=I("文档"),al=I("图片"),tl=I("视频"),ll=I("永久有效"),nl=I("自定义有效期"),ol=I(" 选择定位 "),sl=I("关联知识"),il=I("移除"),dl=I("保存"),rl=I("取消");var ul=(e=>(e.update="编辑",e.create="新增",e))(ul||{});var cl=Aa(e({setup(e){const a=Ue(),c=Ae(),{type:p="create",id:m=""}=a.query,f=$a(),g={2:"文档",3:"图片",4:"视频"},w=[{label:"水务局内部公开",value:"0"},{label:"同科室公开",value:"1"},{label:"私有",value:"3"}],C=h("");_((async()=>{"update"===p&&await(async()=>{const e=await ht({id:m}),{knowledgeFlag:a,knowledgeName:t,knowledgeType:l,accessory:n,documentNum:o,archiveTime:s,pagination:i,location:d,content:r,labels:u,securityLevel:c,expirationType:p,endTime:v,longitude:f,latitude:y,relateds:g,version:b}=e;N.entry=t,N.type=a+"",N.category=l,N.doc_number=o,N.file_date=s,N.pages_num=i,N.storage_location=d,N.content=r,N.label=u.map((e=>e.id)),N.safe_level=null!=c?c:"0",N.expiration_type=null!=p?p:"0",N.expiration_date=v,N.location=f||y?f+", "+y:"",N.file=et(n.split(",")),D.knowledgeList=g,C.value=b})()}));const I=de.useForm;let{modelRef:N,rulesRef:L}=function(){const e=i({type:"2",file:[],entry:"",category:"",doc_number:"",file_date:"",pages_num:"",storage_location:"",content:"",label:[],safe_level:"0",expiration_type:"0",expiration_date:"",project:"",location:""}),a=v((()=>({type:[{required:!0,message:"请选择知识类型"}],file:[{required:"0"!==e.type,message:"请上传文件"}],entry:[{required:!0,message:"请填写知识条目"}],category:[{required:!0,message:"请选择知识分类"}],doc_number:[{required:!1}],file_date:[{required:!1}],pages_num:[{required:!1}],storage_location:[{required:!1}],content:[{required:!1}],label:[{required:!1}],safe_level:[{required:!1}],expiration_type:[{required:!1}],expiration_date:[{required:!1}],project:[{required:!1}],location:[{required:!1}],knowledge:[{required:!1}]})));return{modelRef:e,rulesRef:a}}();const R=()=>{N.file=[]},U=h([]);(async()=>{const e=await st({type:"1"});U.value=e})();const S=i({visible:!1}),O=()=>{S.visible=!0},A=()=>{S.visible=!1},D=i({visible:!1,knowledgeList:[]}),F=e=>{const{selectedRows:a}=e;D.knowledgeList.push(...a)},{resetFields:j,validate:q,validateInfos:M}=I(N,L),K=async()=>{try{const e=(e=>{const{category:a,content:t,doc_number:l,entry:n,expiration_date:o,expiration_type:s,file:i,file_date:d,label:r,location:u,pages_num:c,safe_level:p,storage_location:m,type:v}=e,y=u?u.split(", "):[],g=x(r).join(","),b=x(i).map((e=>e.response)).join(","),k=D.knowledgeList.map((e=>e.id)).join(","),h={knowledgeFlag:v,knowledgeName:n,knowledgeType:a,accessory:b,documentNum:l,archiveTime:d,pagination:c,location:m,content:t,labels:g,securityLevel:p,endTime:o,itemId:"",longitude:y.length&&y[0],latitude:y.length&&y[1],expirationType:s,relateds:k,userId:f.userInfo.id,parentUserId:f.userInfo.pUserId};return Qa(h)})(await q());await(async e=>"create"===p?await bt(e):await kt({...e,id:m,version:C.value}))(e),B.success("操作成功！"),V()}catch(e){}},V=()=>{j(),c.back()};return(e,a)=>{const i=ye,c=ge,m=te,v=ae,f=me,h=be,_=ke,C=le,x=se,I=ee,L=ce,j=de,q=X;return o(),y(b,null,[s(q,null,{default:l((()=>[d("div",Qt,r(ul[n(p)])+"知识",1),s(j,{class:"mt24","label-col":{span:2},"wrapper-col":{span:14}},{default:l((()=>[s(m,T({label:"知识类型"},n(M).type),{default:l((()=>[s(c,{value:n(N).type,"onUpdate:value":a[0]||(a[0]=e=>n(N).type=e),onChange:R},{default:l((()=>[s(i,{value:"2"},{default:l((()=>[el])),_:1}),s(i,{value:"3"},{default:l((()=>[al])),_:1}),s(i,{value:"4"},{default:l((()=>[tl])),_:1})])),_:1},8,["value"])])),_:1},16),s(m,T({label:g[n(N).type]},n(M).file),{default:l((()=>[s(Yt,{modelValue:n(N).file,"onUpdate:modelValue":a[1]||(a[1]=e=>n(N).file=e),"max-length":8,type:n(N).type},null,8,["modelValue","type"])])),_:1},16,["label"]),s(m,T({label:"知识条目"},n(M).entry),{default:l((()=>[s(v,{value:n(N).entry,"onUpdate:value":a[2]||(a[2]=e=>n(N).entry=e),placeholder:"请填写知识条目"},null,8,["value"])])),_:1},16),s(m,T({label:"知识分类"},n(M).category),{default:l((()=>[s(f,{value:n(N).category,"onUpdate:value":a[3]||(a[3]=e=>n(N).category=e),style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},fieldNames:{children:"children",label:"dictName",value:"id"},placeholder:"请选择知识分类","allow-clear":"","tree-default-expand-all":"","tree-data":U.value},null,8,["value","tree-data"])])),_:1},16),"0"===n(N).type?(o(),y(b,{key:0},[s(m,T({label:"文号"},n(M).doc_number),{default:l((()=>[s(v,{value:n(N).doc_number,"onUpdate:value":a[4]||(a[4]=e=>n(N).doc_number=e),placeholder:"请填写文号"},null,8,["value"])])),_:1},16),s(m,T({label:"档案日期"},n(M).file_date),{default:l((()=>[s(h,{value:n(N).file_date,"onUpdate:value":a[5]||(a[5]=e=>n(N).file_date=e),valueFormat:"YYYY-MM-DD"},null,8,["value"])])),_:1},16),s(m,T({label:"页数"},n(M).pages_num),{default:l((()=>[s(v,{value:n(N).pages_num,"onUpdate:value":a[6]||(a[6]=e=>n(N).pages_num=e),placeholder:"请填写页数"},null,8,["value"])])),_:1},16),s(m,T({label:"存放地点"},n(M).storage_location),{default:l((()=>[s(v,{value:n(N).storage_location,"onUpdate:value":a[7]||(a[7]=e=>n(N).storage_location=e),placeholder:"请填写存放地点"},null,8,["value"])])),_:1},16)],64)):k("",!0),s(m,T({label:"知识内容"},n(M).content),{default:l((()=>[s(Ht,{modelValue:n(N).content,"onUpdate:modelValue":a[8]||(a[8]=e=>n(N).content=e)},null,8,["modelValue"])])),_:1},16),s(m,T({label:"设置标签"},n(M).label),{default:l((()=>[s(It,{modelValue:n(N).label,"onUpdate:modelValue":a[9]||(a[9]=e=>n(N).label=e),type:"create"},null,8,["modelValue"])])),_:1},16),s(m,T({label:"安全级别"},n(M).safe_level),{default:l((()=>[s(c,{value:n(N).safe_level,"onUpdate:value":a[10]||(a[10]=e=>n(N).safe_level=e),options:w},null,8,["value"])])),_:1},16),s(m,T({label:"有效期"},n(M).expiration_type),{default:l((()=>[s(c,{value:n(N).expiration_type,"onUpdate:value":a[11]||(a[11]=e=>n(N).expiration_type=e)},{default:l((()=>[s(_,{value:"0"},{default:l((()=>[ll])),_:1}),s(_,{value:"1"},{default:l((()=>[nl])),_:1})])),_:1},8,["value"])])),_:1},16),"1"===n(N).expiration_type?(o(),t(m,T({key:1,"wrapper-col":{offset:2}},n(M).expiration_date),{default:l((()=>[s(h,{value:n(N).expiration_date,"onUpdate:value":a[12]||(a[12]=e=>n(N).expiration_date=e),valueFormat:"YYYY-MM-DD"},null,8,["value"])])),_:1},16)):k("",!0),s(m,T({label:"定位"},n(M).location,{wrapperCol:{span:6}}),{default:l((()=>[s(I,null,{default:l((()=>[s(C,{span:20,class:"mr15"},{default:l((()=>[s(v,{value:n(N).location,"onUpdate:value":a[13]||(a[13]=e=>n(N).location=e)},null,8,["value"])])),_:1}),s(C,{span:1},{default:l((()=>[s(x,{type:"primary",onClick:O},{icon:l((()=>[s(n(Je))])),default:l((()=>[ol])),_:1})])),_:1})])),_:1})])),_:1},16),s(m,T({label:"关联知识"},n(M).knowledge),{default:l((()=>[d("div",null,[s(x,{class:"mr15",type:"primary",onClick:a[14]||(a[14]=e=>n(D).visible=!0)},{default:l((()=>[sl])),_:1}),d("span",null,"已关联 "+r(n(D).knowledgeList.length)+" 条知识",1)]),s(Wt,{class:"mt24",rowKey:"id","data-source":n(D).knowledgeList,pagination:!1,bordered:""},{operation:l((({record:e})=>[s(x,{type:"primary",size:"small",onClick:a=>{return t=e,void D.knowledgeList.splice(D.knowledgeList.findIndex((e=>e.id==t.id)),1);var t}},{default:l((()=>[il])),_:2},1032,["onClick"])])),_:1},8,["data-source"])])),_:1},16),"readonly"!==n(p)?(o(),t(I,{key:2},{default:l((()=>[s(L),s(C,{span:24,style:{"text-align":"right"}},{default:l((()=>[s(x,{type:"primary",onClick:u(K,["prevent"])},{default:l((()=>[dl])),_:1},8,["onClick"]),s(x,{style:{"margin-left":"10px"},onClick:V},{default:l((()=>[rl])),_:1})])),_:1})])),_:1})):k("",!0)])),_:1})])),_:1}),n(S).visible?(o(),t(Jt,{key:0,modelValue:n(N).location,"onUpdate:modelValue":a[15]||(a[15]=e=>n(N).location=e),onCancel:A},null,8,["modelValue"])):k("",!0),n(D).visible?(o(),t(Xt,{key:1,"selected-rows":n(D).knowledgeList,onSuccess:F,onCancel:a[16]||(a[16]=e=>n(D).visible=!1)},null,8,["selected-rows"])):k("",!0)],64)}}}),[["__scopeId","data-v-ba143120"]]);const pl={class:"page-title"},ml=I(" 选择定位 "),vl=I("关联知识"),fl=I("移除"),yl=I("保存"),gl=I("取消");var bl=(e=>(e.update="编辑",e.create="新增",e))(bl||{});var kl=Aa(e({setup(e){const a=Ue(),c=Ae(),p=$a(),{type:m="create",id:f=""}=a.query,g=[{label:"水务局内部公开",value:"0"},{label:"同科室公开",value:"1"},{label:"私有",value:"3"}],w=de.useForm,{modelRef:C,rulesRef:I}={modelRef:i({knowledgeName:"",knowledgeType:"",content:"",labels:[],securityLevel:"0",location:""}),rulesRef:v((()=>({knowledgeName:[{required:!0,message:"请填写标题"}],knowledgeType:[{required:!0,message:"请选择分类"}],content:[{required:!0,message:"请填写专题描述"}],labels:[{required:!1}],securityLevel:[{required:!1}],location:[{required:!1}],knowledge:[{required:!1}]})))},N=h("");_((async()=>{"update"===m&&await(async()=>{const e=await ht({id:f}),{knowledgeName:a,knowledgeType:t,content:l,labels:n,securityLevel:o,longitude:s,latitude:i,relateds:d,version:r}=e;C.knowledgeName=a,C.knowledgeType=t,C.content=l,C.labels=n.map((e=>e.id)),C.securityLevel=null!=o?o:"0",C.location=s||i?s+", "+i:"",S.knowledgeList=d,N.value=r})()}));const L=i({visible:!1}),R=()=>{L.visible=!0},U=()=>{L.visible=!1},S=i({visible:!1,knowledgeList:[]}),O=e=>{const{selectedRows:a}=e;S.knowledgeList.push(...a)},A=h([]);(async()=>{const e=await st({type:"1"});A.value=e})();const{resetFields:D,validate:F,validateInfos:j}=w(C,I),q=async()=>{try{const e=(e=>{const{knowledgeName:a,knowledgeType:t,content:l,labels:n,securityLevel:o,location:s}=e,i=s?s.split(", "):[],d=x(n).join(","),r=S.knowledgeList.map((e=>e.id)).join(","),u={knowledgeFlag:"5",knowledgeName:a,knowledgeType:t,content:l,labels:d,securityLevel:o,longitude:i.length&&i[0],latitude:i.length&&i[1],relateds:r,userId:p.userInfo.id,parentUserId:p.userInfo.pUserId};return Qa(u)})(await F());await(async e=>"create"===m?await bt(e):await kt({...e,id:f,version:N.value}))(e),B.success("操作成功！"),M()}catch(e){}},M=()=>{D(),c.back()};return(e,a)=>{const i=ae,c=te,p=me,v=he,f=ge,h=le,_=se,w=ee,x=ce,I=de,N=X;return o(),y(b,null,[s(N,null,{default:l((()=>[d("div",pl,r(bl[n(m)])+"专题",1),s(I,{class:"mt24","label-col":{span:2},"wrapper-col":{span:14}},{default:l((()=>[s(c,T({label:"专题标题"},n(j).knowledgeName),{default:l((()=>[s(i,{value:n(C).knowledgeName,"onUpdate:value":a[0]||(a[0]=e=>n(C).knowledgeName=e),placeholder:"请填写专题标题"},null,8,["value"])])),_:1},16),s(c,T({label:"分类"},n(j).knowledgeType),{default:l((()=>[s(p,{value:n(C).knowledgeType,"onUpdate:value":a[1]||(a[1]=e=>n(C).knowledgeType=e),style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},fieldNames:{children:"children",label:"dictName",value:"id"},placeholder:"请选择知识分类","allow-clear":"","tree-default-expand-all":"","tree-data":A.value},null,8,["value","tree-data"])])),_:1},16),s(c,T({label:"专题描述"},n(j).content),{default:l((()=>[s(v,{value:n(C).content,"onUpdate:value":a[2]||(a[2]=e=>n(C).content=e),rows:4,placeholder:"请填写专题描述",maxlength:6},null,8,["value"])])),_:1},16),s(c,T({label:"设置标签"},n(j).labels),{default:l((()=>[s(It,{modelValue:n(C).labels,"onUpdate:modelValue":a[3]||(a[3]=e=>n(C).labels=e)},null,8,["modelValue"])])),_:1},16),s(c,T({label:"安全级别"},n(j).securityLevel),{default:l((()=>[s(f,{value:n(C).securityLevel,"onUpdate:value":a[4]||(a[4]=e=>n(C).securityLevel=e),options:g},null,8,["value"])])),_:1},16),s(c,T({label:"定位"},n(j).location,{wrapperCol:{span:6}}),{default:l((()=>[s(w,null,{default:l((()=>[s(h,{span:20,class:"mr15"},{default:l((()=>[s(i,{value:n(C).location,"onUpdate:value":a[5]||(a[5]=e=>n(C).location=e)},null,8,["value"])])),_:1}),s(h,{span:1},{default:l((()=>[s(_,{type:"primary",onClick:R},{icon:l((()=>[s(n(Je))])),default:l((()=>[ml])),_:1})])),_:1})])),_:1})])),_:1},16),s(c,T({label:"关联知识"},n(j).knowledge),{default:l((()=>[d("div",null,[s(_,{class:"mr15",type:"primary",onClick:a[6]||(a[6]=e=>n(S).visible=!0)},{default:l((()=>[vl])),_:1}),d("span",null,"已关联 "+r(n(S).knowledgeList.length)+" 条知识",1)]),s(Wt,{class:"mt24",rowKey:"id","data-source":n(S).knowledgeList,pagination:!1,bordered:""},{operation:l((({record:e})=>[s(_,{type:"primary",size:"small",onClick:a=>{return t=e,void S.knowledgeList.splice(S.knowledgeList.findIndex((e=>e.id==t.id)),1);var t}},{default:l((()=>[fl])),_:2},1032,["onClick"])])),_:1},8,["data-source"])])),_:1},16),"readonly"!==n(m)?(o(),t(w,{key:0},{default:l((()=>[s(x),s(h,{span:24,style:{"text-align":"right"}},{default:l((()=>[s(_,{type:"primary",onClick:u(q,["prevent"])},{default:l((()=>[yl])),_:1},8,["onClick"]),s(_,{style:{"margin-left":"10px"},onClick:M},{default:l((()=>[gl])),_:1})])),_:1})])),_:1})):k("",!0)])),_:1})])),_:1}),n(L).visible?(o(),t(Jt,{key:0,modelValue:n(C).location,"onUpdate:modelValue":a[7]||(a[7]=e=>n(C).location=e),onCancel:U},null,8,["modelValue"])):k("",!0),n(S).visible?(o(),t(Xt,{key:1,"selected-rows":n(S).knowledgeList,onSuccess:O,onCancel:a[8]||(a[8]=e=>n(S).visible=!1)},null,8,["selected-rows"])):k("",!0)],64)}}}),[["__scopeId","data-v-60a22808"]]);const hl=e=>Ea("/base/collection/query",e),_l=e=>Ea("/base/cancel/collection",e);const wl=(e,a)=>{(function(e){return new Promise((a=>{const t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Access-Control-Allow-Origin","*"),t.responseType="blob",t.onload=()=>{200===t.status&&a(t.response)},t.send()}))})(e).then((e=>{!function(e,a){const t=document.createElement("a"),l=document.querySelector("body");t.href=window.URL.createObjectURL(e),t.download=a,t.style.display="none",l&&l.appendChild(t),t.click(),l&&l.removeChild(t),window.URL.revokeObjectURL(t.href)}(e,a)}))};const Cl=e=>Ea("/base/error/correction/query",e),xl={class:"ant-upload-drag-icon"},Il=d("p",{class:"ant-upload-text"},"单击或拖动文件到该区域进行上传",-1),Nl=d("p",{class:"ant-upload-hint"},"支持单次或批量上传",-1),Tl=e({props:{id:null},emits:["success","cancel"],setup(e,{emit:a}){const r=e,{id:u}=m(r),c=de.useForm,p=i({labelCol:{span:4},wrapperCol:{span:20}}),v=i({content:"",picture:[],accessory:[]}),f=i({content:[{required:!0,message:"请选择纠错内容！"}],picture:[{required:!1}],accessory:[{required:!1}]}),y=({file:e})=>{if(!e.status){const a=v.accessory.indexOf(e),t=v.accessory.slice();t.splice(a,1),v.accessory=t}},g=e=>!0,b=async({onSuccess:e,onError:a,file:t},l)=>{(async t=>{const l=await wt(t);if(l)e&&e(l),v.accessory[v.accessory.length-1].thumbUrl=l;else{const e="上传失败";a&&a(e)}})(t)},k=e=>"error"===e.status||(ue.confirm({title:"确定删除吗?",icon:s(He),content:"",okText:"确定",okType:"danger",cancelText:"取消",onOk:()=>{const a=v.accessory.indexOf(e);v.accessory.splice(a,1)},onCancel(){}}),!1),{resetFields:h,validate:_,validateInfos:w}=c(v,f),C=async()=>{try{const t=(({content:e,picture:a,accessory:t})=>({knowledgeId:u.value,content:e,picture:a.map((e=>e.response)).join(","),accessory:t.map((e=>e.response)).join(",")}))(await _());await(e=t,Ba("/base/error/correction/save",e)),B.success("成功!"),a("success"),x()}catch(t){}var e},x=()=>{h(),a("cancel",!1)};return(e,a)=>{const i=he,r=te,u=pe,c=de,m=ue;return o(),t(m,{width:"600px",title:"内容纠错",visible:!0,destroyOnClose:"",onOk:C,onCancel:x},{default:l((()=>[s(c,L(R(n(p))),{default:l((()=>[s(r,T({label:"内容"},n(w).content),{default:l((()=>[s(i,{value:n(v).content,"onUpdate:value":a[0]||(a[0]=e=>n(v).content=e),rows:4,placeholder:"请填写描述",maxlength:6},null,8,["value"])])),_:1},16),s(r,T({label:"补充图片"},n(w).picture),{default:l((()=>[s(Yt,{modelValue:n(v).picture,"onUpdate:modelValue":a[1]||(a[1]=e=>n(v).picture=e),"max-length":8,type:"1"},null,8,["modelValue"])])),_:1},16),s(r,T({label:"补充附件"},n(w).accessory),{default:l((()=>[s(u,{fileList:n(v).accessory,"onUpdate:fileList":a[2]||(a[2]=e=>n(v).accessory=e),name:"file",multiple:!0,"custom-request":b,"before-upload":g,onRemove:k,onChange:y},{default:l((()=>[d("p",xl,[s(n($e))]),Il,Nl])),_:1},8,["fileList"])])),_:1},16)])),_:1},16)])),_:1})}}}),Ll=d("div",null,"内容:",-1),Rl=["innerHTML"],Ul=e({props:{content:null},emits:["success","cancel"],setup(e,{emit:a}){const i=e,{content:r}=m(i),u=()=>{a("success"),c()},c=()=>{a("cancel")};return(e,a)=>{const i=le,p=ee,m=ue;return o(),t(m,{title:"查看修订内容",visible:!0,maskClosable:!1,closable:!1,width:"600px",destroyOnClose:"",onOk:u,onCancel:c},{default:l((()=>[s(p,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[Ll])),_:1}),s(i,{span:19},{default:l((()=>[d("div",{innerHTML:n(r)},null,8,Rl)])),_:1})])),_:1})])),_:1})}}}),Sl={class:"ant-rate-text"},Ol=e({props:{knowledgeId:null},emits:["success","cancel"],setup(e,{emit:a}){const u=e,{knowledgeId:c}=m(u),p=de.useForm,v=i({labelCol:{span:4},wrapperCol:{span:20}}),f=i({rate:1}),y=i({rate:[{required:!0,message:"请选择分数！"}]}),{resetFields:g,validate:b,validateInfos:k}=p(f,y),h=async()=>{try{const t=await b();await(e={...t,knowledgeId:c.value},Ba("base/rate/save",e)),B.success("成功!"),a("success"),_()}catch(t){}var e},_=()=>{g(),a("cancel",!1)};return(e,a)=>{const i=_e,u=te,c=de,p=ue;return o(),t(p,{width:"400px",title:"评价",visible:!0,destroyOnClose:"",onOk:h,onCancel:_},{default:l((()=>[s(c,L(R(n(v))),{default:l((()=>[s(u,T({label:"评分"},n(k).rate),{default:l((()=>[s(i,{value:n(f).rate,"onUpdate:value":a[0]||(a[0]=e=>n(f).rate=e)},null,8,["value"]),d("span",Sl,r(n(f).rate)+"分",1)])),_:1},16)])),_:1},16)])),_:1})}}});const Al=e=>(c("data-v-aebdb760"),e=e(),p(),e),Dl={class:"ant-rate-text"},Fl=I("分享"),jl=I("纠错"),ql=Al((()=>d("span",{class:"label"},"分类: ",-1))),Ml={class:"value"},Kl=Al((()=>d("span",{class:"label"},"安全级别: ",-1))),Vl={class:"value"},Pl=Al((()=>d("span",{class:"label"},"有效时间: ",-1))),zl={class:"value"},El=Al((()=>d("span",{class:"label"},"标签: ",-1))),Bl={class:"value"},Yl=Al((()=>d("span",{class:"label"},"创建人: ",-1))),$l={class:"value"},Hl=Al((()=>d("span",{class:"label"},"创建时间: ",-1))),Gl={class:"value"},Jl=Al((()=>d("span",{class:"label"},"状态: ",-1))),Wl={class:"value"},Zl=Al((()=>d("span",{class:"label"},"内容: ",-1))),Xl=["innerHTML"],Ql=Al((()=>d("span",{class:"label"},"附件列表: ",-1))),en={class:"file"},an=I("下载"),tn=Al((()=>d("span",{class:"label"},"相关知识: ",-1))),ln={class:"file"},nn={class:"user-info"},on={class:"user-name"},sn={class:"base-info mb24"},dn=Al((()=>d("div",{class:"title mb15"},"基本信息",-1))),rn=Al((()=>d("span",{class:"label"},"科室",-1))),un={class:"value"},cn=Al((()=>d("span",{class:"label"},"性别",-1))),pn={class:"value"},mn=Al((()=>d("span",{class:"label"},"联系电话",-1))),vn={class:"value"},fn=Al((()=>d("span",{class:"label"},"最后修改时间",-1))),yn={class:"value"},gn=Al((()=>d("span",{class:"label"},"直接领导",-1))),bn={class:"value"},kn={class:"version"},hn=Al((()=>d("div",{class:"version-title"},"条目版本",-1))),_n=I("查看");var wn=Aa(e({name:"ArticleDetail",setup(e){var a;const u=Ue();Ae();const{id:c=""}=u.query,p=i({DEFAULT_AVATAR:null==(a=Oa)?void 0:a.defaultAvatar}),m=[{title:"版本",dataIndex:"version"},{title:"修订人",dataIndex:"creator"},{title:"修订时间",dataIndex:"createTime"},{title:"操作",dataIndex:"operation"}],v=h([]),f=h(0),w=h(!1),C=h({evaluate:0,accessory:"",archiveStatus:0,content:"",createTime:"",knowledgeName:"",knowledgeTypeName:"",labels:[],relateds:[],securityLevelName:"",expirationType:"",endTime:"",collectStatus:0,creator:"",user:{},archiveUserName:"",logs:[],knowledgeFlag:""}),x=async()=>{const e=await ht({id:c});C.value=e;const a=e.accessory.split(",");v.value=a.map((e=>{const a=e.split("/");return a[a.length-1]})),C.value.knowledgeTypeName=e.knowledgeTypeName.split(",").join("-"),f.value=e.evaluate},N=async()=>{const e=await(a={knowledgeId:c},Ea("base/rate/check/state",a));var a;w.value=e};_((async()=>{await x(),await N()}));const T=async()=>{const e={knowledgeId:c};if(1===C.value.collectStatus)return await _l(e),B.success("取消收藏成功！"),void(C.value.collectStatus=0);var a;await(a=e,Ea("/base/collection",a)),B.success("收藏成功！"),C.value.collectStatus=1},{correctState:L,handleOpenCorrectDialog:R,handleCloseCorrectDialog:U}=function(e){const a=i({visible:!1,id:e});return{correctState:a,handleOpenCorrectDialog:()=>{a.visible=!0},handleCloseCorrectDialog:()=>{a.visible=!1}}}(c),{viewContentState:S,handleViewContent:O,handleCloseViewContentDialog:A}=function(){const e=i({visible:!1,content:""});return{viewContentState:e,handleViewContent:a=>{e.visible=!0,e.content=a},handleCloseViewContentDialog:()=>{e.visible=!1}}}(),{rateState:D,handleRate:F,handleCloseRateDialog:j}=function(e){const a=i({visible:!1,id:e});return{rateState:a,handleRate:()=>{a.visible=!0},handleCloseRateDialog:()=>{a.visible=!1}}}(c),q=()=>{x(),N()},{share:M}=yt();return(e,a)=>{const i=le,u=ee,h=_e,_=se,x=we,N=K,V=re,P=X;return o(),y(b,null,[s(P,null,{default:l((()=>[s(u,null,{default:l((()=>[s(i,{span:16},{default:l((()=>[s(u,{class:"mb24"},{default:l((()=>[s(i,{span:12,class:"title"},{default:l((()=>[I(r(C.value.knowledgeName),1)])),_:1})])),_:1}),s(u,{class:"mb15"},{default:l((()=>[s(i,{span:12},{default:l((()=>[s(h,{value:f.value,"onUpdate:value":a[0]||(a[0]=e=>f.value=e),"allow-half":"",disabled:""},null,8,["value"]),d("span",Dl,r(f.value)+"分",1)])),_:1}),s(i,{span:12},{default:l((()=>[s(_,{type:"link",class:"mr10",onClick:T},{default:l((()=>[I(r(1===C.value.collectStatus?"取消收藏":"收藏"),1)])),_:1}),s(_,{type:"link",class:"mr10",onClick:a[1]||(a[1]=e=>n(M)({id:n(c),title:C.value.knowledgeName,type:C.value.knowledgeFlag,endTime:"0"===C.value.expirationType?"永久有效":C.value.endTime}))},{default:l((()=>[Fl])),_:1}),s(_,{type:"link",class:"mr10",onClick:n(R)},{default:l((()=>[jl])),_:1},8,["onClick"]),s(_,{type:"link",onClick:n(F),disabled:w.value},{default:l((()=>[I(r(w.value?"已评价":"评价"),1)])),_:1},8,["onClick","disabled"])])),_:1})])),_:1}),s(u,{class:"mb15"},{default:l((()=>[s(i,{span:12},{default:l((()=>[ql,d("span",Ml,r(C.value.knowledgeTypeName),1)])),_:1}),s(i,{span:12},{default:l((()=>[Kl,d("span",Vl,r(C.value.securityLevelName),1)])),_:1})])),_:1}),s(u,{class:"mb15"},{default:l((()=>[s(i,{span:12},{default:l((()=>[Pl,d("span",zl,r("0"===C.value.expirationType?"永久有效":C.value.endTime),1)])),_:1}),s(i,{span:12},{default:l((()=>[El,d("span",Bl,[(o(!0),y(b,null,g(C.value.labels,(e=>(o(),t(x,{class:"tag-item mr10",color:"blue"},{default:l((()=>[I(r(e.labelName),1)])),_:2},1024)))),256))])])),_:1})])),_:1}),s(u,{class:"mb15"},{default:l((()=>[s(i,{span:12},{default:l((()=>[Yl,d("span",$l,r(C.value.creator),1)])),_:1}),s(i,{span:12},{default:l((()=>[Hl,d("span",Gl,r(C.value.createTime),1)])),_:1})])),_:1}),s(u,{class:"mb15"},{default:l((()=>[s(i,{span:12},{default:l((()=>[Jl,d("span",Wl,r(0===C.value.archiveStatus?"未归档":"已归档"),1)])),_:1})])),_:1}),s(u,{class:"mb15"},{default:l((()=>[s(i,{span:12},{default:l((()=>[Zl,d("div",{class:"value",innerHTML:C.value.content},null,8,Xl)])),_:1})])),_:1}),s(u,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[Ql])),_:1}),s(i,{span:19},{default:l((()=>[(o(!0),y(b,null,g(v.value,((e,a)=>(o(),t(u,null,{default:l((()=>[s(i,{span:17},{default:l((()=>[d("div",en,r(e),1)])),_:2},1024),s(i,{span:2},{default:l((()=>[s(_,{class:"link-btn",type:"link",onClick:e=>(e=>{const a=C.value.accessory.split(",");wl(a[e],v.value[e])})(a)},{default:l((()=>[an])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),256))])),_:1})])),_:1}),s(u,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[tn])),_:1}),s(i,{span:19},{default:l((()=>[(o(!0),y(b,null,g(C.value.relateds,(e=>(o(),y("div",ln,r(e.knowledgeName),1)))),256))])),_:1})])),_:1})])),_:1}),s(i,{span:8},{default:l((()=>[d("div",nn,[s(N,{src:n(p).DEFAULT_AVATAR},null,8,["src"]),d("div",on,r(C.value.creator),1)]),s(n(da)),d("div",sn,[dn,s(u,{class:"mb10"},{default:l((()=>[s(i,{span:12},{default:l((()=>[rn])),_:1}),s(i,{span:12},{default:l((()=>[d("span",un,r(C.value.user.deptName),1)])),_:1})])),_:1}),s(u,{class:"mb10"},{default:l((()=>[s(i,{span:12},{default:l((()=>[cn])),_:1}),s(i,{span:12},{default:l((()=>[d("span",pn,r(0===C.value.user.sex?"男":"女"),1)])),_:1})])),_:1}),s(u,{class:"mb10"},{default:l((()=>[s(i,{span:12},{default:l((()=>[mn])),_:1}),s(i,{span:12},{default:l((()=>[d("span",vn,r(C.value.user.moblie),1)])),_:1})])),_:1}),s(u,{class:"mb10"},{default:l((()=>[s(i,{span:12},{default:l((()=>[fn])),_:1}),s(i,{span:12},{default:l((()=>[d("span",yn,r(C.value.user.updateTime),1)])),_:1})])),_:1}),s(u,{class:"mb10"},{default:l((()=>[s(i,{span:12},{default:l((()=>[gn])),_:1}),s(i,{span:12},{default:l((()=>[d("span",bn,r(C.value.user.higherUp),1)])),_:1})])),_:1})]),d("div",kn,[hn,s(V,{columns:m,"data-source":C.value.logs,bordered:""},{bodyCell:l((({column:e,text:a,record:s})=>["operation"===e.dataIndex?(o(),t(_,{key:0,type:"link",class:"action-btn",onClick:e=>n(O)(s.content)},{default:l((()=>[_n])),_:2},1032,["onClick"])):k("",!0)])),_:1},8,["data-source"])])])),_:1})])),_:1})])),_:1}),n(L).visible?(o(),t(Tl,{key:0,id:n(c),onCancel:n(U)},null,8,["id","onCancel"])):k("",!0),n(S).visible?(o(),t(Ul,{key:1,content:n(S).content,onCancel:n(A)},null,8,["content","onCancel"])):k("",!0),n(D).visible?(o(),t(Ol,{key:2,knowledgeId:n(D).id,onSuccess:q,onCancel:n(j)},null,8,["knowledgeId","onCancel"])):k("",!0)],64)}}}),[["__scopeId","data-v-aebdb760"]]);const Cn=e=>Ea("/user/query",e),xn=e=>Ea("/role/query",e),In=e({props:{info:null},emits:["success","cancel"],setup(e,{emit:a}){const n=e,{info:i}=m(n),d=h([]),u=h([]);(async()=>{const{records:e}=await xn({});u.value=e.map((({roleName:e,roleDesc:a,id:t})=>({label:`${e}（${a}）`,value:t})))})();const c=async()=>{const e={userIds:i.value.map((e=>e.puserId)).join(","),roleIds:d.value.join(",")};var t;await(t=e,Ba("/user/set/role",t)),B.success("设置成功"),a("success"),p()},p=()=>{a("cancel",!1)};return(e,a)=>{const n=xe,i=le,m=ee,v=Ce,f=ue;return o(),t(f,{title:"设置角色",visible:!0,closable:!1,width:"600px",destroyOnClose:!0,onOk:c,onCancel:p},{default:l((()=>[s(v,{value:d.value,"onUpdate:value":a[0]||(a[0]=e=>d.value=e)},{default:l((()=>[(o(!0),y(b,null,g(u.value,(e=>(o(),t(m,null,{default:l((()=>[s(i,{span:24},{default:l((()=>[s(n,{value:e.value},{default:l((()=>[I(r(e.label),1)])),_:2},1032,["value"])])),_:2},1024)])),_:2},1024)))),256))])),_:1},8,["value"])])),_:1})}}}),Nn=I(" 确认回收该用户所有权限？ "),Tn=e({props:{info:null},emits:["success","cancel"],setup(e,{emit:a}){const n=e,{info:s}=m(n),i=async()=>{const e={userIds:s.value.map((e=>e.id)).join(",")};var t;await(t=e,Ea("/user/del/role",t)),B.success("回收成功"),a("success"),d()},d=()=>{a("cancel",!1)};return(e,a)=>{const n=ue;return o(),t(n,{visible:!0,closable:!1,width:"400px",destroyOnClose:!0,onOk:i,onCancel:d},{default:l((()=>[Nn])),_:1})}}});const Ln=I("查询"),Rn=I("重置"),Un=I("设置角色"),Sn=I("回收权限"),On=I("查看操作日志");var An=Aa(e({name:"UserList",setup(e){const a=h([{label:"超级管理员",value:"00"},{label:"子系统管理员",value:"01"},{label:"业务导员",value:"02"},{label:"局领导",value:"03"}]),d=[{title:"账号",dataIndex:"account",key:"account",align:"center"},{title:"姓名",dataIndex:"userName",key:"userName",align:"center"},{title:"职务",dataIndex:"position",key:"position",align:"center"},{title:"办公室电话",dataIndex:"officeTelephone",key:"officeTelephone",align:"center"},{title:"手机号",dataIndex:"moblie",key:"moblie",align:"center"},{title:"直接上级",dataIndex:"higherUp",key:"higherUp",align:"center"},{title:"系统角色",dataIndex:"roleName",key:"roleName",align:"center"}],r=h([]),u=i([]),c=h([]),p=i({userName:"",rid:[]});U(c,(e=>{c.value.length>0?p.deptId=c.value[0]:p.deptId=""}));const m={onChange:(e,a)=>{r.value=a}},{onSearch:v,onReset:f,pagination:g,dataSource:b,searchFormRef:_,onTableChange:w,getList:C}=tt({fetchData:Cn,formatParams:()=>({...p})});(async()=>{const e=await Ea("/dept/tree/query");Object.assign(u,e)})();const x=i({visible:!1}),I=()=>{x.visible=!0},N=()=>{x.visible=!1},T=i({visible:!1}),L=()=>{T.visible=!0},R=()=>{T.visible=!1};return(e,i)=>{const h=ae,U=te,S=le,O=Ie,A=se,D=ie,F=ee,j=de,q=X,M=Ne,K=re;return o(),y("div",null,[s(q,{class:"search-box"},{default:l((()=>[s(j,{ref_key:"searchFormRef",ref:_,layout:"inline",model:n(p)},{default:l((()=>[s(F,{gutter:[24,16]},{default:l((()=>[s(S,null,{default:l((()=>[s(U,{label:"姓名",name:"userName"},{default:l((()=>[s(h,{value:n(p).userName,"onUpdate:value":i[0]||(i[0]=e=>n(p).userName=e),valueModifiers:{trim:!0},placeholder:"请输入姓名",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(S,null,{default:l((()=>[s(U,{label:"角色",name:"rid"},{default:l((()=>[s(O,{style:{"min-width":"250px"},value:n(p).rid,"onUpdate:value":i[1]||(i[1]=e=>n(p).rid=e),options:a.value,placeholder:"请选择角色","allow-clear":""},null,8,["value","options"])])),_:1})])),_:1}),s(S,null,{default:l((()=>[s(U,null,{default:l((()=>[s(D,{size:20},{default:l((()=>[s(A,{type:"primary",onClick:n(v)},{default:l((()=>[Ln])),_:1},8,["onClick"]),s(A,{onClick:n(f)},{default:l((()=>[Rn])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(F,{class:"mt20"},{default:l((()=>[s(S,{span:8},{default:l((()=>[s(q,{class:"mr15",title:"组织结构"},{default:l((()=>[s(M,{"tree-data":n(u),"field-names":{title:"deptName",key:"id",children:"children"},defaultExpandAll:"",selectedKeys:c.value,"onUpdate:selectedKeys":i[2]||(i[2]=e=>c.value=e)},null,8,["tree-data","selectedKeys"])])),_:1})])),_:1}),s(S,{span:16},{default:l((()=>[s(q,null,{default:l((()=>[s(F,{class:"action-btn-box"},{default:l((()=>[s(A,{class:"mr15",type:"primary",disabled:!r.value.length,onClick:L},{default:l((()=>[Un])),_:1},8,["disabled"]),s(A,{danger:"",onClick:I,disabled:!r.value.length},{default:l((()=>[Sn])),_:1},8,["disabled"])])),_:1}),s(K,{rowKey:"id","row-selection":m,columns:d,"data-source":n(b),pagination:n(g),bordered:"",onChange:n(w)},{bodyCell:l((({column:e,record:a})=>["operation"===e.dataIndex?(o(),t(A,{key:0,type:"link",class:"action-btn",onClick:e=>{}},{default:l((()=>[On])),_:2},1032,["onClick"])):k("",!0)])),_:1},8,["data-source","pagination","onChange"])])),_:1})])),_:1})])),_:1}),n(T).visible?(o(),t(In,{key:0,info:r.value,onSuccess:n(C),onCancel:R},null,8,["info","onSuccess"])):k("",!0),n(x).visible?(o(),t(Tn,{key:1,info:r.value,onSuccess:n(C),onCancel:N},null,8,["info","onSuccess"])):k("",!0)])}}}),[["__scopeId","data-v-1f0201ae"]]);const Dn=e({props:{type:null,info:null},emits:["success","cancel"],setup(e,{emit:a}){const d=e,{type:r,info:u}=m(d),c=de.useForm,p=i({labelCol:{span:4},wrapperCol:{span:20}}),v=i({name:"",desc:""}),f=h([]),y=h([]),g=i({name:[{required:!0,message:"请填写角色名称！"}],desc:[{required:!1}],menu:[{required:!0,message:"请选择菜单项！"}]}),b=i([]),k={};(async()=>{const e=await Ea("/menu/tree/query");Object.assign(b,e);const a=e=>{e.forEach((({id:e,menuName:t,children:l})=>{k[e]=t,l&&l.length&&a(l)}))};a(e)})();const _=async()=>{var e,a;const{roleName:t,roleDesc:l,menus:n}=await(o={id:null!=(a=null==(e=null==u?void 0:u.value)?void 0:e.id)?a:""},Ea("/role/detail",o));var o;v.desc=l,v.name=t,f.value=n?n.filter((({status:e})=>"0"===e)).map((e=>e.menuId)):[],y.value=n?n.filter((({status:e})=>"1"===e)).map((e=>e.menuId)):[]};"update"===r.value&&_();const w=(e,a)=>{y.value=a.halfCheckedKeys},{resetFields:C,validate:x,validateInfos:I}=c(v,g),N=async e=>{var a,t;const{name:l,desc:n}=e,o=[];f.value.forEach((e=>{"可编辑"!==k[e]&&"仅查看"!==k[e]&&o.push(k[e])}));let s=f.value.map((e=>({menuId:e})));s=[...s,...y.value.map((e=>({menuId:e,status:1})))];const i={roleName:l,roleDesc:n,menuDTOS:s,roleModules:o.join(",")};if("create"===r.value)return await(d=i,Ba("/role/save",d));var d;const c={...i,id:null!=(t=null==(a=null==u?void 0:u.value)?void 0:a.id)?t:""};return await(e=>Ba("/role/update",e))(c)},U=async()=>{try{const e=await x();await N(e),B.success("成功!"),a("success"),S()}catch(e){}},S=()=>{C(),a("cancel",!1)};return(e,a)=>{const i=ae,d=te,u=he,c=Ne,m=de,y=ue;return o(),t(y,{visible:!0,title:"create"===n(r)?"新建角色":"更新角色",closable:!1,width:"600px",destroyOnClose:!0,onOk:U,onCancel:S},{default:l((()=>[s(m,L(R(n(p))),{default:l((()=>[s(d,T({label:"角色名称"},n(I).name),{default:l((()=>[s(i,{value:n(v).name,"onUpdate:value":a[0]||(a[0]=e=>n(v).name=e),placeholder:"请输入角色名称"},null,8,["value"])])),_:1},16),s(d,T({label:"角色描述"},n(I).desc),{default:l((()=>[s(u,{value:n(v).desc,"onUpdate:value":a[1]||(a[1]=e=>n(v).desc=e),rows:4,maxlength:6},null,8,["value"])])),_:1},16),s(d,T({label:"菜单列表"},n(I).menu),{default:l((()=>[s(c,{checkedKeys:f.value,"onUpdate:checkedKeys":a[2]||(a[2]=e=>f.value=e),checkable:"","tree-data":n(b),fieldNames:{children:"children",title:"menuName",key:"id"},onCheck:w},null,8,["checkedKeys","tree-data"])])),_:1},16)])),_:1},16)])),_:1},8,["title"])}}});const Fn=I("查询"),jn=I("重置"),qn=I("新建"),Mn=I("编辑"),Kn=I("删除");var Vn=Aa(e({name:"RoleList",setup(e){const a=[{title:"角色名称",dataIndex:"roleName",key:"roleName",align:"center"},{title:"模块",dataIndex:"roleModules",key:"roleModules",align:"center"},{title:"描述",dataIndex:"roleDesc",key:"roleDesc",align:"center"},{title:"操作",dataIndex:"operation",align:"center"}],d=i({roleName:""}),{onSearch:r,onReset:u,pagination:c,dataSource:p,searchFormRef:m,onTableChange:v,getList:f}=tt({fetchData:xn,formatParams:()=>({...d})}),g=async({id:e})=>{var a;await(a={roleId:e},Ea("/role/del",a)),B.success("删除成功！"),f()},h=i({visible:!1,currentRow:{},type:"create"}),_=(e,a)=>{h.visible=!0,h.type=e,a&&(h.currentRow=a)},w=()=>{h.visible=!1};return(e,i)=>{const C=ae,x=te,I=le,N=se,T=ie,L=ee,R=de,U=X,S=re;return o(),y("div",null,[s(U,{class:"search-box"},{default:l((()=>[s(R,{ref_key:"searchFormRef",ref:m,layout:"inline",model:n(d)},{default:l((()=>[s(L,{gutter:[24,16]},{default:l((()=>[s(I,null,{default:l((()=>[s(x,{label:"角色名称",name:"roleName"},{default:l((()=>[s(C,{value:n(d).roleName,"onUpdate:value":i[0]||(i[0]=e=>n(d).roleName=e),valueModifiers:{trim:!0},placeholder:"请输入角色名称",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(I,null,{default:l((()=>[s(x,null,{default:l((()=>[s(T,{size:20},{default:l((()=>[s(N,{type:"primary",onClick:n(r)},{default:l((()=>[Fn])),_:1},8,["onClick"]),s(N,{onClick:n(u)},{default:l((()=>[jn])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(U,null,{default:l((()=>[s(L,{class:"action-btn-box"},{default:l((()=>[s(N,{type:"primary",onClick:i[1]||(i[1]=e=>_("create"))},{default:l((()=>[qn])),_:1})])),_:1}),s(S,{rowKey:"id",columns:a,"data-source":n(p),pagination:n(c),bordered:"",onChange:n(v)},{bodyCell:l((({column:e,record:a})=>["operation"===e.dataIndex?(o(),y(b,{key:0},[s(N,{type:"link",class:"action-btn",onClick:e=>_("update",a)},{default:l((()=>[Mn])),_:2},1032,["onClick"]),s(N,{type:"link",class:"action-btn",onClick:e=>g(a)},{default:l((()=>[Kn])),_:2},1032,["onClick"])],64)):k("",!0)])),_:1},8,["data-source","pagination","onChange"])])),_:1}),n(h).visible?(o(),t(Dn,{key:0,type:n(h).type,info:n(h).currentRow,onSuccess:n(f),onCancel:w},null,8,["type","info","onSuccess"])):k("",!0)])}}}),[["__scopeId","data-v-eb331234"]]);const Pn=I("查询"),zn=I("重置"),En=I("新建"),Bn=I("删除"),Yn=I("编辑"),$n=I("删除");var Hn=Aa(e({name:"LabelList",setup(e){const a=i({labelName:""}),d=v((()=>(C.value,[{title:"知识标签",dataIndex:"labelName",key:"labelName",align:"center"},{title:"创建时间",dataIndex:"createTime",key:"createTime",align:"center"},{title:"创建人",dataIndex:"labelCreator",key:"labelCreator",align:"center"},{title:"操作",dataIndex:"operation",align:"center"}]))),r=h([]),u={onChange:(e,a)=>{r.value=a}},{onSearch:c,onReset:p,pagination:m,dataSource:f,searchFormRef:g,onTableChange:_,getList:w,sortedInfo:C}=tt({fetchData:dt,formatParams:()=>({...a})}),x=i({visible:!1,currentRow:{},type:"create"}),I=(e,a)=>{x.visible=!0,a&&(x.currentRow=a),x.type=e},N=()=>{x.visible=!1},T=async e=>{const a=e.map((e=>e.id)).join(",");var t;await(t={ids:a},Ea("/label/del",t)),B.success("删除成功！"),w()};return(e,i)=>{const v=ae,h=te,C=le,L=se,R=ie,U=ee,S=de,O=X,A=ve,D=re;return o(),y("div",null,[s(O,{class:"search-box"},{default:l((()=>[s(S,{ref_key:"searchFormRef",ref:g,layout:"inline",model:n(a)},{default:l((()=>[s(U,{gutter:[24,16]},{default:l((()=>[s(C,null,{default:l((()=>[s(h,{label:"标签名称",name:"labelName"},{default:l((()=>[s(v,{value:n(a).labelName,"onUpdate:value":i[0]||(i[0]=e=>n(a).labelName=e),valueModifiers:{trim:!0},placeholder:"请输入标签名称",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(C,null,{default:l((()=>[s(h,null,{default:l((()=>[s(R,{size:20},{default:l((()=>[s(L,{type:"primary",onClick:n(c)},{default:l((()=>[Pn])),_:1},8,["onClick"]),s(L,{onClick:n(p)},{default:l((()=>[zn])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(O,null,{default:l((()=>[s(U,{class:"action-btn-box"},{default:l((()=>[s(L,{class:"mr15",type:"primary",onClick:i[1]||(i[1]=e=>I("create"))},{default:l((()=>[En])),_:1}),s(A,{title:"确认要删除所选标签吗？","ok-text":"确定","cancel-text":"取消",onConfirm:i[2]||(i[2]=e=>T(r.value)),onCancel:i[3]||(i[3]=()=>{}),disabled:!r.value.length},{default:l((()=>[s(L,{danger:"",disabled:!r.value.length},{default:l((()=>[Bn])),_:1},8,["disabled"])])),_:1},8,["disabled"])])),_:1}),s(D,{rowKey:"id","row-selection":u,columns:n(d),"data-source":n(f),pagination:n(m),bordered:"",onChange:n(_)},{bodyCell:l((({column:e,record:a})=>["operation"===e.dataIndex?(o(),y(b,{key:0},[s(L,{type:"link",class:"action-btn",onClick:e=>I("update",a)},{default:l((()=>[Yn])),_:2},1032,["onClick"]),s(L,{type:"link",class:"action-btn",onClick:e=>T([a])},{default:l((()=>[$n])),_:2},1032,["onClick"])],64)):k("",!0)])),_:1},8,["columns","data-source","pagination","onChange"])])),_:1}),n(x).visible?(o(),t(Ct,{key:0,type:n(x).type,info:n(x).currentRow,onSuccess:n(w),onCancel:N},null,8,["type","info","onSuccess"])):k("",!0)])}}}),[["__scopeId","data-v-9b58adde"]]);const Gn=e({props:{type:null,category:null,id:null,name:null},emits:["success","cancel"],setup(e,{emit:a}){const d=e,{type:r,name:u,category:c,id:p}=m(d),v=de.useForm,f=i({labelCol:{span:4},wrapperCol:{span:20}}),y=i({name:"update"===r.value?u.value:""}),g=i({name:[{required:!0,message:"请填写名称！"}]}),{resetFields:b,validate:k,validateInfos:h}=v(y,g),_=async e=>{return"create"===r.value?await(a={dictName:e.name,dictPid:p.value,dictType:c.value},Ba("/dict/add",a)):await(e=>Ba("/dict/update",e))({dictName:e.name,id:p.value,dictType:c.value});var a},w=async()=>{try{const e=await k();await _(e),B.success("成功！"),a("success"),C()}catch(e){}},C=()=>{b(),a("cancel",!1)};return(e,a)=>{const i=ae,d=te,u=de,c=ue;return o(),t(c,{visible:!0,title:"create"===n(r)?"新建":"更新",closable:!1,width:"400px",destroyOnClose:!0,onOk:w,onCancel:C},{default:l((()=>[s(u,L(R(n(f))),{default:l((()=>[s(d,T({label:"名称"},n(h).name),{default:l((()=>[s(i,{value:n(y).name,"onUpdate:value":a[0]||(a[0]=e=>n(y).name=e),placeholder:"请输入名称"},null,8,["value"])])),_:1},16)])),_:1},16)])),_:1},8,["title"])}}});const Jn=I("新建"),Wn={class:"custom-tree-node"},Zn=e({name:"Dictionary",setup(e){const a=i({status:"1"}),u=h([]),c=async()=>{const e=await st({type:a.status});u.value=e};c();const p=()=>{c()},m=i({visible:!1,id:"",type:"create",category:"0",name:""}),v=(e,t)=>{var l;const n={visible:!0,id:null!=(l=null==t?void 0:t.id)?l:"",type:e,category:a.status,name:"update"===e?t&&t.dictName:""};Object.assign(m,n),c()},f=async(e,a)=>{await(e=>Ea("/dict/del",e))({id:a.id+""}),B.success("删除成功！"),c()},_=()=>{m.visible=!1,c()};return(e,i)=>{const c=W,h=Z,w=X,C=se,x=ee,I=ve;return o(),y("div",null,[s(w,{class:"search-box-wrap mt15"},{default:l((()=>[s(h,{activeKey:n(a).status,"onUpdate:activeKey":i[0]||(i[0]=e=>n(a).status=e),type:"card",tabBarGutter:6,class:"search-tabs",onChange:p},{default:l((()=>[(o(!0),y(b,null,g(n(ot),(e=>(o(),t(c,{key:e.value,tab:e.label},null,8,["tab"])))),128))])),_:1},8,["activeKey"])])),_:1}),s(w,{class:"table-box mt20"},{default:l((()=>["1"===n(a).status?(o(),t(x,{key:0,class:"action-btn-box"},{default:l((()=>[s(C,{type:"primary",onClick:i[1]||(i[1]=e=>v("create"))},{default:l((()=>[Jn])),_:1})])),_:1})):k("",!0),u.value.length?(o(),t(n(ia),{key:2,data:u.value,"node-key":"id","default-expand-all":"","expand-on-click-node":!1,props:{label:"dictName"}},D({_:2},["1"===n(a).status?{name:"default",fn:l((({node:e,data:a})=>[d("span",Wn,[d("span",null,r(e.label),1),d("span",null,[s(n(We),{onClick:e=>v("create",a),class:"mr5"},null,8,["onClick"]),s(n(Ze),{onClick:e=>v("update",a),class:"mr5"},null,8,["onClick"]),s(I,{title:"确定要删除该节点吗?","ok-text":"确认","cancel-text":"取消",onConfirm:e=>f(0,a),onCancel:i[2]||(i[2]=()=>{})},{default:l((()=>[s(n(Xe))])),_:2},1032,["onConfirm"])])])]))}:void 0]),1032,["data"])):(o(),t(n(sa),{key:1,"image-size":200,description:"暂无数据"}))])),_:1}),n(m).visible?(o(),t(Gn,{key:0,type:n(m).type,category:n(m).category,id:n(m).id,name:n(m).name,onSuccess:i[3]||(i[3]=()=>{}),onCancel:_},null,8,["type","category","id","name"])):k("",!0)])}}});const Xn=I("查询"),Qn=I("重置"),eo=I("取消收藏 "),ao=I("分享");var to=Aa(e({name:"CollectionList",setup(e){Ae();const d=Ue(),u=$a(),c=d.meta.key,p=v((()=>u.menuOperateAuthMap[c])),m=v((()=>{T.value;const e=[{title:"类型",dataIndex:"knowledgeFlag",key:"knowledgeFlag",align:"center",customRender:({text:e})=>nt[e]},{title:"知识条目",dataIndex:"knowledgeName",key:"knowledgeName",align:"center"},{title:"分类",dataIndex:"knowledgeTypeName",key:"knowledgeTypeName",align:"center",customRender:({text:e})=>e?e.split(", ").join("-"):""},{title:"评分",dataIndex:"evaluate",key:"evaluate",align:"center"},{title:"收藏时间",dataIndex:"createTime",key:"createTime",align:"center"},{title:"操作",dataIndex:"operation",align:"center"}];return p.value||e.pop(),e})),f=i({knowledgeName:"",labelId:""}),{onSearch:g,onReset:h,pagination:_,dataSource:w,getList:C,searchFormRef:x,onTableChange:N,sortedInfo:T}=tt({fetchData:hl,formatParams:()=>({...f})}),{share:L}=yt();return(e,i)=>{const d=ae,u=te,c=le,p=se,v=ie,T=ee,R=de,U=X,S=a("router-link"),O=re;return o(),y("div",null,[s(U,{class:"search-box"},{default:l((()=>[s(R,{ref_key:"searchFormRef",ref:x,layout:"inline",model:n(f)},{default:l((()=>[s(T,{gutter:[24,16]},{default:l((()=>[s(c,null,{default:l((()=>[s(u,{label:"条目标题",name:"knowledgeName"},{default:l((()=>[s(d,{value:n(f).knowledgeName,"onUpdate:value":i[0]||(i[0]=e=>n(f).knowledgeName=e),valueModifiers:{trim:!0},placeholder:"请输入条目标题",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(c,null,{default:l((()=>[s(u,{label:"标签",name:"labelId"},{default:l((()=>[s(rt,{value:n(f).labelId,"onUpdate:value":i[1]||(i[1]=e=>n(f).labelId=e)},null,8,["value"])])),_:1})])),_:1}),s(c,null,{default:l((()=>[s(u,null,{default:l((()=>[s(v,{size:20},{default:l((()=>[s(p,{type:"primary",onClick:n(g)},{default:l((()=>[Xn])),_:1},8,["onClick"]),s(p,{onClick:n(h)},{default:l((()=>[Qn])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(U,{class:"table-box mt20"},{default:l((()=>[s(O,{rowKey:"id",columns:n(m),"data-source":n(w),pagination:n(_),bordered:"",onChange:n(N)},{bodyCell:l((({column:e,text:a,record:i})=>["knowledgeName"===e.dataIndex?(o(),t(S,{key:0,to:{name:"ArticleDetail",query:{id:i.id}}},{default:l((()=>[I(r(a),1)])),_:2},1032,["to"])):k("",!0),"operation"===e.dataIndex?(o(),y(b,{key:1},[s(p,{type:"link",class:"action-btn",onClick:e=>(async e=>{await _l({knowledgeId:e.id}),B.success("取消收藏成功"),C()})({id:i.id})},{default:l((()=>[eo])),_:2},1032,["onClick"]),s(p,{type:"link",class:"action-btn",onClick:e=>n(L)({id:i.id,title:i.knowledgeName,type:i.knowledgeFlag,endTime:"0"===i.expirationType?"永久有效":i.endTime})},{default:l((()=>[ao])),_:2},1032,["onClick"])],64)):k("",!0)])),_:1},8,["columns","data-source","pagination","onChange"])])),_:1})])}}}),[["__scopeId","data-v-040630bc"]]);const lo=e=>(c("data-v-f8c94e24"),e=e(),p(),e),no=lo((()=>d("div",null,"纠错内容:",-1))),oo=lo((()=>d("div",null,"补充图片:",-1))),so=lo((()=>d("span",{class:"label"},"附件列表: ",-1))),io={class:"file"},ro=I("下载"),uo=lo((()=>d("div",null,"纠错人:",-1))),co=lo((()=>d("div",null,"纠错时间:",-1))),po=I("关闭");var mo=Aa(e({props:{id:null},emits:["success","cancel"],setup(e,{emit:a}){const u=e,c=h([]),p=i({accessory:"",content:"",createTime:"",id:"",knowledgeId:"",opUser:"",picture:"",userId:""}),v=h([]),{id:f}=m(u),w=async()=>{const e=await(a={knowledgeId:f.value},Ea("/base/error/correction/detail",a));var a;Object.assign(p,e);const t=e.accessory.split(",");if(c.value=t.map((e=>{const a=e.split("/");return a[a.length-1]})),e.picture){const e=p.picture.split(",");v.value=et(e)}};_((()=>{w()}));const C=()=>{a("success"),x()},x=()=>{a("cancel")};return(e,a)=>{const i=le,u=ee,m=se,f=ue;return o(),t(f,{title:"查看",visible:!0,maskClosable:!1,closable:!1,width:"600px",destroyOnClose:"",onOk:C,onCancel:x},{footer:l((()=>[s(m,{key:"back",onClick:x},{default:l((()=>[po])),_:1})])),default:l((()=>[s(u,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[no])),_:1}),s(i,{span:19},{default:l((()=>[I(r(n(p).content),1)])),_:1})])),_:1}),s(u,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[oo])),_:1}),s(i,{span:19},{default:l((()=>[s(Yt,{disabled:"",type:"1",modelValue:v.value,"max-length":v.value.length},null,8,["modelValue","max-length"])])),_:1})])),_:1}),s(u,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[so])),_:1}),s(i,{span:19},{default:l((()=>[(o(!0),y(b,null,g(c.value,((e,a)=>(o(),t(u,null,{default:l((()=>[s(i,{span:17},{default:l((()=>[d("div",io,r(e),1)])),_:2},1024),s(i,{span:2},{default:l((()=>[e?(o(),t(m,{key:0,class:"link-btn",type:"link",onClick:e=>(e=>{const a=p.accessory.split(",");wl(a[e],c.value[e])})(a)},{default:l((()=>[ro])),_:2},1032,["onClick"])):k("",!0)])),_:2},1024)])),_:2},1024)))),256))])),_:1})])),_:1}),s(u,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[uo])),_:1}),s(i,{span:19},{default:l((()=>[I(r(n(p).opUser),1)])),_:1})])),_:1}),s(u,{class:"mb15"},{default:l((()=>[s(i,{span:5},{default:l((()=>[co])),_:1}),s(i,{span:19},{default:l((()=>[I(r(n(p).createTime),1)])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-f8c94e24"]]);const vo=I("查询"),fo=I("重置"),yo=I("查看 "),go=I("删除");var bo=Aa(e({name:"CorrectionList",setup(e){Ae();const u=Ue(),c=$a(),p=u.meta.key,m=v((()=>c.menuOperateAuthMap[p])),f=v((()=>{L.value;const e=[{title:"类型",dataIndex:"knowledgeFlag",key:"knowledgeFlag",align:"center",customRender:({text:e})=>nt[e]},{title:"知识条目",dataIndex:"knowledgeName",key:"knowledgeName",align:"center"},{title:"分类",dataIndex:"knowledgeTypeName",key:"knowledgeTypeName",align:"center",customRender:({text:e})=>e?e.split(", ").join("-"):""},{title:"纠错时间",dataIndex:"createTime",key:"createTime",align:"center"},{title:"操作",dataIndex:"operation",align:"center"}];return m.value||e.pop(),e})),g=i({knowledgeName:"",labelId:""}),{onSearch:h,onReset:_,pagination:w,dataSource:C,getList:x,searchFormRef:N,onTableChange:T,sortedInfo:L}=tt({fetchData:Cl,formatParams:()=>({...g})}),R=i({visible:!1,id:"1"}),U=()=>{R.visible=!1},S=async e=>{var a;await(a={knowledgeId:e.id},Ea("/base/error/correction/del",a)),B.success("删除成功"),x()};return(e,i)=>{const u=ae,c=te,p=le,m=se,v=ie,x=ee,L=de,O=X,A=a("router-link"),D=ve,F=re;return o(),y(b,null,[d("div",null,[s(O,{class:"search-box"},{default:l((()=>[s(L,{ref_key:"searchFormRef",ref:N,layout:"inline",model:n(g)},{default:l((()=>[s(x,{gutter:[24,16]},{default:l((()=>[s(p,null,{default:l((()=>[s(c,{label:"条目标题",name:"knowledgeName"},{default:l((()=>[s(u,{value:n(g).knowledgeName,"onUpdate:value":i[0]||(i[0]=e=>n(g).knowledgeName=e),valueModifiers:{trim:!0},placeholder:"请输入条目标题",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(p,null,{default:l((()=>[s(c,{label:"标签",name:"labelId"},{default:l((()=>[s(rt,{value:n(g).labelId,"onUpdate:value":i[1]||(i[1]=e=>n(g).labelId=e)},null,8,["value"])])),_:1})])),_:1}),s(p,null,{default:l((()=>[s(c,null,{default:l((()=>[s(v,{size:20},{default:l((()=>[s(m,{type:"primary",onClick:n(h)},{default:l((()=>[vo])),_:1},8,["onClick"]),s(m,{onClick:n(_)},{default:l((()=>[fo])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(O,{class:"table-box mt20"},{default:l((()=>[s(F,{rowKey:"id",columns:n(f),"data-source":n(C),pagination:n(w),bordered:"",onChange:n(T)},{bodyCell:l((({column:e,text:a,record:n})=>["knowledgeName"===e.dataIndex?(o(),t(A,{key:0,to:{name:"ArticleDetail",query:{id:n.id}}},{default:l((()=>[I(r(a),1)])),_:2},1032,["to"])):k("",!0),"operation"===e.dataIndex?(o(),y(b,{key:1},[s(m,{type:"link",class:"action-btn",onClick:e=>(e=>{R.visible=!0,R.id=e.id})({id:n.id})},{default:l((()=>[yo])),_:2},1032,["onClick"]),s(D,{title:"确定要删除该条目吗?","ok-text":"确认","cancel-text":"取消",onConfirm:e=>S({id:n.id}),onCancel:i[2]||(i[2]=()=>{})},{default:l((()=>[s(m,{type:"link",class:"action-btn"},{default:l((()=>[go])),_:1})])),_:2},1032,["onConfirm"])],64)):k("",!0)])),_:1},8,["columns","data-source","pagination","onChange"])])),_:1})]),n(R).visible?(o(),t(mo,{key:0,id:n(R).id,onCancel:U},null,8,["id"])):k("",!0)],64)}}}),[["__scopeId","data-v-176c41a4"]]);const ko=e=>Ea("/base/archive/query",e);const ho=I("查询"),_o=I("重置"),wo=I("归档 "),Co=I("分享");var xo=Aa(e({name:"AuditList",setup(e){Ae(),i([{label:"全部",value:""},{label:"未归档",value:"0"},{label:"已归档",value:"1"}]);const d=v((()=>(w.value,[{title:"类型",dataIndex:"knowledgeFlag",key:"knowledgeFlag",align:"center",customRender:({text:e})=>nt[e]},{title:"知识条目",dataIndex:"knowledgeName",key:"knowledgeName",align:"center"},{title:"分类",dataIndex:"knowledgeTypeName",key:"knowledgeTypeName",align:"center",customRender:({text:e})=>e?e.split(", ").join("-"):""},{title:"提交人",dataIndex:"userName",key:"userName",align:"center"},{title:"操作",dataIndex:"operation",align:"center"}]))),u=i({knowledgeName:"",labelId:""}),{onSearch:c,onReset:p,pagination:m,dataSource:f,getList:g,searchFormRef:h,onTableChange:_,sortedInfo:w}=tt({fetchData:ko,formatParams:()=>({...u})}),C=async e=>{var a;await(a={knowledgeId:e.id},Ea("/base/archive/status",a)),B.success("归档成功"),g()},{share:x}=yt();return(e,i)=>{const v=ae,g=te,w=le,N=se,T=ie,L=ee,R=de,U=X,S=a("router-link"),O=re;return o(),y("div",null,[s(U,{class:"search-box"},{default:l((()=>[s(R,{ref_key:"searchFormRef",ref:h,layout:"inline",model:n(u)},{default:l((()=>[s(L,{gutter:[24,16]},{default:l((()=>[s(w,null,{default:l((()=>[s(g,{label:"条目标题",name:"knowledgeName"},{default:l((()=>[s(v,{value:n(u).knowledgeName,"onUpdate:value":i[0]||(i[0]=e=>n(u).knowledgeName=e),valueModifiers:{trim:!0},placeholder:"请输入条目标题",autocomplete:"off","allow-clear":""},null,8,["value"])])),_:1})])),_:1}),s(w,null,{default:l((()=>[s(g,{label:"标签",name:"labelId"},{default:l((()=>[s(rt,{value:n(u).labelId,"onUpdate:value":i[1]||(i[1]=e=>n(u).labelId=e)},null,8,["value"])])),_:1})])),_:1}),s(w,null,{default:l((()=>[s(g,null,{default:l((()=>[s(T,{size:20},{default:l((()=>[s(N,{type:"primary",onClick:n(c)},{default:l((()=>[ho])),_:1},8,["onClick"]),s(N,{onClick:n(p)},{default:l((()=>[_o])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),s(U,{class:"table-box mt20"},{default:l((()=>[s(O,{rowKey:"id",columns:n(d),"data-source":n(f),pagination:n(m),bordered:"",onChange:n(_)},{bodyCell:l((({column:e,text:a,record:i})=>["knowledgeName"===e.dataIndex?(o(),t(S,{key:0,to:{name:"ArticleDetail",query:{id:i.id}}},{default:l((()=>[I(r(a),1)])),_:2},1032,["to"])):k("",!0),"operation"===e.dataIndex?(o(),y(b,{key:1},[s(N,{type:"link",class:"action-btn",onClick:e=>C({id:i.id})},{default:l((()=>[wo])),_:2},1032,["onClick"]),s(N,{type:"link",class:"action-btn",onClick:e=>n(x)({id:i.id,title:i.knowledgeName,type:i.knowledgeFlag,endTime:"0"===i.expirationType?"永久有效":i.endTime})},{default:l((()=>[Co])),_:2},1032,["onClick"])],64)):k("",!0)])),_:1},8,["columns","data-source","pagination","onChange"])])),_:1})])}}}),[["__scopeId","data-v-78d5d6a2"]]);const Io={id:"knowledge-map"};var No=Aa(e({setup(e){Ae();const a=h([]),t=window.BMap,l=async()=>{const e=await Ea("base/query/map");a.value=e},n=(e,a)=>{const l=`<div style="font-weight:bold;color:#CE5521;font-size:14px">\n    <a href="#/myKnowledge/article-detail?id=${a.id}">${a.knowledgeName}</a>\n  </div>`,n=[`\n    <table cellspacing="0" style="table-layout:fixed;width:100%;font:12px arial,simsun,sans-serif">\n      <tbody>\n        <tr>\n          <td style="vertical-align:top;line-height:16px;width:38px;white-space:nowrap;word-break:keep-all">类型:</td>\n          <td style="vertical-align:top;line-height:16px">${nt[a.knowledgeFlag]}</td>\n        </tr>\n        <tr>\n          <td style="vertical-align:top;line-height:16px;width:38px;white-space:nowrap;word-break:keep-all">状态:</td>\n          <td style="vertical-align:top;line-height:16px">已归档</td>\n        </tr>\n      </tbody>\n    </table>\n  `],o=new t.InfoWindow(n.join(""),{title:l,width:200}),s=()=>{e.openInfoWindow(o)};return e.addEventListener("click",s),s};return _((async()=>{await l();const e=new t.Map("knowledge-map"),o=new t.Point(116.23376,40.01477);e.centerAndZoom(o,12),e.enableScrollWheelZoom();(new t.Boundary).get("北京海淀区",(a=>{const l="180, -90;",n=new t.Polygon(a.boundaries[0]+l+l+"-180, -90;-180,  90;180, 90;"+l,{strokeColor:"none",fillColor:"#fff",fillOpacity:1,strokeOpacity:.5});e.addOverlay(n)}));const s=(a,l)=>{const n=new t.Marker(a);return e.addOverlay(n),n};for(let l=0;l<a.value.length;l++){const{longitude:e,latitude:o}=a.value[l],i=s(new t.Point(e,o));n(i,a.value[l])}})),(e,a)=>(o(),y("div",Io))}}),[["__scopeId","data-v-4f66c359"]]);var To=Aa(e({setup(e){const a=h();return _((async()=>{if(a.value){const{records:e}=await dt({current:1,size:20}),t=pa(a.value),l={series:[{type:"wordCloud",sizeRange:[15,40],rotationRange:[0,0],rotationStep:45,gridSize:8,shape:"pentagon",width:"100%",height:"100%",textStyle:{color:function(){return"rgb("+[Math.round(160*Math.random()),Math.round(160*Math.random()),Math.round(160*Math.random())].join(",")+")"},emphasis:{focus:"self",textStyle:{textShadowBlur:10,textShadowColor:"#333"}}},data:e.map((e=>({name:e.labelName,value:e.knowledgeNum})))}]};t.setOption(l),window.addEventListener("resize",(function(){t.resize()}))}})),(e,t)=>(o(),y("div",{ref_key:"wordCloud",ref:a,class:"top-search mt15"},null,512))}}),[["__scopeId","data-v-17066808"]]);const Lo=e=>(c("data-v-cf321ae6"),e=e(),p(),e),Ro=Lo((()=>d("div",{class:"title mb15"},"热门排行榜",-1))),Uo=Lo((()=>d("div",{class:"title mt15"},"实时热搜",-1)));var So=Aa(e({name:"KnowledgeMap",setup(e){const n=[{title:"序号",dataIndex:"version",width:80,customRender:({index:e})=>e+1},{title:"条目",dataIndex:"knowledgeName",align:"center"}],i=h([]);return _((()=>{(async()=>{const{records:e}=await _t();i.value=e})()})),(e,d)=>{const u=X,c=le,p=a("router-link"),m=re,v=ee;return o(),y("div",null,[s(v,null,{default:l((()=>[s(c,{span:16},{default:l((()=>[s(u,{class:"map-container mt20"},{default:l((()=>[s(No)])),_:1})])),_:1}),s(c,{span:7},{default:l((()=>[s(u,{style:{"min-height":"748px"}},{default:l((()=>[Ro,s(m,{columns:n,"data-source":i.value,bordered:"",pagination:!1},{bodyCell:l((({column:e,text:a,record:n})=>["knowledgeName"===e.dataIndex?(o(),t(p,{key:0,to:{name:"ArticleDetail",query:{id:n.id}}},{default:l((()=>[I(r(a),1)])),_:2},1032,["to"])):k("",!0)])),_:1},8,["data-source"]),Uo,s(To)])),_:1})])),_:1})])),_:1})])}}}),[["__scopeId","data-v-cf321ae6"]]);const Oo=()=>{const e=h({title:{text:"知识数量统计",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} 个"},xAxis:{type:"category",data:[""],axisLabel:{interval:0,rotate:-38}},yAxis:{type:"value"},series:[{name:"知识数量统计",type:"bar",data:[0]}]});return{countStatisticalOption:e,fetchKnowledgeNumber:async a=>{const t=await(l=a,Ea("/dict/statistics/type/knowledge/number",l));var l;const n=[],o=[];t.forEach((e=>{n.push(e.dictName),o.push(e.num)})),e.value.xAxis.data=n,e.value.series[0].data=o}}},Ao=(e,a,t)=>{const l=[],n=[];return e.forEach((e=>{if("2"===a.timeType){const a=wa().set("month",Number(e.xAxisData)).format("YYYY-MM");l.push(a)}else"flag"===t?l.push(nt[e.xAxisData]):l.push(e.xAxisData);n.push(e.num)})),{xAxisData:l,seriesData:n}},Do=()=>{const e=h({title:{text:"知识数量增长趋势",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} 个"},xAxis:{type:"category",data:[""],axisLabel:{interval:0,rotate:-38}},yAxis:{type:"value"},series:[{name:"知识数量增长趋势",type:"line",data:[0]}]});return{countTrendOption:e,fetchDateRangeCount:async a=>{const t=await(l=a,Ea("/base/statistics/increase",l));var l;const{xAxisData:n,seriesData:o}=Ao(t,a);e.value.xAxis.data=n,e.value.series[0].data=o}}},Fo=()=>{const e=h({title:{text:"知识类型数量统计",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} 个"},xAxis:{type:"category",data:["专题","图片","视频","文件"]},yAxis:{type:"value"},series:[{name:"知识类型数量统计",type:"bar",data:[120,200,150,80]}]});return{typeCountStatisticalOption:e,fetchKnowledgeTypeNumber:async a=>{const t=await(l=a,Ea("/dict/statistics/knowledge/flag/number",l));var l;const{xAxisData:n,seriesData:o}=Ao(t,a,"flag");e.value.xAxis.data=n,e.value.series[0].data=o}}},jo=()=>{const e=h([]);return{employeeContributionRankingColumns:[{title:"序号",dataIndex:"index",align:"center",width:80,customRender:({index:e})=>e+1},{title:"姓名",dataIndex:"userName",align:"center"},{title:"科室",dataIndex:"deptName",align:"center"},{title:"数量",dataIndex:"num",align:"center"}],employeeContributionData:e,fetchEmployeeContributionData:async a=>{const t=await(l=a,Ea("/user/statistics/user/create/knowledge/num",l));var l;e.value=t}}},qo=()=>{const e=h({title:{text:"科室贡献",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:[""]},series:[{name:"科室贡献",type:"pie",radius:"55%",center:["50%","60%"],data:[{}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]});return{departmentContributionOption:e,fetchDepartmentContributionData:async a=>{const t=await(l=a,Ea("/dept/statistics/dept/create/knowledge/ration",l));var l;e.value.series[0].data=t.map((e=>({value:e.num,name:e.xAxisData}))),e.value.legend.data=t.map((e=>e.xAxisData))}}};const Mo=e=>(c("data-v-41ce4161"),e=e(),p(),e),Ko=I("本周"),Vo=I("本月"),Po=I("本年"),zo=I("自定义时间范围"),Eo=Mo((()=>d("div",{class:"title mb15"},"标签统计",-1))),Bo=Mo((()=>d("div",{class:"title mb15"},"热门排行榜",-1))),Yo=Mo((()=>d("div",{class:"title mb15"},"员工贡献排行榜",-1)));const $o=[{path:"/",component:Ja,meta:{title:"知识首页",icon:"HomeOutlined",level:"1",key:"Home"},children:[{path:"",name:"Home",component:ft}]},{path:"/knowledgeMap",component:Ja,meta:{title:"知识地图",icon:"DashboardOutlined",level:"1",key:"KnowledgeMap"},children:[{path:"",name:"KnowledgeMap",component:So}]},{path:"/myKnowledge",name:"myKnowledge",component:Ja,meta:{title:"我的知识",icon:"BookOutlined"},children:[{path:"knowledge",name:"KnowledgeList",meta:{title:"我的知识",keepAlive:!0,key:"KnowledgeList"},component:Mt},{path:"create",name:"KnowledgeCreate",meta:{title:"创建知识",isMenu:!1,keepAlive:!1},component:cl},{path:"create-topic",name:"KnowledgeCreateTopic",meta:{title:"创建标题",isMenu:!1,keepAlive:!1},component:kl},{path:"article-detail",name:"ArticleDetail",meta:{title:"详情",isMenu:!1,keepAlive:!1},component:wn},{path:"collection",name:"CollectionList",meta:{title:"我的收藏",keepAlive:!0,key:"CollectionList"},component:to},{path:"correction",name:"CorrectionList",meta:{title:"我的纠错",keepAlive:!0,key:"CorrectionList"},component:bo},{path:"audit",name:"AuditList",meta:{title:"知识审核",keepAlive:!0,key:"AuditList"},component:xo}]},{path:"/statistical",component:Ja,meta:{title:"统计报表",icon:"BarChartOutlined",level:"1",key:"Statistical"},children:[{path:"",name:"Statistical",component:Aa(e({name:"Statistical",setup(e){const d=h("0"),u="YYYY-MM-DD",c=wa().startOf("month").format(u),p=wa().endOf("month").format(u),m=h([c,p]),{countStatisticalOption:v,fetchKnowledgeNumber:f}=Oo(),{countTrendOption:y,fetchDateRangeCount:g}=Do(),{typeCountStatisticalOption:b,fetchKnowledgeTypeNumber:_}=Fo();h({title:{text:"知识数量增长趋势",left:"left"},tooltip:{trigger:"axis"},legend:{data:["专题","视频","图片","文档"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:["2022-06-20","2022-06-21","2022-06-22","2022-06-23","2022-06-24","2022-06-25","2022-06-26"],axisLabel:{interval:0,rotate:-38}},yAxis:{type:"value"},series:[{name:"专题",type:"line",stack:"Total",data:[120,132,101,134,90,230,210]},{name:"视频",type:"line",stack:"Total",data:[220,182,191,234,290,330,310]},{name:"图片",type:"line",stack:"Total",data:[150,232,201,154,190,330,410]},{name:"文档",type:"line",stack:"Total",data:[320,332,301,334,390,330,320]}]});const{columns:w,topData:C,fetchTopData:x}=(()=>{const e=[{title:"序号",dataIndex:"index",align:"center",width:80,customRender:({index:e})=>e+1},{title:"条目",dataIndex:"knowledgeName",align:"center"},{title:"类型",dataIndex:"knowledgeFlag",key:"knowledgeFlag",align:"center",customRender:({text:e})=>nt[e]},{title:"分类",dataIndex:"knowledgeTypeName",key:"knowledgeTypeName",align:"center",customRender:({text:e})=>e?e.split(", ").join("-"):""},{title:"创建人",dataIndex:"creator",align:"center"},{title:"评价",dataIndex:"evaluate",align:"center"},{title:"浏览量",dataIndex:"browseNum",align:"center"}],a=h([]);return{columns:e,topData:a,fetchTopData:async()=>{const{records:e}=await _t();a.value=e}}})(),{employeeContributionRankingColumns:N,employeeContributionData:T,fetchEmployeeContributionData:L}=jo(),{departmentContributionOption:R,fetchDepartmentContributionData:U}=qo();return F((()=>{const e=i({timeType:d.value});"3"===d.value&&(e.startTime=m.value[0],e.endTime=m.value[1]),(e=>{f(e),g(e),_(e),x(),L(e),U(e)})(e)})),(e,i)=>{const c=ye,p=ge,f=oe,g=a("v-chart"),h=le,_=ee,x=a("router-link"),L=re,U=X;return o(),t(U,null,{default:l((()=>[s(p,{class:"mb50 mr10",value:d.value,"onUpdate:value":i[0]||(i[0]=e=>d.value=e)},{default:l((()=>[s(c,{value:"0"},{default:l((()=>[Ko])),_:1}),s(c,{value:"1"},{default:l((()=>[Vo])),_:1}),s(c,{value:"2"},{default:l((()=>[Po])),_:1}),s(c,{value:"3"},{default:l((()=>[zo])),_:1})])),_:1},8,["value"]),"3"===d.value?(o(),t(f,{key:0,value:m.value,"onUpdate:value":i[1]||(i[1]=e=>m.value=e),format:u,"value-format":u,valueFormat:"YYYY-MM-DD"},null,8,["value"])):k("",!0),s(_,{class:"mb24"},{default:l((()=>[s(h,{span:12},{default:l((()=>[s(g,{class:"chart",option:n(v)},null,8,["option"])])),_:1}),s(h,{span:12},{default:l((()=>[s(g,{class:"chart",option:n(y)},null,8,["option"])])),_:1})])),_:1}),s(_,{class:"mb24"},{default:l((()=>[s(h,{span:12},{default:l((()=>[s(g,{class:"chart",option:n(b)},null,8,["option"])])),_:1}),s(h,{span:12},{default:l((()=>[Eo,s(To)])),_:1})])),_:1}),s(_,{class:"mb24"},{default:l((()=>[s(h,{span:24},{default:l((()=>[Bo,s(L,{columns:n(w),"data-source":n(C),bordered:"",pagination:!1},{bodyCell:l((({column:e,text:a,record:n})=>["knowledgeName"===e.dataIndex?(o(),t(x,{key:0,to:{name:"ArticleDetail",query:{id:n.id}}},{default:l((()=>[I(r(a),1)])),_:2},1032,["to"])):k("",!0)])),_:1},8,["columns","data-source"])])),_:1})])),_:1}),s(_,{class:"mb24"},{default:l((()=>[s(h,{span:12},{default:l((()=>[Yo,s(L,{columns:n(N),"data-source":n(T),bordered:"",pagination:!1},null,8,["columns","data-source"])])),_:1}),s(h,{span:12},{default:l((()=>[s(g,{class:"chart",option:n(R)},null,8,["option"])])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-41ce4161"]])}]},{path:"/systemSetter",name:"systemSetter",component:Ja,meta:{title:"系统管理",icon:"SettingOutlined"},children:[{path:"user",name:"UserList",meta:{title:"用户管理",keepAlive:!0,key:"UserList"},component:An},{path:"role",name:"RoleList",meta:{title:"角色与权限",keepAlive:!0,key:"RoleList"},component:Vn},{path:"label",name:"LabelList",meta:{title:"知识标签管理",keepAlive:!0,key:"LabelList"},component:Hn},{path:"dictionary",name:"Dictionary",meta:{title:"数据字典",keepAlive:!1,key:"Dictionary"},component:Zn}]}],Ho=[{path:"/not-login",meta:{isMenu:!1},component:Za,children:[{path:"",component:Xa}]}],Go=De({history:Fe(),routes:[...$o,...Ho]});const Jo=ea();(async()=>{ma([va,fa,ya,ga,ba,ka,ha,_a]);const e=j(Ca);!function(e){e.use(Jo)}(e),Go.beforeEach((async(e,a,t)=>{const l=aa.get("token");return Ho.some((({path:a})=>e.path===a))?t():l||e.query.token?!l&&e.query.token?(aa.set("token",e.query.token,{expires:1}),await $a().getUserLogged(),await $a().getMenuAuth(),t()):(await $a().getMenuAuth(),t()):t({path:"/not-login"})})),Go.afterEach(((e,a)=>{!1===e.meta.isMenu&&window.scrollTo(0,0)})),e.use(Te).use(Go).use(Na).use(Ua).mount("#app"),e.component("v-chart",Le)})();
